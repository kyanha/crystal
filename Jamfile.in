TOP ?= "@top_srcdir@" ;
BUILDTOP ?= "@top_builddir@" ;

SubDir TOP ;

# Define our compile groups
RegisterCompileGroups sounddrivers soundloaders imageloaders netdrivers
		      drivers2d drivers3d meshes walkall openglcanvas 
		      softcanvas proctexes nrall ;
Help sounddrivers : "sound drivers" ;
Help soundloaders : "sound loaders" ;
Help imageloaders : "image loaders" ;
Help netdrivers	  : "network drivers" ;
Help drivers2d	  : "2D canvases" ;
Help drivers3d	  : "3D renderers" ;
Help meshes	  : "mesh plugins and mesh loader" ;
Help walkall  	  : "Walktest application and all required plugins" ;
Help openglcanvas : "canvases for the OpenGL renderer" ;
Help softcanvas   : "canvases for the software renderer" ;

# Create some clean targets
CleanDir clean : out ;

Clean distclean : Jamconfig Jamfile
		  cache.mak config.mak Makefile
		  config.log config.status config.status.lineno
		  config.cache configure.lineno
		  include/volatile.h
		  [ Wildcard *.scf ]
		  [ Wildcard *.cex ] ;
CleanDir distclean : autom4te.cache ;
Depends distclean : clean ;
Help distclean : "Remove configuration information and built targets" :
  verbatim ;

Clean maintainerclean : aclocal.m4 configure configure.scan ;
Depends maintainerclean : distclean ;

# Process subdirectories.  NOTE: Unfortunately, Jam rules are presently
# order-sensitive; Library targets must be seen by Jam before Application and
# Plugin targets, thus ordering of these SubInclude invocations is dictated by
# this limitation.
SubInclude TOP data ;
SubInclude TOP libs ;
SubInclude TOP plugins ;
SubInclude TOP apps ;
SubInclude TOP docs ;
SubInclude TOP include ;
SubInclude TOP scripts ;

# When build directory differs from source directory, also arrange for
# 'distclean' to remove the $(BUILDDIR)/include directory created by
# configure, and ensure that 'install' installs the generated
# $(BUILDDIR)/include/volatile.h.
buildheaders = [ GLOB include : * ] ;
buildheaders = [ Filter $(buildheaders:BS) : . .. volatile.h ] ;
if ! $(buildheaders)
{
  CleanDir distclean : include ;
  SubDir BUILDTOP include ;
  Recurse InstallHeader : .h ;
}
