TOP ?= "@top_srcdir@" ;
BUILDTOP ?= "@top_builddir@" ;

SubDir TOP ;

# Define our compile groups
RegisterCompileGroups sounddrivers soundloaders imageloaders netdrivers
		      drivers2d drivers3d meshes walkall openglcanvas 
		      softcanvas proctexes nrall ;
Help sounddrivers : "sound drivers compilegroup" ;
Help soundloaders : "sound loaders compilegroup" ;
Help imageloaders : "image loaders compilegroup" ;
Help netdrivers	  : "network drivers compilegroup" ;
Help drivers2d	  : "2d canvases compilegroup" ;
Help drivers3d	  : "3d renderers compilegroup" ;
Help meshes	  : "mesh plugin and loader compilegroup" ;
Help walkall  	  : "walktest application and all required plugins" ;
Help openglcanvas : "canvases suitable for the GL renderer" ;
Help softcanvas   : "canvases suitable for the software renderer" ;

# Create some clean targets
CleanDir clean : out ;

Clean distclean : Jamconfig Jamfile
		  cache.mak config.mak Makefile
		  config.log config.status config.status.lineno
		  config.cache configure.lineno
		  include/volatile.h
		  [ Wildcard *.scf ]
		  [ Wildcard *.cex ] ;
CleanDir distclean : autom4te.cache ;
Depends distclean : clean ;

Clean maintainerclean : aclocal.m4 configure configure.scan ;
Depends maintainerclean : distclean ;

# Process subdirectories.  NOTE: Unfortunately, Jam rules are presently
# order-sensitive; Library targets must be seen by Jam before Application and
# Plugin targets, thus ordering of these SubInclude invocations is dictated by
# this limitation.
SubInclude TOP data ;
SubInclude TOP libs ;
SubInclude TOP plugins ;
SubInclude TOP apps ;
SubInclude TOP docs ;
SubInclude TOP include ;
SubInclude TOP scripts ;

# When build directory differs from source directory, also arrange for
# 'distclean' to remove the $(BUILDDIR)/include directory created by
# configure, and ensure that 'install' installs the generated
# $(BUILDDIR)/include/volatile.h.  (We do this last because we invoke the
# ScanHeaders rule defined by $(TOP)/include/Jamfile.)
buildheaders = [ GLOB include : * ] ;
buildheaders = [ Filter $(buildheaders:BS) : . .. volatile.h ] ;
if ! $(buildheaders)
{
  CleanDir distclean : include ;
  ScanHeaders $(BUILDTOP) ;
}
