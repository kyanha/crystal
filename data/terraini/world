<?xml version="1.0" encoding="utf-8" ?> 
<world>
  <plugins>
    <plugin name="terrainFact">crystalspace.mesh.loader.factory.terrainimproved</plugin>
    <plugin name="terrain">crystalspace.mesh.loader.terrainimproved</plugin>
    <plugin name="foliageFact">crystalspace.mesh.loader.factory.foliage</plugin>
    <plugin name="foliage">crystalspace.mesh.loader.foliage</plugin>
  </plugins>

  <textures>
    <texture name="lava.png">
      <file>/lev/terraini/lava.png</file>
    </texture>
    <texture name="stone4.gif">
      <file>/lib/std/stone4.gif</file>
    </texture>
    <texture name="grass.png">
      <file>/lev/terrain/grass.png</file>
    </texture>
  </textures>

  <shaders>
    <shader><file>/lev/terraini/shader_base.xml</file></shader>
    <shader><file>/lev/terraini/shader_splat.xml</file></shader>
  </shaders>

  <materials>
    <material name="Lava">
      <texture>lava.png</texture>
      <shader type="ambient">terrain_improved_base</shader>
    </material>
    <material name="Grass">
      <texture>grass.png</texture>
      <shader type="terrain splat">terrain_improved_splatting</shader>
    </material>
    <material name="Stone">
      <texture>stone4.gif</texture>
      <shader type="terrain splat">terrain_improved_splatting</shader>
    </material>
  </materials>

  <library>grass.lib</library>
  <library>rock.lib</library>
  <library>tree.lib</library>
  <library>tree_skimp.lib</library>
  <library>treebark_bare.lib</library>
  <library>bush2.lib</library>

  <addon>
    <plugin>crystalspace.renderloop.loop.loader</plugin>
    <paramsfile>/shader/std_rloop_terrainimproved.xml</paramsfile>
  </addon>
    
  <settings>
    <clearscreen>yes</clearscreen>
    <clearzbuf>yes</clearzbuf>
    <lightmapcellsize>16</lightmapcellsize>
    <renderloop>std_rloop_terrainimproved</renderloop>
  </settings>

  <start>
    <sector>room</sector>
    <position x="0" y="30" z="0" />
    <forward x="0" y="0" z="1" />
    <up x="0" y="1" z="0" />
  </start>

  <meshfact name="TerrainFact">
    <plugin>terrainFact</plugin>
    <params>
      <renderer>crystalspace.mesh.object.terrainimproved.bruteblockrenderer</renderer>
      <collider>crystalspace.mesh.object.terrainimproved.collider</collider>

      <cells>
<!--        <cell name="main">
          <grid_size x="512" y="512" />
          <material_size x="64" y="64" />
          <position x="-256" y="-256" />
          <size x="512" y="512" z="150" />

          <feeder>
            <plugin>crystalspace.mesh.object.terrainimproved.threadeddatafeeder</plugin>
            <param name="heightmap source" value="/lev/terraini/heightmap.png" />
            <param name="materialmap source" value="/lev/terraini/material_blank.png" />
          </feeder>
        </cell>-->

        <cell>
          <grid_size x="33" y="33" />
          <material_size x="32" y="32" />
          <position x="48" y="48" />
          <size x="50" y="50" z="30" />

          <feeder>
            <plugin>crystalspace.mesh.object.terrainimproved.threadeddatafeeder</plugin>
            <param name="heightmap source" value="/lev/terraini/heightmap_00.png" />
            <param name="materialmap source" value="/lev/terraini/material_00.png" />
          </feeder>
        </cell>
        
        <cell>
          <grid_size x="33" y="33" />
          <material_size x="32" y="32" />
          <position x="48" y="98" />
          <size x="50" y="50" z="30" />

          <feeder>
            <plugin>crystalspace.mesh.object.terrainimproved.threadeddatafeeder</plugin>
            <param name="heightmap source" value="/lev/terraini/heightmap_01.png" />
            <param name="materialmap source" value="/lev/terraini/material_01.png" />
          </feeder>
        </cell>

        <cell>
          <grid_size x="33" y="33" />
          <material_size x="32" y="32" />
          <position x="98" y="48" />
          <size x="50" y="50" z="30" />

          <feeder>
            <plugin>crystalspace.mesh.object.terrainimproved.threadeddatafeeder</plugin>
            <param name="heightmap source" value="/lev/terraini/heightmap_10.png" />
            <param name="materialmap source" value="/lev/terraini/material_10.png" />
          </feeder>
        </cell>

        <cell>
          <grid_size x="33" y="33" />
          <material_size x="32" y="32" />
          <position x="98" y="98" />
          <size x="50" y="50" z="30" />

          <feeder>
            <plugin>crystalspace.mesh.object.terrainimproved.threadeddatafeeder</plugin>
            <param name="heightmap source" value="/lev/terraini/heightmap_11.png" />
            <param name="materialmap source" value="/lev/terraini/material_11.png" />
          </feeder>
        </cell>
      </cells>
    </params>
  </meshfact>

  <sector name="room">
     <light name="sun">
       <center x="-50000" y="86030" z="0" />
       <color red="0.85903" green="0.80995" blue="0.70420" />
       <radius>1000000</radius>
     </light>

    <meshobj name="Terrain">
      <plugin>terrain</plugin>
      <params>
        <factory>TerrainFact</factory>
        <materialpalette>
          <material>Lava</material>
          <material>Stone</material>
          <material>Grass</material>
        </materialpalette>
      </params>
      <move> 
        <v x="0" y="0" z="0" /> 
      </move>
      <priority>wall</priority>
    </meshobj>

<!--     <meshgen name="grass">
        <geometry>
	    <factory maxdist="50" name="treebark_bare" />
	    <radius>1</radius>
	    <density>0.02</density>
	    <materialfactor material="Grass" factor=".4" />
	    <defaultmaterialfactor>.7</defaultmaterialfactor>
        </geometry>
        <geometry>
	    <factory maxdist="50" name="tree" />
	    <radius>1</radius>
	    <density>0.02</density>
	    <materialfactor material="Grass" factor="1" />
	    <defaultmaterialfactor>.1</defaultmaterialfactor>
        </geometry>
        <geometry>
	    <factory maxdist="50" name="tree_skimp" />
	    <radius>1</radius>
	    <density>0.01</density>
	    <materialfactor material="Grass" factor="1" />
	    <defaultmaterialfactor>.1</defaultmaterialfactor>
        </geometry>
        <geometry>
	    <factory maxdist="50" name="Grass" />
	    <factory maxdist="50" name="GrassLow" />
	    <radius>1</radius>
	    <density>0.4</density>
	    <materialfactor material="Grass" factor="1" />
        </geometry>
        <geometry>
	    <factory maxdist="50" name="bush2" />
	    <radius>1</radius>
	    <density>0.04</density>
	    <materialfactor material="Marble" factor="1" />
	    <materialfactor material="Stone" factor="1" />
	    <defaultmaterialfactor>.1</defaultmaterialfactor>
        </geometry>
        <geometry>
	    <factory maxdist="50" name="TallGrass" />
	    <factory maxdist="50" name="TallGrassLow" />
	    <radius>1</radius>
	    <density>.08</density>
	    <materialfactor material="Grass" factor="1" />
        </geometry>
        <geometry>
	    <factory maxdist="50" name="Rock" />
	    <radius>1</radius>
	    <density>.010</density>
	    <materialfactor material="Marble" factor="1" />
	    <materialfactor material="Stone" factor="0" />
	    <defaultmaterialfactor>.3</defaultmaterialfactor>
        </geometry>
        <geometry>
	    <factory maxdist="50" name="RockSmall" />
	    <radius>1</radius>
	    <density>.10</density>
	    <materialfactor material="Marble" factor="1" />
	    <materialfactor material="Stone" factor="0" />
	    <defaultmaterialfactor>.3</defaultmaterialfactor>
        </geometry>
	<alphascale mindist="22" maxdist="26" />
	<samplebox>
	    <min x="-256" y="-200" z="-256" />
	    <max x="256" y="200" z="256" />
	</samplebox>
	<meshobj>Terrain</meshobj>
     </meshgen> -->
  </sector>
</world>
