<arbvp>
  <variablemap variable="STANDARD_LIGHT_0_POSITION" register="0"/>
  <variablemap variable="STANDARD_LIGHT_0_DIFFUSE" register="1"/>
  <variablemap variable="STANDARD_LIGHT_0_SPECULAR" register="2"/>
  <variablemap variable="STANDARD_LIGHT_0_ATTENUATION" register="3"/>

  <variablemap variable="splat map scale" register="4" />
  <variablemap variable="texture lod distance" register="5"/>

<program>
<![CDATA[
!!ARBvp1.0
#---------------------------------------
# Simple Vertex Lighting Program
#---------------------------------------
#Parameter definition
PARAM mvp[4]		= { state.matrix.mvp };
PARAM mvi[4]		= { state.matrix.modelview.inverse };
PARAM eyePos    	= { 0.0, 0.0, 0.0, 1};
PARAM lightPos  	= program.local[0];
PARAM lightDiffuse 	= program.local[1];
PARAM lightSpecular 	= program.local[2];
PARAM lightAttenuation 	= program.local[3];
PARAM splatscale 	= program.local[4];
PARAM loddist   	= program.local[5];

# Per vertex inputs
ATTRIB iPos		= vertex.attrib[0];
ATTRIB iCol0		= vertex.attrib[1];
ATTRIB iNorm		= vertex.attrib[2];
ATTRIB iTex0		= vertex.attrib[3];
# Outputs
OUTPUT oPos		= result.position;
OUTPUT oLightDir	= result.texcoord[0];
OUTPUT oNormal		= result.texcoord[1];
OUTPUT oSplat		= result.texcoord[2];
OUTPUT oCol0		= result.color;
# Temporaries
TEMP objLight;
TEMP objEye;
TEMP lodblend;

#Transform vertex to viewspace
DP4 oPos.x, mvp[0], iPos;
DP4 oPos.y, mvp[1], iPos;
DP4 oPos.z, mvp[2], iPos;
DP4 oPos.w, mvp[3], iPos;

DP4 objLight.x, mvi[0], lightPos;
DP4 objLight.y, mvi[1], lightPos;
DP4 objLight.z, mvi[2], lightPos;
DP4 objLight.w, mvi[3], lightPos;

ADD oLightDir, objLight, -iPos;
MOV oNormal, iNorm;
MUL oSplat, splatscale, iTex0;

DP4 objEye.x, mvi[0], eyePos;
DP4 objEye.y, mvi[1], eyePos;
DP4 objEye.z, mvi[2], eyePos;
DP4 objEye.w, mvi[3], eyePos;
      
ADD objEye, objEye, -iPos;
DP3 objEye.w, objEye, objEye;
RSQ objEye.w, objEye.w;
MUL lodblend, objEye.w, loddist;
RCP lodblend.x, lodblend.x;

#Set color
MUL oCol0, lightDiffuse, lodblend.x;

END
]]>
</program>
</arbvp>
