<shader type="xmlshader" name="light_bumpmap">
    <technique priority="350">
        <pass>
            <mixmode><srcalphaadd /></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="normals" destination="attribute 2" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <buffer name="tangents" destination="attribute 4" />
            <buffer name="binormals" destination="attribute 5" />
            <vp plugin="glarb" file="/shader/bump_ppl_diffuse_attn.avp"/>
            <texture destination="unit 0" name="standardtex attenuation" />
            <texture destination="unit 1" name="standardtex attenuation" />
            <texture destination="unit 2" name="standardtex normalization map" />
            <texture destination="unit 3" name="tex normal" />
            <texture destination="unit 4" name="tex diffuse" />
            <texture destination="unit 5" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <alphasource num="0" source="texture" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <alphasource num="0" source="texture" modifier="alpha"/>
                        <alphasource num="1" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="modulate" scale="2"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="texture" modifier="color"/>
                        <coloroperation operation="replace"/>
                        <alphasource num="0" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="dot3" />
                        <alphasource num="0" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                        <alphasource num="0" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="primary color" modifier="color"/>
                        <coloroperation operation="modulate"/>
                        <alphasource num="0" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>



    <technique priority="300">
        <pass>
            <writemask r="false" g="false" b="false" a="true"/>
            <mixmode><copy/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <vp plugin="glarb" file="/shader/flat_ppl_attenuation.avp"/>
            <texture destination="unit 0" name="standardtex attenuation" />
            <texture destination="unit 1" name="standardtex attenuation" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <alphasource num="0" source="texture" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <alphasource num="0" source="texture" modifier="alpha"/>
                        <alphasource num="1" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="modulate" scale="2"/>
                    </layer>
                  </fixedfp>
            </fp>
        </pass>
        <pass>
            <mixmode><destalphaadd/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="normals" destination="attribute 2" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <buffer name="tangents" destination="attribute 4" />
            <buffer name="binormals" destination="attribute 5" />
            <vp plugin="glarb" file="/shader/bump_ppl_diffuse.avp"/>
            <texture destination="unit 0" name="standardtex normalization map" />
            <texture destination="unit 1" name="tex normal" />
            <texture destination="unit 2" name="tex diffuse" />
            <texture destination="unit 3" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="texture" modifier="color"/>
                        <coloroperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="dot3"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="primary color" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>



    <technique priority="250">
        <pass>
            <writemask r="false" g="false" b="false" a="true"/>
            <mixmode><copy/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <vp plugin="glarb" file="/shader/flat_ppl_attenuation.avp"/>
            <texture destination="unit 0" name="standardtex attenuation" />
            <texture destination="unit 1" name="standardtex attenuation" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <alphasource num="0" source="texture" modifier="color"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <alphasource num="0" source="texture" modifier="color"/>
                        <alphasource num="1" source="previous layer" modifier="color"/>
                        <alphaoperation operation="modulate" scale="2"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
        <pass>
            <mixmode><multiply/></mixmode>
            <writemask r="false" g="false" b="false" a="true"/>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="normals" destination="attribute 2" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <buffer name="tangents" destination="attribute 4" />
            <buffer name="binormals" destination="attribute 5" />
            <vp plugin="glarb" file="/shader/bump_ppl_diffuse_a.avp"/>
            <texture destination="unit 0" name="standardtex normalization map" />
            <texture destination="unit 1" name="tex normal" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="texture" modifier="color"/>
                        <coloroperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="dot3 alpha"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
        <pass>
            <mixmode><destalphaadd/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <vp plugin="glarb" file="/shader/flat_ppl_diffuse_b.avp"/>
            <texture destination="unit 0" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="primary color" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>



    <technique priority="200">
        <pass>
            <writemask r="false" g="false" b="false" a="true"/>
            <mixmode><copy/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <vp plugin="glarb" file="/shader/flat_ppl_attenuation.avp"/>
            <texture destination="unit 0" name="standardtex attenuation" />
            <texture destination="unit 1" name="standardtex attenuation" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <alphasource num="0" source="texture" modifier="alpha"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <alphasource num="0" source="texture" modifier="alpha"/>
                        <alphasource num="1" source="previous layer" modifier="alpha"/>
                        <alphaoperation operation="modulate" scale="2"/>
                    </layer>
                  </fixedfp>
            </fp>
        </pass>
        <pass>
            <mixmode><destalphaadd/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="normals" destination="attribute 2" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <vp plugin="glarb" file="/shader/flat_ppl_diffuse.avp"/>
            <texture destination="unit 0" name="standardtex normalization map" />
            <texture destination="unit 1" name="standardtex normalization map" />
            <texture destination="unit 2" name="tex diffuse" />
            <texture destination="unit 3" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="texture" modifier="color"/>
                        <coloroperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="dot3"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="primary color" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>
  
  
    
    <technique priority="150">
        <pass>
            <writemask r="false" g="false" b="false" a="true"/>
            <mixmode><copy/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <vp plugin="glarb" file="/shader/flat_ppl_attenuation.avp"/>
            <texture destination="unit 0" name="standardtex attenuation" />
            <texture destination="unit 1" name="standardtex attenuation" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <alphasource num="0" source="texture" modifier="color"/>
                        <alphaoperation operation="replace"/>
                    </layer>
                    <layer>
                        <alphasource num="0" source="texture" modifier="color"/>
                        <alphasource num="1" source="previous layer" modifier="color"/>
                        <alphaoperation operation="modulate" scale="2"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
        <pass>
            <mixmode><multiply/></mixmode>
            <writemask r="false" g="false" b="false" a="true"/>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="normals" destination="attribute 2" />
            <vp plugin="glarb" file="/shader/flat_ppl_diffuse_a.avp"/>
            <texture destination="unit 0" name="standardtex normalization map" />
            <texture destination="unit 1" name="standardtex normalization map" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="texture" modifier="color"/>
                        <coloroperation operation="replace"/>
                    </layer>
                    <layer>
                        <colorsource num="0" source="previous layer" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="dot3 alpha"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
        <pass>
            <mixmode><destalphaadd/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <vp plugin="glarb" file="/shader/flat_ppl_diffuse_b.avp"/>
            <texture destination="unit 0" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="primary color" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>
    
    
    
    <technique priority="100">
        <pass>
            <mixmode><add/></mixmode>
            <buffer name="vertices" destination="attribute 0" />
            <buffer name="colors" destination="attribute 1" />
            <buffer name="normals" destination="attribute 2" />
            <buffer name="texture coordinates" destination="attribute 3" />
            <vp plugin="glarb" file="/shader/vertexlight.avp"/>
            <texture destination="unit 0" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="primary color" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>
    
    
    
    <technique priority="50">
        <pass>
            <mixmode><add/></mixmode>
            <buffer name="vertices" destination="position" />
            <buffer name="normals" destination="normal" />
            <buffer name="texture coordinates" destination="texture coordinate" />
            <vp plugin="glfixed" file="/shader/vertexlight.fvp"/>
            <texture destination="unit 0" name="tex diffuse" />
            <fp plugin="glfixed">
                <fixedfp>
                    <layer>
                        <colorsource num="0" source="primary color" modifier="color"/>
                        <colorsource num="1" source="texture" modifier="color"/>
                        <coloroperation operation="modulate"/>
                    </layer>
                </fixedfp>
            </fp>
        </pass>
    </technique>



    <technique priority="0">
        <pass>
            <mixmode><copy/></mixmode><!-- for now -->
            <buffer name="vertices" destination="position" />
            <buffer name="normals" destination="normal" />
            <buffer name="texture coordinates" destination="texture coordinate" />
            <buffer name="colors" destination="color" />
            <vp plugin="soft" />
            <fp plugin="soft" />
        </pass>
    </technique>
</shader>
