<shader type="xmlshader" name="splatting_scattering_base">
  <shadervar>
    <define name="STANDARD_LIGHT_AMBIENT" type="vector3" default="0.2, 0.2, 0.2" />
    <!-- beta1 = Rayleigh -->
    <!-- .2
    <define name="beta' 1" type="vector3" default="8.3215e-06, 1.4072e-05, 2.9180e-05" /> 
    <define name="beta' 1" type="vector3" default="3.3286e-05, 5.6288e-05, 1.1672e-04" /> 
    <define name="beta' 1" type="vector3" default="4.1608e-06, 7.0360e-06, 1.4590e-05" /> 
    -->
    <define name="beta' 1" type="vector3" default="8.3215e-06, 1.4072e-05, 2.9180e-05" /> 
    <!-- beta2 = Mie -->
    <!-- .01
    <define name="beta' 2" type="vector3" default="1.3338e-05, 1.7345e-05, 2.4976e-05" />
    <define name="beta' 2" type="vector3" default="0.00026676, 0.00034689, 0.00049952" />
    <define name="beta' 2" type="vector3" default="0.00066689, 0.00086723, 0.00124881" />
    -->
    <define name="beta' 2" type="vector3" default="1.3338e-05, 1.7345e-05, 2.4976e-05" />
    <!--
    <define name="beta1 + beta2" type="vector3" default="0.00019683, 0.00030978, 0.00059405" />
    <define name="beta1 + beta2" type="vector3" default="0.0017058, 0.0024231, 0.0040585" />
    <define name="beta1 + beta2" type="vector3" default="0.0029400, 0.0038177, 0.0055016" />
    -->
    <define name="beta1 + beta2" type="vector3" default="0.00019683, 0.00030978, 0.00059405" />
    <!-- g = 0.8, hg = 1-g^2, 1+g, 2g -->
    <define name="hg" type="vector3" default="0.36, 1.8, 1.6" />
    <!-- inscatter = .3 -->
    <define name="inscattering term" type="vector3" default="0.3, 0.3, 0.3" />
  </shadervar>

  <technique priority="50">
    <pass>
      <mixmode><copy/></mixmode>
      <buffer name="vertices" destination="attribute 0" />
      <buffer name="normals" destination="attribute 1" />
      <buffer name="texture coordinates" destination="attribute 2" />
      <vp plugin="glarb" file="/shader/splatting_scattering_base.avp"/>
      <texture destination="unit 0" name="standardtex normalization map" />
      <texture destination="unit 1" name="standardtex normalization map" />
      <texture destination="unit 2" name="tex diffuse" />
      <texture destination="unit 3" name="standardtex normalization map" />
      <fp plugin="glfixed">
        <fixedfp>
	  <layer>
	    <colorsource num="0" source="texture" modifier="color"/>
	    <coloroperation operation="replace"/>
          </layer>
          <layer>
            <colorsource num="0" source="previous layer" modifier="color"/>
            <colorsource num="1" source="texture" modifier="color"/>
            <coloroperation operation="dot3"/>
          </layer>
          <layer>
            <colorsource num="0" source="previous layer" modifier="color"/>
            <colorsource num="1" source="texture" modifier="color"/>
            <coloroperation operation="modulate"/>
          </layer>
          <layer>
            <colorsource num="0" source="previous layer" modifier="color"/>
	    <colorsource num="1" source="primary color" modifier="color"/>
            <coloroperation operation="modulate"/>
          </layer>
        </fixedfp>
      </fp>
    </pass>
    <pass>
      <mixmode><add/></mixmode>
      <buffer name="vertices" destination="attribute 0" />
      <vp plugin="glarb" file="/shader/scattering.avp" />
      <texture destination="unit 0" name="tex diffuse" />
      <fp plugin="glfixed">
        <fixedfp>
	  <layer>
	    <colorsource num="0" source="primary color" modifier="color"/>
	    <coloroperation operation="replace"/>
	  </layer>
        </fixedfp>
      </fp>
    </pass>
  </technique>
</shader>
