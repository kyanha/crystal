<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Crystal Space: csutil/scf.h Source File (Crystal Space Public API Reference)</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<table border="0" cellpadding="0" cellspacing="0" width="100%" class="head">
 <tr height="59">
  <td class="head" width="202" valign="bottom" style="padding-left:0;"><a href="http://www.crystalspace3d.org/"><img src="csblur.png" width="236" height="59" alt="CrystalSpace" border="0"></a></td>
  <td class="head"><h2>Public API Reference</h2></td>
 </tr>
 <tr height="11">
  <td colspan="2" class="headshadow" valign="top" style="padding-left:0;"><img src="csblurb.png" width="236" height="11" alt="" border="0"></td>
 </tr>
</table>
<div class="content">
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fvar_2Ftmp_2Ftmp0_2FCS_2Finclude_2Fcsutil_2F.html">csutil</a></div>
<h1>scf.h</h1><a href="scf_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Crystal Space Shared Class Facility (SCF)</span>
<a name="l00003"></a>00003 <span class="comment">    Copyright (C) 1999 by Andrew Zabolotny</span>
<a name="l00004"></a>00004 <span class="comment">              (C) 2005 by Marten Svanfeldt</span>
<a name="l00005"></a>00005 <span class="comment">              (C) 2005 by Michael Adams</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    This library is free software; you can redistribute it and/or</span>
<a name="l00008"></a>00008 <span class="comment">    modify it under the terms of the GNU Library General Public</span>
<a name="l00009"></a>00009 <span class="comment">    License as published by the Free Software Foundation; either</span>
<a name="l00010"></a>00010 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00015"></a>00015 <span class="comment">    Library General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">    You should have received a copy of the GNU Library General Public</span>
<a name="l00018"></a>00018 <span class="comment">    License along with this library; if not, write to the Free</span>
<a name="l00019"></a>00019 <span class="comment">    Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef __CSSCF_H__</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define __CSSCF_H__</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "csextern.h"</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="array_8h.html">csutil/array.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="ref_8h.html">csutil/ref.h</a>"</span>
<a name="l00029"></a>00029 
<a name="l00038"></a>00038 <span class="keyword">class </span><a class="code" href="classcsPathsList.html">csPathsList</a>;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#ifndef CS_TYPENAME</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">  #ifdef CS_REF_TRACKER</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">   #include &lt;typeinfo&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">   #define CS_TYPENAME(x)                   typeid(x).name()</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">  #else</span>
<a name="l00045"></a><a class="code" href="group__scf.html#g3d9ad42ddb657d8936d6ec63a36715d8">00045</a> <span class="preprocessor"></span><span class="preprocessor">   #define CS_TYPENAME(x)                   0</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">  #endif</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="comment">// INTERFACE DEFINITIONS</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include "<a class="code" href="scf__interface_8h.html">csutil/scf_interface.h</a>"</span>
<a name="l00051"></a>00051 <span class="comment">// NEW STYLE IMPLEMENTATION</span>
<a name="l00052"></a>00052 <span class="comment">//#include "csutil/scf_implementation.h"</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">//-- Helper macros</span>
<a name="l00056"></a>00056 
<a name="l00061"></a>00061 <span class="preprocessor">#ifdef SCF_DEBUG</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#  define SCF_TRACE(x)                                                  \</span>
<a name="l00063"></a>00063 <span class="preprocessor">   {                                                                    \</span>
<a name="l00064"></a>00064 <span class="preprocessor">     printf ("SCF [%s:%d]:\n", __FILE__, (int)__LINE__);                \</span>
<a name="l00065"></a>00065 <span class="preprocessor">     printf x; SCF_PRINT_CALL_ADDRESS                                   \</span>
<a name="l00066"></a>00066 <span class="preprocessor">   }</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00068"></a><a class="code" href="group__scf.html#gb4d8d174a77747f649b2dc37b6bc4190">00068</a> <span class="preprocessor"></span><span class="preprocessor">#  define SCF_TRACE(x)</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00075"></a>00075 <span class="preprocessor">#if (__GNUC__ &gt;= 3) || ((__GNUC__ &gt;= 2) &amp;&amp; (__GNUC_MINOR__ &gt;= 8))</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#  define SCF_PRINT_CALL_ADDRESS                                        \</span>
<a name="l00077"></a>00077 <span class="preprocessor">   printf ("  Called from address %p\n", __builtin_return_address (0));</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00079"></a><a class="code" href="group__scf.html#g9f56685e26b53b6cba2d06aa6809eaff">00079</a> <span class="preprocessor"></span><span class="preprocessor">#  define SCF_PRINT_CALL_ADDRESS</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#ifdef CS_REF_TRACKER</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span> <span class="comment">/* @@@ HACK: Force an AddAlias() call for every contained interface</span>
<a name="l00085"></a>00085 <span class="comment">  * However, when iSCF::SCF == 0, don't call QI to prevent interface ID </span>
<a name="l00086"></a>00086 <span class="comment">  * resolution (which will fail).</span>
<a name="l00087"></a>00087 <span class="comment">  */</span>
<a name="l00088"></a>00088 <span class="preprocessor"> #define SCF_INIT_TRACKER_ALIASES    \</span>
<a name="l00089"></a>00089 <span class="preprocessor">  if (iSCF::SCF != 0) QueryInterface ((scfInterfaceID)-1, -1);</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00091"></a><a class="code" href="group__scf.html#g2ff63b30a0a9bf7946a0f6dfa265eb92">00091</a> <span class="preprocessor"></span><span class="preprocessor"> #define SCF_INIT_TRACKER_ALIASES</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>
<a name="l00094"></a>00094 <span class="comment">//-- Old style implementation</span>
<a name="l00099"></a><a class="code" href="group__scf.html#g80068665d91cef3e2b22a29021ff789a">00099</a> <span class="comment"></span><span class="preprocessor">#define SCF_DECLARE_IBASE                                               \</span>
<a name="l00100"></a>00100 <span class="preprocessor">  int scfRefCount;              </span><span class="comment">/* Reference counter */</span>                 \
<a name="l00101"></a>00101   csArray&lt;iBase**&gt;* scfWeakRefOwners;                                   \
<a name="l00102"></a>00102   void scfRemoveRefOwners ();                                           \
<a name="l00103"></a>00103   SCF_DECLARE_EMBEDDED_IBASE (iBase)
<a name="l00104"></a>00104 
<a name="l00109"></a><a class="code" href="group__scf.html#g72618ea3f81a88456fdb3f04e2304248">00109</a> <span class="preprocessor">#define SCF_DECLARE_EMBEDDED_IBASE(OuterClass)                          \</span>
<a name="l00110"></a>00110 <span class="preprocessor">public:                                                                 \</span>
<a name="l00111"></a>00111 <span class="preprocessor">  OuterClass *scfParent;        </span><span class="comment">/* The parent object */</span>                 \
<a name="l00112"></a>00112   virtual void IncRef ();                                               \
<a name="l00113"></a>00113   virtual void DecRef ();                                               \
<a name="l00114"></a>00114   virtual int GetRefCount ();                                           \
<a name="l00115"></a>00115   virtual void AddRefOwner (iBase** ref_owner);                         \
<a name="l00116"></a>00116   virtual void RemoveRefOwner (iBase** ref_owner);                      \
<a name="l00117"></a>00117   virtual void *QueryInterface (scfInterfaceID iInterfaceID, int iVersion)
<a name="l00118"></a>00118 
<a name="l00128"></a><a class="code" href="group__scf.html#g7b56c23c494568eebabf65f6539124fb">00128</a> <span class="preprocessor">#define SCF_CONSTRUCT_IBASE(Parent)                                     \</span>
<a name="l00129"></a>00129 <span class="preprocessor">  csRefTrackerAccess::TrackConstruction (this);                         \</span>
<a name="l00130"></a>00130 <span class="preprocessor">  csRefTrackerAccess::SetDescription (this, CS_TYPENAME(*this));        \</span>
<a name="l00131"></a>00131 <span class="preprocessor">  scfRefCount = 1;                                                      \</span>
<a name="l00132"></a>00132 <span class="preprocessor">  scfWeakRefOwners = 0;                                                 \</span>
<a name="l00133"></a>00133 <span class="preprocessor">  scfParent = Parent; if (scfParent) scfParent-&gt;IncRef();               \</span>
<a name="l00134"></a>00134 <span class="preprocessor">  SCF_INIT_TRACKER_ALIASES                                              </span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00145"></a><a class="code" href="group__scf.html#g73f0a5882fc3bb3863779aff6a4995dd">00145</a> <span class="preprocessor">#define SCF_CONSTRUCT_EMBEDDED_IBASE(Interface)                         \</span>
<a name="l00146"></a>00146 <span class="preprocessor">  Interface.scfParent = this;                                           \</span>
<a name="l00147"></a>00147 <span class="preprocessor">  csRefTrackerAccess::AddAlias (&amp;Interface, this);</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>
<a name="l00154"></a><a class="code" href="group__scf.html#g95b257cf1ab8c7d7a6764858bb9bcab1">00154</a> <span class="preprocessor">#define SCF_DESTRUCT_IBASE()                                            \</span>
<a name="l00155"></a>00155 <span class="preprocessor">  csRefTrackerAccess::TrackDestruction (this, scfRefCount);             \</span>
<a name="l00156"></a>00156 <span class="preprocessor">  scfRemoveRefOwners ();</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00164"></a><a class="code" href="group__scf.html#g279c1b1852e7fa25a6283a7694c2754c">00164</a> <span class="preprocessor">#define SCF_DESTRUCT_EMBEDDED_IBASE(Interface)                          \</span>
<a name="l00165"></a>00165 <span class="preprocessor">  csRefTrackerAccess::RemoveAlias (&amp;Interface, this);                   \</span>
<a name="l00166"></a>00166 <span class="preprocessor">  Interface.scfParent = 0;</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00173"></a><a class="code" href="group__scf.html#g61c2790d78495da70938a7a8e86fbbef">00173</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_INCREF(Class)                               \</span>
<a name="l00174"></a>00174 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
<a name="l00175"></a>00175 <span class="preprocessor">{                                                                       \</span>
<a name="l00176"></a>00176 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;IncRef (%d)\n", #Class, this, scfRefCount + 1));\</span>
<a name="l00177"></a>00177 <span class="preprocessor">  csRefTrackerAccess::TrackIncRef (this, scfRefCount);                  \</span>
<a name="l00178"></a>00178 <span class="preprocessor">  scfRefCount++;                                                        \</span>
<a name="l00179"></a>00179 <span class="preprocessor">}</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>
<a name="l00189"></a><a class="code" href="group__scf.html#g7e8ffa4f9026905dbd29844183ab6d79">00189</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_DECREF(Class)                               \</span>
<a name="l00190"></a>00190 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
<a name="l00191"></a>00191 <span class="preprocessor">{                                                                       \</span>
<a name="l00192"></a>00192 <span class="preprocessor">  csRefTrackerAccess::TrackDecRef (this, scfRefCount);                  \</span>
<a name="l00193"></a>00193 <span class="preprocessor">  if (scfRefCount == 1)                                                 \</span>
<a name="l00194"></a>00194 <span class="preprocessor">  {                                                                     \</span>
<a name="l00195"></a>00195 <span class="preprocessor">    SCF_TRACE ((" delete (%s *)%p\n", #Class, this));                   \</span>
<a name="l00196"></a>00196 <span class="preprocessor">    scfRemoveRefOwners ();                                              \</span>
<a name="l00197"></a>00197 <span class="preprocessor">    if (scfParent)                                                      \</span>
<a name="l00198"></a>00198 <span class="preprocessor">      scfParent-&gt;DecRef ();                                             \</span>
<a name="l00199"></a>00199 <span class="preprocessor">    delete this;                                                        \</span>
<a name="l00200"></a>00200 <span class="preprocessor">    return;                                                             \</span>
<a name="l00201"></a>00201 <span class="preprocessor">  }                                                                     \</span>
<a name="l00202"></a>00202 <span class="preprocessor">  scfRefCount--;                                                        \</span>
<a name="l00203"></a>00203 <span class="preprocessor">}</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>
<a name="l00211"></a><a class="code" href="group__scf.html#g16e96482396e1295e2088d550f8f8979">00211</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_REMOVE_REF_OWNERS(Class)                    \</span>
<a name="l00212"></a>00212 <span class="preprocessor">void Class::scfRemoveRefOwners ()                                       \</span>
<a name="l00213"></a>00213 <span class="preprocessor">{                                                                       \</span>
<a name="l00214"></a>00214 <span class="preprocessor">  if (!scfWeakRefOwners) return;                                        \</span>
<a name="l00215"></a>00215 <span class="preprocessor">  for (size_t i = 0 ; i &lt; scfWeakRefOwners-&gt;Length () ; i++)            \</span>
<a name="l00216"></a>00216 <span class="preprocessor">  {                                                                     \</span>
<a name="l00217"></a>00217 <span class="preprocessor">    iBase** p = (*scfWeakRefOwners)[i];                                 \</span>
<a name="l00218"></a>00218 <span class="preprocessor">    *p = 0;                                                             \</span>
<a name="l00219"></a>00219 <span class="preprocessor">  }                                                                     \</span>
<a name="l00220"></a>00220 <span class="preprocessor">  delete scfWeakRefOwners;                                              \</span>
<a name="l00221"></a>00221 <span class="preprocessor">  scfWeakRefOwners = 0;                                                 \</span>
<a name="l00222"></a>00222 <span class="preprocessor">}</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>
<a name="l00228"></a><a class="code" href="group__scf.html#gf81acb60a83f6332646ac6fb6a682f4d">00228</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_REFOWNER(Class)                             \</span>
<a name="l00229"></a>00229 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
<a name="l00230"></a>00230 <span class="preprocessor">{                                                                       \</span>
<a name="l00231"></a>00231 <span class="preprocessor">  if (!scfWeakRefOwners)                                                \</span>
<a name="l00232"></a>00232 <span class="preprocessor">    scfWeakRefOwners = new csArray&lt;iBase**&gt; (0, 4);                     \</span>
<a name="l00233"></a>00233 <span class="preprocessor">  scfWeakRefOwners-&gt;InsertSorted (ref_owner);                           \</span>
<a name="l00234"></a>00234 <span class="preprocessor">}                                                                       \</span>
<a name="l00235"></a>00235 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
<a name="l00236"></a>00236 <span class="preprocessor">{                                                                       \</span>
<a name="l00237"></a>00237 <span class="preprocessor">  if (!scfWeakRefOwners)                                                \</span>
<a name="l00238"></a>00238 <span class="preprocessor">    return;                                                             \</span>
<a name="l00239"></a>00239 <span class="preprocessor">  size_t index = scfWeakRefOwners-&gt;FindSortedKey (                      \</span>
<a name="l00240"></a>00240 <span class="preprocessor">    csArrayCmp&lt;iBase**, iBase**&gt; (ref_owner));                          \</span>
<a name="l00241"></a>00241 <span class="preprocessor">  if (index != csArrayItemNotFound) scfWeakRefOwners-&gt;DeleteIndex (     \</span>
<a name="l00242"></a>00242 <span class="preprocessor">    index);                                                             \</span>
<a name="l00243"></a>00243 <span class="preprocessor">}</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00249"></a><a class="code" href="group__scf.html#g0854daca7aed858f8acd5a6c4289ecb0">00249</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_GETREFCOUNT(Class)                          \</span>
<a name="l00250"></a>00250 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
<a name="l00251"></a>00251 <span class="preprocessor">{                                                                       \</span>
<a name="l00252"></a>00252 <span class="preprocessor">  return scfRefCount;                                                   \</span>
<a name="l00253"></a>00253 <span class="preprocessor">}</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>
<a name="l00261"></a><a class="code" href="group__scf.html#ge0609ea947936cc1498721ffe1bd2efb">00261</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_QUERY(Class)                                \</span>
<a name="l00262"></a>00262 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
<a name="l00263"></a>00263 <span class="preprocessor">{                                                                       \</span>
<a name="l00264"></a>00264 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;QueryInterface (%lu, %08X)\n",               \</span>
<a name="l00265"></a>00265 <span class="preprocessor">    #Class, this, iInterfaceID, iVersion));</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span>
<a name="l00273"></a><a class="code" href="group__scf.html#g9dfafb617d7120a1013e9a384868a6d5">00273</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_QUERY_END                                   \</span>
<a name="l00274"></a>00274 <span class="preprocessor">  return scfParent ?                                                    \</span>
<a name="l00275"></a>00275 <span class="preprocessor">    scfParent-&gt;QueryInterface (iInterfaceID, iVersion) : 0;             \</span>
<a name="l00276"></a>00276 <span class="preprocessor">}</span>
<a name="l00277"></a>00277 <span class="preprocessor"></span>
<a name="l00283"></a><a class="code" href="group__scf.html#gd1d1cb15cf652e11079be790fbc4e78b">00283</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE(Class)                                      \</span>
<a name="l00284"></a>00284 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_INCREF(Class)                                     \</span>
<a name="l00285"></a>00285 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_DECREF(Class)                                     \</span>
<a name="l00286"></a>00286 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_GETREFCOUNT(Class)                                \</span>
<a name="l00287"></a>00287 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_REFOWNER(Class)                                   \</span>
<a name="l00288"></a>00288 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_REMOVE_REF_OWNERS(Class)                          \</span>
<a name="l00289"></a>00289 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_QUERY(Class)</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>
<a name="l00295"></a><a class="code" href="group__scf.html#g6aecc81723e0bd9aca5e1f359821ed1a">00295</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_END                                         \</span>
<a name="l00296"></a>00296 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_QUERY_END</span>
<a name="l00297"></a>00297 <span class="preprocessor"></span>
<a name="l00304"></a><a class="code" href="group__scf.html#g6552cbccd98a6ac9b12bd1f21d9b2678">00304</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_INCREF(Class)                      \</span>
<a name="l00305"></a>00305 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
<a name="l00306"></a>00306 <span class="preprocessor">{                                                                       \</span>
<a name="l00307"></a>00307 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;IncRef (%d)\n", #Class, this,                \</span>
<a name="l00308"></a>00308 <span class="preprocessor">    scfParent-&gt;GetRefCount () + 1));                                    \</span>
<a name="l00309"></a>00309 <span class="preprocessor">  scfParent-&gt;IncRef ();                                                 \</span>
<a name="l00310"></a>00310 <span class="preprocessor">}</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>
<a name="l00318"></a><a class="code" href="group__scf.html#ge1073cfdcbe0f66b23ef4616436d2bab">00318</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_DECREF(Class)                      \</span>
<a name="l00319"></a>00319 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
<a name="l00320"></a>00320 <span class="preprocessor">{                                                                       \</span>
<a name="l00321"></a>00321 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;DecRef (%d)\n", #Class, this,                \</span>
<a name="l00322"></a>00322 <span class="preprocessor">              scfParent-&gt;GetRefCount ()-1));                            \</span>
<a name="l00323"></a>00323 <span class="preprocessor">  scfParent-&gt;DecRef ();                                                 \</span>
<a name="l00324"></a>00324 <span class="preprocessor">}</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>
<a name="l00330"></a><a class="code" href="group__scf.html#ga9c7cb6cf443c1ce69fec94775a2bf71">00330</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_GETREFCOUNT(Class)                 \</span>
<a name="l00331"></a>00331 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
<a name="l00332"></a>00332 <span class="preprocessor">{                                                                       \</span>
<a name="l00333"></a>00333 <span class="preprocessor">  return scfParent-&gt;GetRefCount ();                                     \</span>
<a name="l00334"></a>00334 <span class="preprocessor">}</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span>
<a name="l00340"></a><a class="code" href="group__scf.html#gf4bbce6686713d11a5d923d325977182">00340</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_REFOWNER(Class)                    \</span>
<a name="l00341"></a>00341 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
<a name="l00342"></a>00342 <span class="preprocessor">{                                                                       \</span>
<a name="l00343"></a>00343 <span class="preprocessor">  scfParent-&gt;AddRefOwner (ref_owner);                                   \</span>
<a name="l00344"></a>00344 <span class="preprocessor">}                                                                       \</span>
<a name="l00345"></a>00345 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
<a name="l00346"></a>00346 <span class="preprocessor">{                                                                       \</span>
<a name="l00347"></a>00347 <span class="preprocessor">  scfParent-&gt;RemoveRefOwner (ref_owner);                                \</span>
<a name="l00348"></a>00348 <span class="preprocessor">}</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span>
<a name="l00356"></a><a class="code" href="group__scf.html#g19afecc205e420f7efec00af9722e14f">00356</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY(Class)                       \</span>
<a name="l00357"></a>00357 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
<a name="l00358"></a>00358 <span class="preprocessor">{                                                                       \</span>
<a name="l00359"></a>00359 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;QueryInterface (%lu, %08X)\n",               \</span>
<a name="l00360"></a>00360 <span class="preprocessor">    #Class, this, iInterfaceID, iVersion));</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>
<a name="l00368"></a><a class="code" href="group__scf.html#g1313d2948ac92d65b20055da155c88be">00368</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY_END                          \</span>
<a name="l00369"></a>00369 <span class="preprocessor">  return scfParent-&gt;QueryInterface (iInterfaceID, iVersion);            \</span>
<a name="l00370"></a>00370 <span class="preprocessor">}</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>
<a name="l00378"></a><a class="code" href="group__scf.html#g7e8584d05e5788e1cf1bd8bd64dbc026">00378</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE(Class)                             \</span>
<a name="l00379"></a>00379 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_INCREF(Class)                            \</span>
<a name="l00380"></a>00380 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_DECREF(Class)                            \</span>
<a name="l00381"></a>00381 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_GETREFCOUNT(Class)                       \</span>
<a name="l00382"></a>00382 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_REFOWNER(Class)                          \</span>
<a name="l00383"></a>00383 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY(Class)</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>
<a name="l00389"></a><a class="code" href="group__scf.html#g7a9b87d751252fc2b92555699575875f">00389</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_END                                \</span>
<a name="l00390"></a>00390 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY_END</span>
<a name="l00391"></a>00391 <span class="preprocessor"></span>
<a name="l00398"></a><a class="code" href="group__scf.html#g87a7fc6f6069378da9b8f3736a09b4d9">00398</a> <span class="preprocessor">#define SCF_IMPLEMENTS_INTERFACE(Interface)                             \</span>
<a name="l00399"></a>00399 <span class="preprocessor">  csRefTrackerAccess::AddAlias (CS_STATIC_CAST(Interface*, this), this);\</span>
<a name="l00400"></a>00400 <span class="preprocessor">  SCF_IMPLEMENTS_INTERFACE_COMMON (Interface, this)</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>
<a name="l00406"></a><a class="code" href="group__scf.html#gb0e61a2a89e29d6a32a8ea0e360419fc">00406</a> <span class="preprocessor">#define SCF_IMPLEMENTS_EMBEDDED_INTERFACE(Interface)                    \</span>
<a name="l00407"></a>00407 <span class="preprocessor">  SCF_IMPLEMENTS_INTERFACE_COMMON (Interface, (&amp;scf##Interface))</span>
<a name="l00408"></a>00408 <span class="preprocessor"></span>
<a name="l00412"></a><a class="code" href="group__scf.html#gb5c96982d5d6c59d1714a51c7939cd8d">00412</a> <span class="preprocessor">#define SCF_IMPLEMENTS_INTERFACE_COMMON(Interface,Object)               \</span>
<a name="l00413"></a>00413 <span class="preprocessor">  if (iInterfaceID == scfInterfaceTraits&lt;Interface&gt;::GetID() &amp;&amp;         \</span>
<a name="l00414"></a>00414 <span class="preprocessor">    scfCompatibleVersion (iVersion, scfInterfaceTraits&lt;Interface&gt;::GetVersion())) \</span>
<a name="l00415"></a>00415 <span class="preprocessor">  {                                                                     \</span>
<a name="l00416"></a>00416 <span class="preprocessor">    (Object)-&gt;IncRef ();                                                \</span>
<a name="l00417"></a>00417 <span class="preprocessor">    return CS_STATIC_CAST(Interface*, Object);                          \</span>
<a name="l00418"></a>00418 <span class="preprocessor">  }</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>
<a name="l00430"></a><a class="code" href="group__scf.html#g22e8bdbc93a97e03a63e88cd858d7dca">00430</a> <span class="preprocessor">#define SCF_DECLARE_IBASE_EXT(ParentClass)                              \</span>
<a name="l00431"></a>00431 <span class="preprocessor">  typedef ParentClass __scf_superclass;                                 \</span>
<a name="l00432"></a>00432 <span class="preprocessor">  virtual void IncRef ();                                               \</span>
<a name="l00433"></a>00433 <span class="preprocessor">  virtual void DecRef ();                                               \</span>
<a name="l00434"></a>00434 <span class="preprocessor">  virtual int GetRefCount ();                                           \</span>
<a name="l00435"></a>00435 <span class="preprocessor">  virtual void AddRefOwner (iBase** ref_owner);                         \</span>
<a name="l00436"></a>00436 <span class="preprocessor">  virtual void RemoveRefOwner (iBase** ref_owner);                      \</span>
<a name="l00437"></a>00437 <span class="preprocessor">  virtual void *QueryInterface (scfInterfaceID iInterfaceID, int iVersion)</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>
<a name="l00445"></a><a class="code" href="group__scf.html#g82558e9c9148fc5bffa708cbb8ff875f">00445</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_INCREF(Class)                           \</span>
<a name="l00446"></a>00446 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
<a name="l00447"></a>00447 <span class="preprocessor">{                                                                       \</span>
<a name="l00448"></a>00448 <span class="preprocessor">  __scf_superclass::IncRef ();                                          \</span>
<a name="l00449"></a>00449 <span class="preprocessor">}</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>
<a name="l00457"></a><a class="code" href="group__scf.html#g162c5993a8eee6508d95df635dbfd5b7">00457</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_DECREF(Class)                           \</span>
<a name="l00458"></a>00458 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
<a name="l00459"></a>00459 <span class="preprocessor">{                                                                       \</span>
<a name="l00460"></a>00460 <span class="preprocessor">  __scf_superclass::DecRef ();                                          \</span>
<a name="l00461"></a>00461 <span class="preprocessor">}</span>
<a name="l00462"></a>00462 <span class="preprocessor"></span>
<a name="l00469"></a><a class="code" href="group__scf.html#gdcf274c9859e74ec9c5854ab55d0be6d">00469</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_GETREFCOUNT(Class)                      \</span>
<a name="l00470"></a>00470 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
<a name="l00471"></a>00471 <span class="preprocessor">{                                                                       \</span>
<a name="l00472"></a>00472 <span class="preprocessor">  return __scf_superclass::GetRefCount ();                              \</span>
<a name="l00473"></a>00473 <span class="preprocessor">}</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span>
<a name="l00479"></a><a class="code" href="group__scf.html#gebc34137d05f9c10bd8102e14acb412a">00479</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_REFOWNER(Class)                 \</span>
<a name="l00480"></a>00480 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
<a name="l00481"></a>00481 <span class="preprocessor">{                                                                       \</span>
<a name="l00482"></a>00482 <span class="preprocessor">  __scf_superclass::AddRefOwner (ref_owner);                            \</span>
<a name="l00483"></a>00483 <span class="preprocessor">}                                                                       \</span>
<a name="l00484"></a>00484 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
<a name="l00485"></a>00485 <span class="preprocessor">{                                                                       \</span>
<a name="l00486"></a>00486 <span class="preprocessor">  __scf_superclass::RemoveRefOwner (ref_owner);                         \</span>
<a name="l00487"></a>00487 <span class="preprocessor">}</span>
<a name="l00488"></a>00488 <span class="preprocessor"></span>
<a name="l00495"></a><a class="code" href="group__scf.html#g93e15289cc5aec22cd116f56bc239d28">00495</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_QUERY(Class)                            \</span>
<a name="l00496"></a>00496 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
<a name="l00497"></a>00497 <span class="preprocessor">{</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>
<a name="l00505"></a><a class="code" href="group__scf.html#g737695ef1394f98917189e7d4d5e2cf1">00505</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_QUERY_END                               \</span>
<a name="l00506"></a>00506 <span class="preprocessor">  return __scf_superclass::QueryInterface (iInterfaceID, iVersion);     \</span>
<a name="l00507"></a>00507 <span class="preprocessor">}</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>
<a name="l00513"></a><a class="code" href="group__scf.html#g083be9751a92de2247c16b5b7b83ef09">00513</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT(Class)                                  \</span>
<a name="l00514"></a>00514 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_INCREF(Class)                                 \</span>
<a name="l00515"></a>00515 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_DECREF(Class)                                 \</span>
<a name="l00516"></a>00516 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_GETREFCOUNT(Class)                            \</span>
<a name="l00517"></a>00517 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_REFOWNER(Class)                               \</span>
<a name="l00518"></a>00518 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_QUERY(Class)</span>
<a name="l00519"></a>00519 <span class="preprocessor"></span>
<a name="l00524"></a><a class="code" href="group__scf.html#ge13fa494342e75a2ae009bb8151c86b4">00524</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_END                                     \</span>
<a name="l00525"></a>00525 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_QUERY_END</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span>
<a name="l00542"></a>00542 <span class="preprocessor">#ifdef CS_MEMORY_TRACKER</span>
<a name="l00543"></a>00543 <span class="preprocessor"></span><span class="comment">// This special version of SCF_IMPLEMENT_FACTORY_INIT will make sure that</span>
<a name="l00544"></a>00544 <span class="comment">// the memory tracker for this plugin is implemented.</span>
<a name="l00545"></a>00545 <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_INIT(Class)                               \</span>
<a name="l00546"></a>00546 <span class="preprocessor">static inline void Class ## _scfUnitInitialize(iSCF* SCF)               \</span>
<a name="l00547"></a>00547 <span class="preprocessor">{                                                                       \</span>
<a name="l00548"></a>00548 <span class="preprocessor">  iSCF::SCF = SCF;                                                      \</span>
<a name="l00549"></a>00549 <span class="preprocessor">  extern void mtiRegisterModule (char*);                                \</span>
<a name="l00550"></a>00550 <span class="preprocessor">  mtiRegisterModule (#Class);                                           \</span>
<a name="l00551"></a>00551 <span class="preprocessor">}                                                                       \</span>
<a name="l00552"></a>00552 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00553"></a>00553 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfInitialize)(iSCF* SCF)                  \</span>
<a name="l00554"></a>00554 <span class="preprocessor">{ Class ## _scfUnitInitialize(SCF); }</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00556"></a><a class="code" href="group__scf.html#g67ad4eddf90ef64f89623bf3e94286d3">00556</a> <span class="preprocessor"></span><span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_INIT(Class)                               \</span>
<a name="l00557"></a>00557 <span class="preprocessor">static inline void Class ## _scfUnitInitialize(iSCF* SCF)               \</span>
<a name="l00558"></a>00558 <span class="preprocessor">{ iSCF::SCF = SCF; }                                                    \</span>
<a name="l00559"></a>00559 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00560"></a>00560 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfInitialize)(iSCF* SCF)                  \</span>
<a name="l00561"></a>00561 <span class="preprocessor">{ Class ## _scfUnitInitialize(SCF); }</span>
<a name="l00562"></a>00562 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00563"></a>00563 <span class="preprocessor"></span>
<a name="l00569"></a><a class="code" href="group__scf.html#gcc713246b1d8f2dee9ed4321eb11c409">00569</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_FINIS(Class)                              \</span>
<a name="l00570"></a>00570 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00571"></a>00571 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfFinalize)()                             \</span>
<a name="l00572"></a>00572 <span class="preprocessor">{                                                                       \</span>
<a name="l00573"></a>00573 <span class="preprocessor">CS_STATIC_VARIABLE_CLEANUP                                              \</span>
<a name="l00574"></a>00574 <span class="preprocessor">}</span>
<a name="l00575"></a>00575 <span class="preprocessor"></span>
<a name="l00582"></a><a class="code" href="group__scf.html#g29c2c47442fa32ca14f1cffeb80feb76">00582</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_CREATE(Class)                             \</span>
<a name="l00583"></a>00583 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00584"></a>00584 <span class="preprocessor">iBase* CS_EXPORTED_NAME(Class,_Create)(iBase *iParent)                  \</span>
<a name="l00585"></a>00585 <span class="preprocessor">{                                                                       \</span>
<a name="l00586"></a>00586 <span class="preprocessor">  iBase *ret = new Class (iParent);                                     \</span>
<a name="l00587"></a>00587 <span class="preprocessor">  SCF_TRACE (("  %p = new %s ()\n", ret, #Class));                      \</span>
<a name="l00588"></a>00588 <span class="preprocessor">  return ret;                                                           \</span>
<a name="l00589"></a>00589 <span class="preprocessor">}</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span>
<a name="l00597"></a><a class="code" href="group__scf.html#g2d905b76b58de28e8b95907396a05154">00597</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY(Class)                                    \</span>
<a name="l00598"></a>00598 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_INIT(Class)                                     \</span>
<a name="l00599"></a>00599 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_FINIS(Class)                                    \</span>
<a name="l00600"></a>00600 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_CREATE(Class)</span>
<a name="l00601"></a>00601 <span class="preprocessor"></span>
<a name="l00602"></a><a class="code" href="group__scf.html#g13ac240643168aebcf76ddad7e60e4a5">00602</a> <span class="preprocessor">#define SCF_STATIC_CLASS_CONTEXT      "*static*"</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>
<a name="l00612"></a><a class="code" href="group__scf.html#gebf969daec8776ded9f1b374fa833516">00612</a> <span class="preprocessor">#define SCF_REGISTER_STATIC_CLASS(Class,Ident,Desc,Dep)                 \</span>
<a name="l00613"></a>00613 <span class="preprocessor">  CS_EXPORTED_FUNCTION iBase* CS_EXPORTED_NAME(Class,_Create)(iBase*);  \</span>
<a name="l00614"></a>00614 <span class="preprocessor">  class Class##_StaticInit__                                            \</span>
<a name="l00615"></a>00615 <span class="preprocessor">  {                                                                     \</span>
<a name="l00616"></a>00616 <span class="preprocessor">  public:                                                               \</span>
<a name="l00617"></a>00617 <span class="preprocessor">    Class##_StaticInit__()                                              \</span>
<a name="l00618"></a>00618 <span class="preprocessor">    {                                                                   \</span>
<a name="l00619"></a>00619 <span class="preprocessor">      scfRegisterStaticClass(                                           \</span>
<a name="l00620"></a>00620 <span class="preprocessor">        CS_EXPORTED_NAME(Class,_Create), Ident, Desc, Dep);             \</span>
<a name="l00621"></a>00621 <span class="preprocessor">    }                                                                   \</span>
<a name="l00622"></a>00622 <span class="preprocessor">  } Class##_static_init__;</span>
<a name="l00623"></a>00623 <span class="preprocessor"></span>
<a name="l00628"></a><a class="code" href="group__scf.html#g004495f4a168a56da75c0d5074bb562c">00628</a> <span class="preprocessor">#define SCF_REGISTER_STATIC_LIBRARY(Module, MetaInfo)                   \</span>
<a name="l00629"></a>00629 <span class="preprocessor">  class Module##_StaticInit                                             \</span>
<a name="l00630"></a>00630 <span class="preprocessor">  {                                                                     \</span>
<a name="l00631"></a>00631 <span class="preprocessor">  public:                                                               \</span>
<a name="l00632"></a>00632 <span class="preprocessor">    Module##_StaticInit()                                               \</span>
<a name="l00633"></a>00633 <span class="preprocessor">    {                                                                   \</span>
<a name="l00634"></a>00634 <span class="preprocessor">      scfRegisterStaticClasses (MetaInfo);                              \</span>
<a name="l00635"></a>00635 <span class="preprocessor">    }                                                                   \</span>
<a name="l00636"></a>00636 <span class="preprocessor">  } Module##_static_init__;</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>
<a name="l00642"></a><a class="code" href="group__scf.html#gdb920bcb9fd262612c22e061724c89a6">00642</a> <span class="preprocessor">#define SCF_DEFINE_FACTORY_FUNC_REGISTRATION(Class)                     \</span>
<a name="l00643"></a>00643 <span class="preprocessor">  CS_EXPORTED_FUNCTION iBase* CS_EXPORTED_NAME(Class,_Create)(iBase*);  \</span>
<a name="l00644"></a>00644 <span class="preprocessor">  class Class##_StaticInit                                              \</span>
<a name="l00645"></a>00645 <span class="preprocessor">  {                                                                     \</span>
<a name="l00646"></a>00646 <span class="preprocessor">  public:                                                               \</span>
<a name="l00647"></a>00647 <span class="preprocessor">    Class##_StaticInit()                                                \</span>
<a name="l00648"></a>00648 <span class="preprocessor">    {                                                                   \</span>
<a name="l00649"></a>00649 <span class="preprocessor">      scfRegisterStaticFactoryFunc (CS_EXPORTED_NAME(Class,_Create),    \</span>
<a name="l00650"></a>00650 <span class="preprocessor">        #Class);                                                        \</span>
<a name="l00651"></a>00651 <span class="preprocessor">    }                                                                   \</span>
<a name="l00652"></a>00652 <span class="preprocessor">  };</span>
<a name="l00653"></a>00653 <span class="preprocessor"></span>
<a name="l00658"></a><a class="code" href="group__scf.html#gf9c9bd17fc48fdc85bca6e61e4cbf2bd">00658</a> <span class="preprocessor">#define SCF_USE_STATIC_PLUGIN(Module)                                   \</span>
<a name="l00659"></a>00659 <span class="preprocessor">  namespace csStaticPluginInit                                          \</span>
<a name="l00660"></a>00660 <span class="preprocessor">  {                                                                     \</span>
<a name="l00661"></a>00661 <span class="preprocessor">    class Module { public: Module(); };                                 \</span>
<a name="l00662"></a>00662 <span class="preprocessor">    Module Module##_StaticInit;                                         \</span>
<a name="l00663"></a>00663 <span class="preprocessor">  }</span>
<a name="l00664"></a>00664 <span class="preprocessor"></span>
<a name="l00673"></a><a class="code" href="group__scf.html#gec53cd8e948468ebed767538813a5255">00673</a> <span class="preprocessor">#define SCF_REGISTER_FACTORY_FUNC(Class)                                \</span>
<a name="l00674"></a>00674 <span class="preprocessor">  SCF_DEFINE_FACTORY_FUNC_REGISTRATION(Class)                           \</span>
<a name="l00675"></a>00675 <span class="preprocessor">  Class##_StaticInit Class##_static_init__;</span>
<a name="l00676"></a>00676 <span class="preprocessor"></span>
<a name="l00677"></a>00677 <span class="comment">//--------------------------------------------- Class factory interface -----//</span>
<a name="l00678"></a>00678 
<a name="l00692"></a><a class="code" href="structiFactory.html">00692</a> <span class="keyword">struct </span><a class="code" href="structiFactory.html">iFactory</a> : <span class="keyword">public</span> <a class="code" href="structiBase.html">iBase</a>
<a name="l00693"></a>00693 {
<a name="l00695"></a>00695   <span class="keyword">virtual</span> <a class="code" href="structiBase.html">iBase</a> *<a class="code" href="structiFactory.html#592bb898250b05c6124b9abc87bd8921">CreateInstance</a> () = 0;
<a name="l00697"></a>00697   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiFactory.html#1dedd1b3c3696d993e555ae5e25aada2">TryUnload</a> () = 0;
<a name="l00699"></a>00699   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#0331537a32dd5b35cbe5b2c8e45c6974">QueryDescription</a> () = 0;
<a name="l00701"></a>00701   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#c95edc21b753c241a751576fe2215a97">QueryDependencies</a> () = 0;
<a name="l00703"></a>00703   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#9a57f66a4c48ba57b86c26db2520085e">QueryClassID</a> () = 0;
<a name="l00705"></a>00705   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#ac512c8b1401dffda818042be22363dc">QueryModuleName</a> () = 0;
<a name="l00706"></a>00706 };
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 <span class="comment">//----------------------------------------------- Client-side functions -----//</span>
<a name="l00709"></a>00709 
<a name="l00714"></a>00714 <span class="keyword">enum</span>
<a name="l00715"></a>00715 {
<a name="l00716"></a>00716   <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516ef7ecc379419c793962d2cc4ae06834a20">SCF_VERBOSE_NONE</a>            = 0,      
<a name="l00717"></a>00717   <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516ef226c017e1c663ad79d4ae110e954fdab">SCF_VERBOSE_PLUGIN_SCAN</a>     = 1 &lt;&lt; 0, 
<a name="l00718"></a>00718   <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516efc4d29c4a8232380c77b7ebfa374a44b8">SCF_VERBOSE_PLUGIN_LOAD</a>     = 1 &lt;&lt; 1, 
<a name="l00719"></a>00719   <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516efe85c4ef848ab0ce70db90c96fdb9ec68">SCF_VERBOSE_PLUGIN_REGISTER</a> = 1 &lt;&lt; 2, 
<a name="l00720"></a>00720   <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516ef3450fa82dfa27e29b563281bc72777b7">SCF_VERBOSE_CLASS_REGISTER</a>  = 1 &lt;&lt; 3, 
<a name="l00721"></a><a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516efa0bbab9337f8bd67719aca1ce336a3a0">00721</a>   <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516efa0bbab9337f8bd67719aca1ce336a3a0">SCF_VERBOSE_ALL</a>             = ~0      
<a name="l00722"></a>00722 };
<a name="l00723"></a>00723 
<a name="l00739"></a>00739 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ge98856f4527836bbd4b7b02ae670e3b2">scfInitialize</a>(<a class="code" href="classcsPathsList.html">csPathsList</a> <span class="keyword">const</span>* pluginPaths,
<a name="l00740"></a>00740   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> verbose = <a class="code" href="group__scf.html#ggdca29a1140aadadfd92b34a02fa516ef7ecc379419c793962d2cc4ae06834a20">SCF_VERBOSE_NONE</a>);
<a name="l00741"></a>00741 
<a name="l00746"></a>00746 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ge98856f4527836bbd4b7b02ae670e3b2">scfInitialize</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> argv[]);
<a name="l00747"></a>00747 
<a name="l00749"></a>00749 
<a name="l00755"></a>00755 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#g3b12b58d5c2fc9a7b36a5c4c5718ef27">scfRegisterStaticClass</a> (<a class="code" href="group__scf.html#ge49d82becadf11544088dc8c8171b927">scfFactoryFunc</a>, 
<a name="l00756"></a>00756   <span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID, <span class="keyword">const</span> <span class="keywordtype">char</span> *Description, 
<a name="l00757"></a>00757   <span class="keyword">const</span> <span class="keywordtype">char</span> *Dependencies = 0);
<a name="l00758"></a>00758 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ga20c6ebbb93c1a21c60be56193040030">scfRegisterStaticClasses</a> (<span class="keywordtype">char</span> <span class="keyword">const</span>* xml);
<a name="l00759"></a>00759 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#gede22d9826900bc1145db9c888ceb96b">scfRegisterStaticFactoryFunc</a> (<a class="code" href="group__scf.html#ge49d82becadf11544088dc8c8171b927">scfFactoryFunc</a>, 
<a name="l00760"></a>00760   <span class="keyword">const</span> <span class="keywordtype">char</span> *FactClass);
<a name="l00762"></a>00762   
<a name="l00763"></a>00763 <span class="comment">//---------- IMPLEMENTATION OF HELPER FUNCTIONS</span>
<a name="l00764"></a>00764 
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 
<a name="l00770"></a>00770 <span class="keyword">template</span>&lt;<span class="keyword">class</span> Interface, <span class="keyword">class</span> ClassPtr&gt;
<a name="l00771"></a><a class="code" href="group__scf.html#g0928166fc2719b59dbd92068bafd14a6">00771</a> <span class="keyword">inline</span> csPtr&lt;Interface&gt; <a class="code" href="group__scf.html#g0928166fc2719b59dbd92068bafd14a6">scfQueryInterface</a> (ClassPtr object)
<a name="l00772"></a>00772 {
<a name="l00773"></a>00773   Interface *x = (Interface*)object-&gt;QueryInterface (
<a name="l00774"></a>00774     scfInterfaceTraits&lt;Interface&gt;::GetID (),
<a name="l00775"></a>00775     scfInterfaceTraits&lt;Interface&gt;::GetVersion ());
<a name="l00776"></a>00776   <span class="keywordflow">return</span> csPtr&lt;Interface&gt; (x);
<a name="l00777"></a>00777 }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="comment">//Compatibility macro for scfQueryInterface</span>
<a name="l00780"></a><a class="code" href="group__scf.html#gb023901150c04a7b11a531e4c2bedbdc">00780</a> #define <a class="code" href="group__scf.html#gb023901150c04a7b11a531e4c2bedbdc">SCF_QUERY_INTERFACE</a>(Object,Interface) \
<a name="l00781"></a>00781   scfQueryInterface&lt;Interface&gt; (Object)
<a name="l00782"></a>00782 
<a name="l00787"></a>00787 template&lt;class Interface, class ClassPtr&gt;
<a name="l00788"></a><a class="code" href="group__scf.html#g2d0662b86008300d668b015460abbf9e">00788</a> <span class="keyword">inline</span> csPtr&lt;Interface&gt; <a class="code" href="group__scf.html#g2d0662b86008300d668b015460abbf9e">scfQueryInterfaceSafe</a> (ClassPtr object)
<a name="l00789"></a>00789 {
<a name="l00790"></a>00790   <span class="keywordflow">if</span> (object == 0) <span class="keywordflow">return</span> csPtr&lt;Interface&gt; (0);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792   Interface *x = (Interface*)object-&gt;QueryInterface (
<a name="l00793"></a>00793     scfInterfaceTraits&lt;Interface&gt;::GetID (),
<a name="l00794"></a>00794     scfInterfaceTraits&lt;Interface&gt;::GetVersion ());
<a name="l00795"></a>00795   <span class="keywordflow">return</span> csPtr&lt;Interface&gt; (x);
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 <span class="comment">//Compatibility macro for scfQueryInterfaceSafe</span>
<a name="l00798"></a><a class="code" href="group__scf.html#g9ab2528640eb6dc29e8e70ecad15f047">00798</a> #define <a class="code" href="group__scf.html#g9ab2528640eb6dc29e8e70ecad15f047">SCF_QUERY_INTERFACE_SAFE</a>(Object,Interface) \
<a name="l00799"></a>00799   scfQueryInterfaceSafe&lt;Interface&gt; (Object)
<a name="l00800"></a>00800 
<a name="l00804"></a>00804 template&lt;class Interface&gt;
<a name="l00805"></a><a class="code" href="group__scf.html#ge06a0e54fcda77f9bee6cb23dca1bdbc">00805</a> <span class="keyword">inline</span> csPtr&lt;Interface&gt; <a class="code" href="group__scf.html#ge06a0e54fcda77f9bee6cb23dca1bdbc">scfCreateInstance</a> (<span class="keywordtype">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> ClassID)
<a name="l00806"></a>00806 {
<a name="l00807"></a>00807   <a class="code" href="structiBase.html">iBase</a> *base = <a class="code" href="structiSCF.html#1ebbe13c07fe3ac8aa0da357305dcaa2">iSCF::SCF</a>-&gt;<a class="code" href="structiSCF.html#7779ed19c97ac5858d9e2d1d09bdd267">CreateInstance</a> (ClassID);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809   <span class="keywordflow">if</span> (base == 0) <span class="keywordflow">return</span> csPtr&lt;Interface&gt; (0);
<a name="l00810"></a>00810 
<a name="l00811"></a>00811   Interface *x = (Interface*)base-&gt;<a class="code" href="structiBase.html#51605a0d5a6eba49e1e87c5919cefbcf">QueryInterface</a> (
<a name="l00812"></a>00812     scfInterfaceTraits&lt;Interface&gt;::GetID (),
<a name="l00813"></a>00813     scfInterfaceTraits&lt;Interface&gt;::GetVersion ());
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   <span class="keywordflow">if</span> (x) base-&gt;<a class="code" href="structiBase.html#f3df4522cfc0cc41afaff647f43477e4">DecRef</a> (); <span class="comment">//release our base interface</span>
<a name="l00816"></a>00816   <span class="keywordflow">return</span> csPtr&lt;Interface&gt; (x);
<a name="l00817"></a>00817 }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819 <span class="comment">// Compatibility macro for scfCreateInstance function</span>
<a name="l00820"></a><a class="code" href="group__scf.html#gd4a217d5c66c194443e6c3a88672775a">00820</a> #define <a class="code" href="group__scf.html#gd4a217d5c66c194443e6c3a88672775a">SCF_CREATE_INSTANCE</a>(ClassID,Interface) \
<a name="l00821"></a>00821   scfCreateInstance&lt;Interface&gt; (ClassID)
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="comment">// Give versions to above declared classes.</span>
<a name="l00824"></a>00824 <a class="code" href="group__scf.html#g75f6b4b3aed4a05bf45cb8754a76a3df">SCF_VERSION</a> (<a class="code" href="structiFactory.html">iFactory</a>, 0, 0, 2);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="comment">// A bit hacky.</span>
<a name="l00827"></a>00827 <span class="preprocessor">#include "<a class="code" href="reftrackeraccess_8h.html">csutil/reftrackeraccess.h</a>"</span>
<a name="l00828"></a>00828 
<a name="l00831"></a>00831 <span class="preprocessor">#endif // __CSSCF_H__</span>
</pre></div><hr size="1"><address><small>Generated for Crystal Space by 
<a href="http://www.doxygen.org/index.html">doxygen</a> 1.4.5 
</small></address> </div></body> </html>
