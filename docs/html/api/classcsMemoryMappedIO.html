<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Crystal Space: csMemoryMappedIO Class Reference (Crystal Space Public API Reference)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<table border="0" cellpadding="0" cellspacing="0" width="100%" class="head">
 <tr heigth="59">
  <td class="head" width="202" valign="bottom" style="padding-left:0;"><a href="http://www.crystalspace3d.org/"><img src="csblur.png" width="236" height="59" alt="CrystalSpace" border="0"></a></td>
  <td class="head"><h2>Public API Reference</h2></td>
 </tr>
 <tr heigth="11">
  <td colspan="2" class="headshadow" valign="top" style="padding-left:0;"><img src="csblurb.png" width="236" height="11" alt="" border="0"></td>
 </tr>
</table>
<div class="content">
<!-- Generated by Doxygen 1.3.9 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>csMemoryMappedIO Class Reference</h1>Defines a simple memory-mapped IO class that is portable.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="mmapio_8h-source.html">csutil/mmapio.h</a>&gt;</code>
<p>
<a href="classcsMemoryMappedIO-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcsMemoryMappedIO.html#a0">csMemoryMappedIO</a> (unsigned _block_size, char const *filename, <a class="el" href="structiVFS.html">iVFS</a> *vfs=0)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Block size is the size of blocks that you want to get from the file, filename is the name of the file to map.  <a href="#a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcsMemoryMappedIO.html#a1">~csMemoryMappedIO</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroys the mmapio object, closes open files, and releases memory.  <a href="#a1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcsMemoryMappedIO.html#a2">GetPointer</a> (unsigned int index)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This pointer will only be valid for a little while.  <a href="#a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcsMemoryMappedIO.html#a3">IsValid</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true the memory was mapped successfully.  <a href="#a3"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Defines a simple memory-mapped IO class that is portable. 
<p>
Requires that data is organized in fixed block sizes. <p>
Design notes: <p>
1. Although the offset and page in the cache block can both be calculated from either value, I chose to precalculate and store BOTH items. The reason for this is that it avoids one multiplication on each access, and one division when paging data in to cache. For the default values data storage per cache is 8192 bytes with 20 bytes additional overhead. This means that 0.2% of the data is overhead. That's worth it to avoid a heavy op like multiplication <p>
2. Usage of the singly-linked list for storage was chosen over a static array of cache blocks because there's no simple way to provide a direct index into the cache list from the index or page. Since we can probably guarantee that all blocks are NOT going to be in memory at once, we cannot index into the array based on a page index, etc. A sorted list would probably provide the fastest lookup times, but would it be worth the overhead? A hash table provides a number of short lists, which in this case are unsorted. Using QuickSort, lookup on a sorted table of 2048 entries would take about log2(2048) operations. With the default hash table size, each list is about 1.5 entries long if spread uniformly. This means that most lookups on a cache of this size should take between two and four operations per (counting the modulus.) While the hash table does consume about 4k more memory, I think the slight memory usage is worth it, considering the massive speedup. 
<p>

<p>
Definition at line <a class="el" href="mmapio_8h-source.html#l00078">78</a> of file <a class="el" href="mmapio_8h-source.html">mmapio.h</a>.<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="csMemoryMappedIO::csMemoryMappedIO"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">csMemoryMappedIO::csMemoryMappedIO           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned&nbsp;</td>
          <td class="mdname" nowrap> <em>_block_size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char const *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structiVFS.html">iVFS</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>vfs</em> = <code>0</code></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Block size is the size of blocks that you want to get from the file, filename is the name of the file to map. 
<p>
Indexes will be resolved to absolute_index=index*block_size. If you supply a VFS, <code>filename</code> is tried to be resolved to a native path. Otherwise, <code>filename</code> is used as is, hence it must already be a native path.     </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="csMemoryMappedIO::~csMemoryMappedIO"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">csMemoryMappedIO::~<a class="el" href="classcsMemoryMappedIO.html">csMemoryMappedIO</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Destroys the mmapio object, closes open files, and releases memory. 
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a2" doxytag="csMemoryMappedIO::GetPointer"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void* csMemoryMappedIO::GetPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This pointer will only be valid for a little while. 
<p>
Read, at least until the next call to GetPointer. NEVER EVER EVER SAVE THIS POINTER. You must recall this pointer when you want access to the data again.     </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="csMemoryMappedIO::IsValid"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool csMemoryMappedIO::IsValid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns true the memory was mapped successfully. 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li>csutil/<a class="el" href="mmapio_8h-source.html">mmapio.h</a></ul>
<hr size="1"><address><small>Generated for Crystal Space by 
<a href="http://www.doxygen.org/index.html">doxygen</a> 1.3.9 
</small></address> </div></body> </html>
