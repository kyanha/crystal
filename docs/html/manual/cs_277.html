<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: Release Notes 100</TITLE>

<META NAME="description" CONTENT="Crystal Space: Release Notes 100">
<META NAME="keywords" CONTENT="Crystal Space: Release Notes 100">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC815"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_276.html#SEC814"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_278.html#SEC819"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_276.html#SEC814"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_276.html#SEC814"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_285.html#SEC941"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_285.html#SEC941">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H2> C.1 Release Notes from 0.98 to 1.00 </H2>
<!--docid::SEC815::-->
<P>

This section documents the major changes between versions 0.98 and 1.00 of
Crystal Space.
</P><P>

<A NAME="SEC816"></A>
<H3> <CODE>csArray&#60;&#62;</CODE> Index and Size Type Change </H3>
<!--docid::SEC816::-->
<P>

<CODE>csArray&#60;&#62;</CODE> has been changed to use the <CODE>size_t</CODE> instead of
`<SAMP>int</SAMP>' for array sizes and indices.  Probably, the most significant
semantic difference of this change is that `<SAMP>size_t</SAMP>' is <EM>unsigned</EM> as
opposed to `<SAMP>int</SAMP>' which is <EM>signed</EM>.
</P><P>

<STRONG>Read this paragraph carefully.</STRONG> In actual code, this change may result
in nothing more than simple-looking compiler warnings. However, it may have
caused <EM>semantics</EM> to change subtly.
</P><P>

This has the greatest impact in the following areas:
</P><P>

<A NAME="SEC817"></A>
<H4> Iterating Over <CODE>csArray&#60;&#62;</CODE> Contents </H4>
<!--docid::SEC817::-->
<P>

For this purpose, usually, `<SAMP>int</SAMP>' typed variables were used for keeping
track of the index of the current item of an array iteration.  Fixing forward
iteration over a <CODE>csArray&#60;&#62;</CODE> to instead use `<SAMP>size_t</SAMP>' is simple:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; someArray;
for (int i = 0, n = someArray.Length(); i &#60; n; i++)
{
  <small>...</small>
}
</pre></td></tr></table></P><P>

Is changed to:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre><small>...</small>
for (size_t i = 0, n = someArray.Length(); i &#60; n; i++)
<small>...</small>
</pre></td></tr></table></P><P>

Backward iteration is a bit more problematic. As mentioned before, 
`<SAMP>size_t</SAMP>' is unsigned, so you do not have negative values. This can be a
problem in constructs like:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; someArray;
for (int i = someArray.Length() - 1; i &#62;= 0; i--)
{
  <small>...</small>
}
</pre></td></tr></table></P><P>

If the `<SAMP>int</SAMP>' is changed simply to a `<SAMP>size_t</SAMP>', this 
<CODE>for</CODE>-loop misbehaves unexpectedly. When `<SAMP>i</SAMP>' becomes 0, the body 
of the loop is executed correctly. However, decrementing `<SAMP>i</SAMP>' will 
<STRONG>not</STRONG> cause `<SAMP>i</SAMP>' to have a negative value--after all, `<SAMP>size_t</SAMP>'
is unsigned. Instead, decreasing will make `<SAMP>i</SAMP>' wrap around from 0 to
something like 0xffffffff (on 32-bit machines). Clearly, this is greater
than 0, effectively causing an infinite loop. The same thing also happens when
`<SAMP>someArray</SAMP>' has no items (i.e. `<SAMP>someArray.Length() == 0</SAMP>'). Here the
-1 in the initialization of `<SAMP>i</SAMP>' causes wrap-around.
</P><P>

Possible solutions include:
</P><P>

<UL>
<LI>
Use an <CODE>int</CODE>-typed counter variable and cast the array length to
`<SAMP>int</SAMP>'.  This is not entirely elegant, but it does the job in most cases.
<P>

<LI>
Re-write the loop to deal properly with the unsigned nature of `<SAMP>size_t</SAMP>':
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; someArray;
for (size_t i = someArray.Length(); i-- &#62; 0;)
{
  <small>...</small>
}
</pre></td></tr></table></P><P>

This code does the same as the `<SAMP>int</SAMP>' version above, iterating from 
`<SAMP>someArray.Length() - 1</SAMP>' to 0, inclusively. It also correctly works
in the case `<SAMP>someArray.Length() == 0</SAMP>'. The "trick" is to place the 
modification of `<SAMP>i</SAMP>' as a post-decrement in the loop condition. This 
way, as soon as `<SAMP>i</SAMP>' becomes 0, the loop is terminated. The 
post-decrement ensures that `<SAMP>i</SAMP>' has the expected value in the loop body.
</P><P>

</UL>
<P>

<A NAME="SEC818"></A>
<H4> Searching </H4>
<!--docid::SEC818::-->
<P>

Functions like <CODE>csArray&#60;&#62;::FindSortedKey()</CODE> and <CODE>csArray&#60;&#62;::Find()</CODE>
used to return -1 to signify that an item was not found.  This is still the
case, but with a twist.  Now, `<SAMP>(size_t)-1</SAMP>' is returned.  For convenience,
a constant, `<SAMP>csArrayItemNotFound</SAMP>', has been added, which has this exact
value.  It can be used in comparions to make it clear what is actually being
checked.
</P><P>

Apropros comparisons: Recall that `<SAMP>size_t</SAMP>' is <EM>unsigned</EM>, so checking
whether an index returned by `<SAMP>FindSortedKey()</SAMP>' or `<SAMP>Find()</SAMP>' is 
actually a valid index by testing with `<SAMP>&#62;= 0</SAMP>' no longer works since
`<SAMP>(size_t)-1</SAMP>' is always <CODE>&#62;= 0</CODE>. Replace such checks with tests of
equality against `<SAMP>csArrayItemNotFound</SAMP>':
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; someArray;
int index = someArray.Find (<small>...</small>);
if (i &#62;= 0)
{
  /* Item found */
  <small>...</small>
}
else
{
  /* Item not found */
  <small>...</small>
}
</pre></td></tr></table></P><P>

Has to be replaced with:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; someArray;
size_t index = someArray.Find (<small>...</small>);
if (i != csArrayItemNotFound)
{
  /* Item found */
  <small>...</small>
}
else
{
  /* Item not found */
  <small>...</small>
}
</pre></td></tr></table><A NAME="Release Notes 98"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_276.html#SEC814"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_278.html#SEC819"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_276.html#SEC814"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_276.html#SEC814"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_285.html#SEC941"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_285.html#SEC941">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
