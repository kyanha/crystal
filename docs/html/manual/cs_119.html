<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: HOWTO Level Loading</TITLE>

<META NAME="description" CONTENT="Crystal Space: HOWTO Level Loading">
<META NAME="keywords" CONTENT="Crystal Space: HOWTO Level Loading">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC269"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_118.html#SEC266"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_120.html#SEC273"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_101.html#SEC206"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_109.html#SEC222"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_134.html#SEC351"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_285.html#SEC942">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H3> 5.8.10 Loading a Level </H3>
<!--docid::SEC269::-->
<P>

This section describes how you can load a level in your game.
</P><P>

<A NAME="SEC270"></A>
<H4> Getting the Level Loader Plugin </H4>
<!--docid::SEC270::-->
<P>

To load a level you need the level loader plugin. There are two
ways to make sure you have this plugin in your application. You can put
a line in your config file like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>System.Plugins.iLoader = crystalspace.level.loader
</pre></td></tr></table></P><P>

Or you can add the following line to the call to
<CODE>csInitializer::RequestPlugins()</CODE> in your <CODE>main()</CODE> function:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>CS_REQUEST_LEVELLOADER,
</pre></td></tr></table></P><P>

To finally be able to use the level loader in your application you
need to do:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csRef&#60;iLoader&#62; level_loader = CS_QUERY_REGISTRY (object_reg, iLoader);
</pre></td></tr></table></P><P>

When you don't need it anymore you must call <CODE>level_loader-&#62;DecRef ()</CODE>.
</P><P>

<A NAME="SEC271"></A>
<H4> Loading a Map </H4>
<!--docid::SEC271::-->
<P>

Loading a map is simple. You just do:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>VFS-&#62;ChDir ("/lev/mymap");
level_loader-&#62;LoadMapFile ("world");
engine-&#62;Prepare ();
</pre></td></tr></table></P><P>

This will first set the current directory to the right VFS dir
(see section <A HREF="cs_158.html#SEC389">7.2 Virtual File System (VFS)</A>) and then it will load the map file which is called 'world' (this
is not a requirement).
</P><P>

Note that this will clear all other geometry that might have been
loaded in the engine before. If you don't want that then you need to
set the second parameter of <CODE>LoadMapFile</CODE> to <CODE>false</CODE>.
</P><P>

The line <CODE>engine-&#62;Prepare()</CODE> will make sure that everything that
is loaded is correctly set up (i.e. materials and texture will be registered,
lightmaps will be loaded from the cache, ...).
</P><P>

<A NAME="SEC272"></A>
<H4> Include Files        </H4>
<!--docid::SEC272::-->
<P>

The include files useful for this section are:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include "isys/vfs.h"
#include "imap/parser.h"
#include "iengine/engine.h"
</pre></td></tr></table><A NAME="HOWTO Pixmaps"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_118.html#SEC266"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_120.html#SEC273"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_101.html#SEC206"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_109.html#SEC222"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_134.html#SEC351"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_285.html#SEC942">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
