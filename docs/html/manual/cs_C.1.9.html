<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created by texi2html 1.76 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<head>
<title>Crystal Space: C.1.9 Rendering and Drawing Changes</title>

<meta name="description" content="Crystal Space: C.1.9 Rendering and Drawing Changes">
<meta name="keywords" content="Crystal Space: C.1.9 Rendering and Drawing Changes">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.76">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Api100-Rendering-and-Drawing"></a>
<a name="C.1.9"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="cs_C.1.8.html#C.1.8" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.1.10.html#C.1.10" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="cs_C.html#C." title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.1.html#C.1" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="cs_D.html#D." title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="index.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="cs_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="cs_Index.html#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="cs_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> C.1.9 Rendering and Drawing Changes </h3>

<a name="SEC935"></a>
<h4 class="subsubheading"> <code>iGraphics2D</code> Alpha Color Support </h4>

<p><samp>`iGraphics2D'</samp> now supports an alpha channel. <code>iGraphics2D::FindRGB()</code>
accepts an optional alpha value (0 being completely transparent, and
255 being fully opaque) which defaults to 255. All canvases will then blend 
the pixels appropriately if the color depth is 15 bpp or higher. Furthermore, 
as <code>iGraphics2D::Write()</code> also handles alpha in both foreground and 
background colors, it is recommended for transparent backgrounds, instead 
of using <samp>`-1'</samp> as the color value, to obtain a color value from 
<code>FindRGB()</code> that has the same R, G, B components as the foreground color, 
but an alpha component of 0.
</p>
<a name="SEC936"></a>
<h4 class="subsubheading"> Render Buffer Changes </h4>

<p>The <samp>`iRenderBuffer'</samp> interface was made renderer-independant. Consequently,
creation was moved out of <samp>`iGraphics3D'</samp> and into <samp>`csRenderBuffer'</samp> in
the <tt>`csgfx'</tt> module (see <tt>`csgfx/renderbuffer.h'</tt>).  The semantics of
the parameters have changed too: notably, instead of specifying the byte size
of a buffer, the element count is specified. The same change has been made to
<code>CopyToBuffer()</code> (which has been renamed to <code>CopyInto()</code> to enforce
human correction of the arguments).
</p>
<p>More serious changes involve the publication of render buffers by renderers.
Previously meshes provided render buffers via name, and these were mapped using
<em>name</em> &lt;-&gt; <em>OpenGL</em> name mapping. But most meshes only provided a few
standard-named buffers (such as, <samp>`vertices'</samp>, <samp>`texcoords'</samp>, etc.), and
the mapping itself took some time (5%+ per frame). This has been reworked.
</p>
<p>Now, meshes can provide a set of 16 buffers in a fixed structure. Meshes can
provide <samp>`index'</samp>, <samp>`position'</samp> (vertices), <samp>`normal'</samp>, <samp>`color'</samp>,
<samp>`color_lighting'</samp> (pre-lit colors), <samp>`texcoord0'</samp>, <samp>`texcoord1'</samp>,
<samp>`texcoord2'</samp>, <samp>`texcoord3'</samp>, <samp>`texcoord_lightmap'</samp>, <samp>`generic0'</samp>,
<samp>`generic1'</samp>, <samp>`generic2'</samp>, <samp>`generic3'</samp>, <samp>`tangent'</samp> and
<samp>`binormal'</samp> buffers.  At the very least, meshes <em>should</em> provide
<samp>`index'</samp>, <samp>`position'</samp>, and if possible <samp>`texcoord<em>n</em>'</samp>. The old
system with custom named buffers is also supported.
</p>
<p>Both kinds of buffers can be mapped, and the destinations for both kinds of
buffers are the same (listed here): <samp>`position'</samp>, <samp>`normal'</samp>,
<samp>`color'</samp>, <samp>`primary color'</samp> (alias for <samp>`color'</samp>), <samp>`secondary
color'</samp>, <samp>`texture coordinate n'</samp> (where 0 &lt;= n &lt; texture units;
<samp>`texture coordinate'</samp> is alias for n = 0), and <samp>`attribute n'</samp> (where 0
&lt;= n &lt; 16).  Note that you can not map buffers of different kinds (the
<samp>`normal'</samp> and the custom buffers) to same destination; the result is
undefined).
</p>
<p>The normal buffers are named <samp>`position'</samp>, <samp>`normal'</samp>, <samp>`color'</samp>,
<samp>`primary color'</samp>, <samp>`lit color'</samp>, <samp>`texture coordinate n'</samp> (where 0 &lt;=
n &lt; 3), <samp>`texture coordinate lightmap'</samp>, <samp>`generic n'</samp> (where 0 &lt;= n &lt;
3), <samp>`binormal'</samp>, and <samp>`tangent'</samp>. These appear in the
<samp>`source=&quot;<small class="dots">...</small>&quot;'</samp> tag within the <small>XML</small> shader description.
</p>
<p>Mapping of custom buffers is accomplished as so:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">&lt;buffer
  customsource=&quot;custombuffername&quot;
  destination=&quot;texture coordinate 1&quot;
/&gt;
</pre></td></tr></table>

<p>And, mapping of a normal buffer is done this way:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">&lt;buffer
  source=&quot;tangent&quot;
  destination=&quot;texture coordinate 2&quot;
/&gt;
</pre></td></tr></table>
<p>As a convenience, three buffers are mapped automatically by default (as long as
the mesh provides them). They are:
</p>
<ul>
<li>
<samp>`position'</samp> =&gt; <samp>`position'</samp>
</li><li>
<samp>`color'</samp> =&gt; <samp>`primary color'</samp>
</li><li>
<samp>`texture coordinate 0'</samp> =&gt; <samp>`texture coordinate 0'</samp>
</li></ul>

<a name="SEC937"></a>
<h4 class="subsubheading"> Render Priority System </h4>

<p>It is no longer possible to define render priorities in a map file. You can
now only redefine render priorities from the engine <small>API</small>.
See section <a href="cs_4.8.3.html#4.8.3">Render Priorities and Objects in Sectors</a>.
</p>
<a name="SEC938"></a>
<h4 class="subsubheading"> Cg Matrix Bindings </h4>

<p>Previously, the semantics of a Cg vertex program matrix parameter were
determined through the variable name; e.g. a name of <samp>`ModelViewProj'</samp> bound
the combined model view and projection matrix to the variable. This is still
supported but deprecated. Crystal Space now requires Cg 1.3 which allows the
matrix semantics specification in a way similar to other semantics
specification. For example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">uniform float4x4 ModelViewProj
</pre></td></tr></table>

<p>Becomes:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">uniform float4x4 ModelViewProj : state.matrix.mvp
</pre></td></tr></table>
<p>Check the <tt>`data/shaders/'</tt> directory for further examples. For more
detailed information, consult the Cg and <samp>`ARB_vertex_program'</samp>
documentations.
</p>
<a name="SEC939"></a>
<h4 class="subsubheading"> Transform Split </h4>

<p>To allow more control over how geometry is transformed when using shaders the
<samp>`csRenderMesh::object2camera'</samp> has been split into two transforms:
<samp>`object2world'</samp> and <samp>`world2camera'</samp>. The <samp>`object2world'</samp> transform
is sent via a shader variable, while <samp>`world2camera'</samp> is specified via
<code>iGraphics3D::SetWorldToCamera()</code> (but it is also available as a shader
variable to shader programs).
</p>
<hr size="1">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="cs_C.1.8.html#C.1.8" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.1.10.html#C.1.10" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="cs_C.html#C." title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.1.html#C.1" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="cs_D.html#D." title="Next chapter"> &gt;&gt; </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.76</em></a>.
 </font>
 <br>

</p>
</body>
</html>
