<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: MeshObject TerrFunc</TITLE>

<META NAME="description" CONTENT="Crystal Space: MeshObject TerrFunc">
<META NAME="keywords" CONTENT="Crystal Space: MeshObject TerrFunc">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC642"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_224.html#SEC641"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_226.html#SEC648"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_197.html#SEC492"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_207.html#SEC552"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_227.html#SEC653"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_287.html#SEC963">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H3> 7.7.18 Terrain Mesh Object </H3>
<!--docid::SEC642::-->
<P>

<EM>Written by Jorrit Tyberghein,
(<A HREF="mailto:jorrit.tyberghein@uz.kuleuven.ac.be">jorrit.tyberghein@uz.kuleuven.ac.be</A>).</EM>
</P><P>

This mesh object represents a landscape engine. It features four static
LOD levels and dynamic lighting for one directional light. In future
it will also have support for dynamic shadows but this is still a todo
at this moment.
</P><P>

The basic principle behind the terrain engine is that the entire terrain
is divided in a number of blocks. Usually this is equal to 8x8 blocks
for the terrain but this is something that you can control. The division
into blocks is important for three reasons. The first reason is that LOD
selection happens on a block level. i.e. every block is shown at one level
of LOD independent from the other blocks. The second reason is that
visibility culling for terrain engine also works on block granularity (also
the visibility algo itself goes deeper for doing the actual tests). The
last reason for the blocks is that every block can have a separate texture.
This is important because some hardware has texture limitations and you
often want to overlay a very big texture on a landscape. Since very block
has its own texture you can do this easily.
</P><P>

The terrain engine is based on a height function (as opposed to a heightmap
alone). Support for heightmaps is provided too by converting a heightmap
to a height function. But in general you can feed the terrain engine with
any function <CODE>height=heightfunc(x,y)</CODE>. You can also optionally give
a normal function. If not given the landscape engine will calculate normals
from the height function automatically.
</P><P>

Every block is further divided into a grid. For example, with a grid
of 16x16 every block will have 16x16 quads or 16x16x2 triangles at the
highest detail level. The combination of blocks and grids control how
many triangles the entire terrain will have.
</P><P>

The terrain engine supports four levels of LOD which it will use
independently for every block. Level 0 is highest detail. You can control
the distance at which every LOD level kicks in and you can also
control the quality of every level.
</P><P>

The terrain engine supports a visibility algorithm based on a quad-tree.
The visibility algorithm will cull away geometry on a blocks level (i.e.
either an entire block is visible or not). But internally it will use
a quad-tree which can (and should) go deeper than the blocks resolution
to make sure that the visibility testing is fine enough.
</P><P>

Every block has its own texture. You can use a big texture and split it
into individual parts. One part for every block. Crystal Space also has
a texture generation utility which is able to create realistic terrain
textures given several base textures and a heightmap.
</P><P>

The terrain engine also supports one colored directional light without
shadows. In the future we will have support for dynamic shadows.
</P><P>

<A NAME="SEC643"></A>
<H4> Basic Structure             </H4>
<!--docid::SEC643::-->
<P>

The following SCF class names are used (for <CODE>CS_LOAD_PLUGIN()</CODE>):
</P><P>

<UL>
<LI>
Type plugin: `<SAMP>crystalspace.mesh.object.terrfunc</SAMP>'
<LI>
Loader plugin: `<SAMP>crystalspace.mesh.loader.terrfunc</SAMP>'
<LI>
Factory loader plugin: `<SAMP>crystalspace.mesh.loader.factory.terrfunc</SAMP>'
</UL>
<P>

Objects in this plugin implement the following SCF interfaces (get
with <CODE>SCF_QUERY_INTERFACE()</CODE>):
</P><P>

<UL>
<LI>
<EM>MeshObject</EM>
<UL>
<LI>
Implements `<SAMP>iMeshObject</SAMP>'
<LI>
Implements `<SAMP>iTerrFuncState</SAMP>'
</UL>
<LI>
<EM>MeshObjectFactory</EM>
<UL>
<LI>
Implements `<SAMP>iMeshObjectFactory</SAMP>'
</UL>
<LI>
<EM>MeshObjectFactory</EM>
<UL>
<LI>
Implements `<SAMP>iMeshObjectType</SAMP>'
</UL>
</UL>
<P>

<A NAME="SEC644"></A>
<H4> Factory State Interface            </H4>
<!--docid::SEC644::-->
<P>

This plugin has no factory state interface.
</P><P>

<A NAME="SEC645"></A>
<H4> Factory Loader            </H4>
<!--docid::SEC645::-->
<P>

The fire mesh factory loader has no parameters.
</P><P>

<A NAME="SEC646"></A>
<H4> Object State Interface            </H4>
<!--docid::SEC646::-->
<P>

`<SAMP>iTerrFuncState</SAMP>' is the SCF interface that you can
use to set/get settings for a landscape object. The definition of this
interface can be found in `<TT>CS/include/imesh/terrfunc.h</TT>' and that's also
the include file you need to include in your applications to use this plugin.
Using this interface you can access the terrain parameters.
</P><P>

<A NAME="SEC647"></A>
<H4> Object Loader             </H4>
<!--docid::SEC647::-->
<P>

The terrain loader recognizes the following keywords:
</P><P>

<DL COMPACT>
<DT><CODE>&#60;factory&#62;factoryName&#60;/factory&#62;</CODE>
<DD>Name of the factory to use for creation of this instance.
<DT><CODE>&#60;material index="" /&#62;</CODE>
<DD>The material to use for the given block of the terrain. The
block number is 0 to the total number of blocks (see the
`<SAMP>blocks</SAMP>' command).
<DT><CODE>&#60;material&#62;materialName&#60;/material&#62;</CODE>
<DD>The material to use for all blocks of the terrain.
<DT><CODE>&#60;material start="" end=""&#62;materialName%d&#60;/material&#62;</CODE>
<DD>`<SAMP>materialName</SAMP>' is a <CODE>printf</CODE> style string
containing a <CODE>%d</CODE> to indicate the number used for the material
name. `<SAMP>start</SAMP>' and `<SAMP>end</SAMP>' indicate the range of materials
to set (block numbers).
<DT><CODE>&#60;correctseams w="" h="" /&#62;</CODE>
<DD>When the given materials are split from a big texture you can use
`<SAMP>correctseams</SAMP>' to make sure the textures line up correctly at
the borders of blocks. Here is an example. Given a terrain of 8x8
blocks (64 total) and given a texture size of 128x128 for every block
you would have to generate a total big texture with horizontal and
vertical dimensions equal to <CODE>(partsize-2)*8+2</CODE>. In this case (with
partsize equal to 128) this would mean a total texture of 1010x1010 where
every block gets a 128x128 texture where the borders are shared with the
adjacent block (hence the 126x126 that is really allocated for one block).
If you follow these guidelines you can then use <CODE>&#60;correctseams w="128" h="128" /&#62;</CODE>
and you will have perfectly aligned textures for all 8x8 blocks.
<DT><CODE>&#60;blocks x="" y="" /&#62;</CODE>
<DD>The number of blocks in horizontal and vertical direction. Blocks are
important for visibility culling and LOD selection because these happen
on a block level. So you should use enough blocks to make sure that
everything works smoothly. 8x8 is probably a good bet in most cases.
4x4 is a default though.
Warning! Due to a current limitation in the terrain
engine the number of horizontal blocks must be equal to the number of
vertical blocks.
<DT><CODE>&#60;grid x="" y="" /&#62;</CODE>
<DD>With `<SAMP>grid</SAMP>' you control the highest detail resolution of every
block. For example <CODE>&#60;grid x="16 y="16" /&#62;</CODE> means that every block will use
16x16 quads (or 16x16x2 triangles) at highest detail. The default value
for `<SAMP>grid</SAMP>' is 8x8.
<DT><CODE>&#60;topleft x="" y="" z="" /&#62;</CODE>
<DD>The top-left coordinate of the terrain. By default this is (0,0,0).
For `<SAMP>x</SAMP>' and `<SAMP>z</SAMP>' the terrain will be generated from 0 to
`<SAMP>xblocks-1</SAMP>' and `<SAMP>yblocks-1</SAMP>' respectively. Use `<SAMP>scale</SAMP>'
to scale this first and then use `<SAMP>topleft</SAMP>' to relocate.
The `<SAMP>y</SAMP>' value in `<SAMP>topleft</SAMP>' will be added to the height
function (after scaling).
<DT><CODE>&#60;scale x="" y="" z="" /&#62;</CODE>
<DD>Scale the entire terrain. `<SAMP>x</SAMP>' and `<SAMP>z</SAMP>' will scale the
default 0 to `<SAMP>xblocks-1</SAMP>' and `<SAMP>yblocks-1</SAMP>'. The `<SAMP>y</SAMP>'
scale will be used to multiply with the value from the height function.
<DT><CODE>&#60;color red="" green="" blue="" /&#62;</CODE>
<DD>This is the base color which will be added to all triangle of the
terrain. Consider this a kind of ambient lighting. Default is black.
Full bright would be <CODE>1,1,1</CODE>.
<DT><CODE>&#60;dirlight&#62;</CODE>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>	&#60;position x="" y="" z="" /&#62;
	&#60;color red="" green="" blue="" /&#62;
&#60;/dirlight&#62;
</pre></td></tr></table>Set a directional light. <CODE>x,y,z</CODE> is a normal vector for the light.
<CODE>red,green,blue</CODE> is the color of the light.
<DT><CODE>&#60;loddist level="" distance="" /&#62;</CODE>
<DD>Set the distance at which we switch to the given LOD level. LOD
level 0 (highest detail) is always used for very close viewpoints but you
can control distance for levels 1, 2, and 3. Default values are 100,
400, and 800 for the three levels. Note that LOD happens on a
block basis so for every block the distance here will be used to see
what LOD level to select.
<DT><CODE>&#60;lodcost level="" cost="" /&#62;</CODE>
<DD>Set the cost factor to use for going from the previous LOD level
to the new one. High values for `<SAMP>cost</SAMP>' mean that more triangles
will be removed (i.e. better LOD but worse quality). The default
values are <CODE>0.03</CODE>, <CODE>0.08</CODE>, and <CODE>0.2</CODE>. So `<SAMP>loddist</SAMP>'
controls at which distance a new LOD level is selected while
`<SAMP>lodcost</SAMP>' controls the quality of every LOD level. The base
quality (i.e. highest quality) of every block is controlled with the
`<SAMP>grid</SAMP>' command.
<DT><CODE>&#60;quaddepth&#62;quaddepthValue&#60;/quaddepth&#62;</CODE>
<DD>Control the depth of the quad-tree which is used for visibility culling.
This depth is measured from the entire terrain. Usually you make sure
that the depth is high enough so that individual blocks are at least
sub-divided about three extra times. i.e. given a terrain with 8x8 blocks
you would probably want to use a depth of six (which is default). Higher
quadtree depth's will increase the cost of visibility culling but also
increase the accuracy. So a higher depth will be more important for a
slow renderer (software renderer for example).
<DT><CODE>&#60;vistest /&#62;</CODE>
<DD>Enable or disable visibility culling. Default is on.
<DT><CODE>&#60;heightmap&#62;</CODE>
<DD><TABLE><tr><td>&nbsp;</td><td class=example><pre>	&#60;image&#62;imageFile&#60;/image&#62;
	&#60;scale&#62;scaleValue&#60;/scale&#62;
	&#60;shift&#62;shiftValue&#60;/shift&#62;
&#60;/heightmap&#62;
</pre></td></tr></table>Use the given image file as a heightmap for the landscape. Values from
this heightmap will go between 0 and 256. You can alter the range by
playing with `<SAMP>scale</SAMP>' (default 1) and `<SAMP>shift</SAMP>' (default 0).
</DL>
<A NAME="MeshObject Thing"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_224.html#SEC641"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_226.html#SEC648"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_197.html#SEC492"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_207.html#SEC552"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_227.html#SEC653"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_287.html#SEC963">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
