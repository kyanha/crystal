<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created by texi2html 1.76 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<head>
<title>Crystal Space: C.1 Release Notes from 0.98 to 1.00</title>

<meta name="description" content="Crystal Space: C.1 Release Notes from 0.98 to 1.00">
<meta name="keywords" content="Crystal Space: C.1 Release Notes from 0.98 to 1.00">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.76">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Release-Notes-100"></a>
<a name="C.1"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="cs_C.html#C." title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.2.html#C.2" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="cs_C.html#C." title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.html#C." title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="cs_D.html#D." title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="index.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="cs_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="cs_Index.html#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="cs_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="appendixsec"> C.1 Release Notes from 0.98 to 1.00 </h2>


<p><em>Written by Eric Sunshine, <a href="mailto:sunshine@sunshineco.com">sunshine@sunshineco.com</a> and
Frank Richter, <a href="mailto:res@crystalspace3d.org">res@crystalspace3d.org</a>.</em>
</p>
<p>This section documents the major changes between versions 0.98 and 1.00 of
Crystal Space.
</p>
<a name="SEC883"></a>
<h3 class="subheading"> <code>csArray&lt;&gt;</code> Index and Size Type Change </h3>

<p><code>csArray&lt;&gt;</code> has been changed to use <samp>`size_t'</samp> instead of
<samp>`int'</samp> for array sizes and indices.  Probably, the most significant
semantic difference of this change is that <samp>`size_t'</samp> is usually
<em>unsigned</em> as opposed to <samp>`int'</samp> which is <em>signed</em>.
</p>
<p><strong>Read this paragraph carefully.</strong> In actual code, this change may result
in nothing more than simple-looking compiler warnings. However, it may have
caused <em>semantics</em> to change subtly.
</p>
<p>This has the greatest impact in the following areas discussed below.
</p>
<a name="SEC884"></a>
<h4 class="subsubheading"> Iterating Over <code>csArray&lt;&gt;</code> Contents </h4>

<p>For this purpose, usually, <samp>`int'</samp> typed variables were used for keeping
track of the index of the current item of an array iteration.  Fixing forward
iteration over a <code>csArray&lt;&gt;</code> to instead use <samp>`size_t'</samp> is simple:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csArray&lt;...&gt; a;
for (int i = 0, n = a.Length(); i &lt; n; i++)
{
  ...
}
</pre></td></tr></table>

<p>Is changed to:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">...
for (size_t i = 0, n = a.Length(); i &lt; n; i++)
...
</pre></td></tr></table>
<p>Backward iteration is a bit more problematic. As mentioned before,
<samp>`size_t'</samp> typically is unsigned, so you do not have negative values. This
can be a problem in constructs like:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csArray&lt;...&gt; a;
for (int i = a.Length() - 1; i &gt;= 0; i--)
{
  ...
}
</pre></td></tr></table>
<p>If the <samp>`int'</samp> is changed simply to a <samp>`size_t'</samp>, this 
<code>for</code>-loop misbehaves unexpectedly. When <samp>`i'</samp> becomes 0, the body 
of the loop is executed correctly. However, decrementing <samp>`i'</samp> will 
<strong>not</strong> cause <samp>`i'</samp> to have a negative value--after all, <samp>`size_t'</samp>
is unsigned. Instead, decrementing will make <samp>`i'</samp> wrap around from 0 to
0xffffffff (on 32-bit machines). Clearly, this is greater
than 0, effectively causing an infinite loop. The same thing also happens when
<samp>`a'</samp> has no items (i.e. <samp>`a.Length() == 0'</samp>). Here the
-1 in the initialization of <samp>`i'</samp> causes wrap-around.
</p>
<p>Possible solutions include:
</p>
<ul>
<li>
Use an <code>int</code>-typed counter variable and cast the array length to
<samp>`int'</samp>.  This is not entirely elegant, but it does the job in most cases.

</li><li>
Re-write the loop to deal properly with the unsigned nature of <samp>`size_t'</samp>:

<table><tr><td>&nbsp;</td><td><pre class="example">csArray&lt;...&gt; a;
for (size_t i = a.Length(); i-- &gt; 0;)
{
  ...
}
</pre></td></tr></table>
<p>This code does the same as the <samp>`int'</samp> version above, iterating from 
<samp>`a.Length() - 1'</samp> to 0, inclusively. It also correctly works
in the case <samp>`a.Length() == 0'</samp>. The &quot;trick&quot; is to place the 
modification of <samp>`i'</samp> as a post-decrement in the loop condition. This 
way, as soon as <samp>`i'</samp> becomes 0, the loop is terminated. The 
post-decrement ensures that <samp>`i'</samp> has the expected value in the loop body.
</p>
</li></ul>

<a name="SEC885"></a>
<h4 class="subsubheading"> Searching </h4>

<p>Functions like <code>csArray&lt;&gt;::FindSortedKey()</code> and <code>csArray&lt;&gt;::Find()</code>
used to return -1 to signify that an item was not found.  This is still the
case, but with a twist.  Now, <samp>`(size_t)-1'</samp> is returned.  For convenience,
a constant, <samp>`csArrayItemNotFound'</samp>, has been added, which has this exact
value.  It can be used in comparisons to make it clear what is actually being
checked.
</p>
<p>Apropros comparisons: Recall that <samp>`size_t'</samp> is <em>unsigned</em>, so checking
whether an index returned by <samp>`FindSortedKey()'</samp> or <samp>`Find()'</samp> is 
actually a valid index by testing with <samp>`&gt;= 0'</samp> no longer works since
<samp>`(size_t)-1'</samp> is always <code>&gt;= 0</code>. Replace such checks with tests of
equality against <samp>`csArrayItemNotFound'</samp>:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csArray&lt;...&gt; a;
int index = a.Find (...);
if (index &gt;= 0)
{
  /* Item found */
  ...
}
else
{
  /* Item not found */
  ...
}
</pre></td></tr></table>
<p>Must be replaced with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csArray&lt;...&gt; a;
size_t index = a.Find (...);
if (index != csArrayItemNotFound)
{
  /* Item found */
  ...
}
else
{
  /* Item not found */
  ...
}
</pre></td></tr></table>
<a name="SEC886"></a>
<h3 class="subheading"> Texture and Material Preparation </h3>

<p>Texture and material preparation is now fully automatic. It is no longer
necessary to <em>prepare</em> a texture or a material before you can use it. It is
sufficient simply to register the texture or material. This means that the
following functions have been removed (and you can just remove invocations of
them from your applications if you used them):
</p>
<ul>
<li>
<code>iMaterialHandle::Prepare()</code>
</li><li>
<code>iTextureHandle::Prepare()</code>
</li><li>
<code>iTextureManager::PrepareMaterials()</code>
</li><li>
<code>iTextureManager::PrepareTextures()</code>
</li></ul>

<a name="SEC887"></a>
<h3 class="subheading"> Material Registration </h3>

<p>Registering an <samp>`iMaterialWrapper'</samp> with the texture manager is no longer
necessary; any such calls can be removed.
</p>
<a name="SEC888"></a>
<h3 class="subheading"> Input Definitions </h3>

<p>The file <tt>`csutil/inpnames.h'</tt> has been renamed to
<tt>`inputdef.h'</tt>, and the following functions have been removed:
</p>
<ul>
<li>
<code>csTypeOfInputDef()</code>
</li><li>
<code>csParseKeyDef()</code>
</li><li>
<code>csGetKeyDesc()</code>
</li><li>
<code>csParseMouseDef()</code>
</li><li>
<code>csGetMouseDesc()</code>
</li><li>
<code>csParseJoystickDef()</code>
</li><li>
<code>csGetJoystickDesc()</code>
</li></ul>

<p>These functions allowed you to convert a string such as <kbd><kbd>Ctrl</kbd>+A</kbd>,
<samp>`JoystickX'</samp> or <samp>`Alt+Mouse1'</samp> into values describing input events
and vice versa.
</p>
<p>The way to do this is now, however, is to use <samp>`csInputDefinition'</samp>, which
resides in <tt>`csutil/inputdef.h'</tt>. The preferred way to convert a string to a
definition is to construct a <samp>`csInputDefinition'</samp> from a
<samp>`char const*'</samp>; and the preferred way to convert a definition back to a
string (perhaps constructed some other way) is via
<code>csInputDefinition::ToString()</code>.
</p>
<p>There are also static helper methods in <samp>`csInputDefinition'</samp> which accept
arguments in a similar way to the old functions. These are convenience methods
which perform the work of instantiating the object for you:
</p>
<ul>
<li>
<code>csInputDefinition::ParseKey()</code>
</li><li>
<code>csInputDefinition::GetKeyString()</code>
</li><li>
<code>csInputDefinition::ParseOther()</code>
</li><li>
<code>csInputDefinition::GetOtherString()</code>
</li></ul>

<a name="SEC889"></a>
<h3 class="subheading"> Pollution Reduction </h3>

<p>In order to avoid polluting the top-level system include directory, the Crystal
Space header tree is now installed (via <samp>`make install'</samp> or
<samp>`jam install'</samp>) in a subdirectory named <tt>`crystalspace'</tt>, rather than
being installed directly in the top-level system directory. For example,
assuming the default installation location, the Crystal Space headers are now
installed in <tt>`/usr/local/include/crystalspace'</tt>. Previously, they would
have been deposited directly into <tt>`/usr/local/include'</tt>. The
<samp>`cs-config'</samp> utility script properly returns the new header location in
response to the <samp>`--includedir'</samp>, <samp>`--cflags'</samp>, and <samp>`--cxxflags'</samp>
options, so this relocation should be mostly transparent to external projects.
</p>
<p>The following global header files have been renamed in order to avoid possible
conflict with headers installed by other packages.
</p>
<ul>
<li>
<code>platform.h</code> =&gt; <code>csplatform.h</code>
</li><li>
<code>qint.h</code> =&gt; <code>csqint.h</code>
</li><li>
<code>qsqrt.h</code> =&gt; <code>csqsqrt.h</code>
</li><li>
<code>volatile.h</code> =&gt; <code>csconfig.h</code>
</li></ul>

<p>The following symbols have been renamed in order to avoid pollution of the
global namespace.
</p>
<ul>
<li>
<code>BadBraces</code> =&gt; <code>csrxBadBraces</code>
</li><li>
<code>BadPattern</code> =&gt; <code>csrxBadPattern</code>
</li><li>
<code>BadRepetition</code> =&gt; <code>csrxBadRepetition</code>
</li><li>
<code>big_endian_float()</code> =&gt; <code>csBigEndianFloat()</code>
</li><li>
<code>big_endian_long()</code> =&gt; <code>csBigEndianLong()</code>
</li><li>
<code>big_endian_longlong()</code> =&gt; <code>csBigEndianLongLong()</code>
</li><li>
<code>big_endian_short()</code> =&gt; <code>csBigEndianShort()</code>
</li><li>
<code>COMP_BC</code> =&gt; <code>CS_COMPILER_BCC</code>
</li><li>
<code>COMP_GCC</code> =&gt; <code>CS_COMPILER_GCC</code>
</li><li>
<code>COMP_VC</code> =&gt; <code>CS_COMPILER_MSVC</code>
</li><li>
<code>convert_endian()</code> =&gt; <code>csConvertEndian()</code>
</li><li>
<code>DO_MMX</code> =&gt; <code>CS_HAVE_MMX</code>
</li><li>
<code>DO_NASM</code> =&gt; <code>CS_HAVE_NASM</code>
</li><li>
<code>double2longlong()</code> =&gt; <code>csDoubleToLongLong()</code>
</li><li>
<code>ErrBraces</code> =&gt; <code>csrxErrBraces</code>
</li><li>
<code>ErrBrackets</code> =&gt; <code>csrxErrBrackets</code>
</li><li>
<code>ErrCharType</code> =&gt; <code>csrxErrCharType</code>
</li><li>
<code>ErrCollate</code> =&gt; <code>csrxErrCollate</code>
</li><li>
<code>ErrEscape</code> =&gt; <code>csrxErrEscape</code>
</li><li>
<code>ErrParentheses</code> =&gt; <code>csrxErrParentheses</code>
</li><li>
<code>ErrRange</code> =&gt; <code>csrxErrRange</code>
</li><li>
<code>ErrSpace</code> =&gt; <code>csrxErrSpace</code>
</li><li>
<code>ErrSubReg</code> =&gt; <code>csrxErrSubReg</code>
</li><li>
<code>ErrUnknown</code> =&gt; <code>csrxErrUnknown</code>
</li><li>
<code>float2long()</code> =&gt; <code>csFloatToLong()</code>
</li><li>
<code>float2short()</code> =&gt; <code>csFloatToShort()</code>
</li><li>
<code>get_le_float16()</code> =&gt; <code>csGetLittleEndianFloat16()</code>
</li><li>
<code>get_le_float32()</code> =&gt; <code>csGetLittleEndianFloat32()</code>
</li><li>
<code>get_le_long()</code> =&gt; <code>csGetLittleEndianLong()</code>
</li><li>
<code>get_le_short()</code> =&gt; <code>csGetLittleEndianShort()</code>
</li><li>
<code>IgnoreCase</code> =&gt; <code>csrxIgnoreCase</code>
</li><li>
<code>little_endian_float()</code> =&gt; <code>csLittleEndianFloat()</code>
</li><li>
<code>little_endian_long()</code> =&gt; <code>csLittleEndianLong()</code>
</li><li>
<code>little_endian_longlong()</code> =&gt; <code>csLittleEndianLongLong()</code>
</li><li>
<code>little_endian_short()</code> =&gt; <code>csLittleEndianShort()</code>
</li><li>
<code>long2float()</code> =&gt; <code>csLongToFloat()</code>
</li><li>
<code>longlong2double()</code> =&gt; <code>csLongLongToDouble()</code>
</li><li>
<code>MemEntry</code> =&gt; <code>csMemTrackerEntry</code>
</li><li>
<code>MemoryMapFile()</code> =&gt; <code>csMemoryMapFile()</code>
</li><li>
<code>MemoryMapWindow()</code> =&gt; <code>csMemoryMapWindow()</code>
</li><li>
<code>MemTrackerInfo</code> =&gt; <code>csMemTrackerInfo</code>
</li><li>
<code>MemTrackerModule</code> =&gt; <code>csMemTrackerModule</code>
</li><li>
<code>MemTrackerRegistry</code> =&gt; <code>csMemTrackerRegistry</code>
</li><li>
<code>MKDIR()</code> =&gt; <code>CS_MKDIR()</code>
</li><li>
<code>mmioInfo</code> =&gt; <code>csMemMapInfo</code>
</li><li>
<code>__NEED_GENERIC_ISDIR</code> =&gt; <code>CS_USE_CUSTOM_ISDIR</code>
</li><li>
<code>__NEED_OPENDIR_PROTOTYPE</code> =&gt; <code>CS_WIN32_USE_CUSTOM_OPENDIR</code>
</li><li>
<code>NewLine</code> =&gt; <code>csrxNewLine</code>
</li><li>
<code>NoError</code> =&gt; <code>csrxNoError</code>
</li><li>
<code>NoMatch</code> =&gt; <code>csrxNoMatch</code>
</li><li>
<code>NotBOL</code> =&gt; <code>csrxNotBOL</code>
</li><li>
<code>NotEOL</code> =&gt; <code>csrxNotEOL</code>
</li><li>
<code>OS_DOS</code> =&gt; <code>CS_PLATFORM_DOS</code>
</li><li>
<code>OS_MACOSX</code> =&gt; <code>CS_PLATFORM_MACOSX</code>
</li><li>
<code>OS_UNIX</code> =&gt; <code>CS_PLATFORM_UNIX</code>
</li><li>
<code>OS_WIN32</code> =&gt; <code>CS_PLATFORM_WIN32</code>
</li><li>
<code>PATH_DELIMITER</code> =&gt; <code>CS_PATH_DELIMITER</code>
</li><li>
<code>PATH_SEPARATOR</code> =&gt; <code>CS_PATH_SEPARATOR</code>
</li><li>
<code>PROC_arch</code> =&gt; <code>CS_PROCESSOR_arch</code> (where <samp>`arch'</samp> is
<samp>`X86'</samp>, <samp>`M68K'</samp>, etc.)
</li><li>
<code>ProcEventHandler()</code> =&gt; <code>csProcTexEventHandler</code>
</li><li>
<code>QInt()</code> =&gt; <code>csQint()</code>
</li><li>
<code>QInt16()</code> =&gt; <code>csQfixed16()</code>
</li><li>
<code>QInt24()</code> =&gt; <code>csQfixed24()</code>
</li><li>
<code>QInt8()</code> =&gt; <code>csQfixed8()</code>
</li><li>
<code>qisqrt()</code> =&gt; <code>csQisqrt()</code>
</li><li>
<code>QRound()</code> =&gt; <code>csQround()</code>
</li><li>
<code>qsqrt()</code> =&gt; <code>csQsqrt()</code>
</li><li>
<code>RegisterMemoryTrackerModule()</code> =&gt; <code>mtiRegisterModule()</code>
</li><li>
<code>set_le_float16()</code> =&gt; <code>csSetLittleEndianFloat16()</code>
</li><li>
<code>set_le_float32()</code> =&gt; <code>csSetLittleEndianFloat32()</code>
</li><li>
<code>set_le_long()</code> =&gt; <code>csSetLittleEndianLong()</code>
</li><li>
<code>set_le_short()</code> =&gt; <code>csSetLittleEndianShort()</code>
</li><li>
<code>short2float()</code> =&gt; <code>csShortToFloat()</code>
</li><li>
<code>TEMP_DIR</code> =&gt; <code>CS_TEMP_DIR</code>
</li><li>
<code>TEMP_FILE</code> =&gt; <code>CS_TEMP_FILE</code>
</li><li>
<code>UnMemoryMapFile()</code> =&gt; <code>csUnMemoryMapFile()</code>
</li><li>
<code>WIN32_VOLATILE</code> =&gt; <code>CS_WIN32_CSCONFIG</code>
</li></ul>

<a name="SEC890"></a>
<h3 class="subheading"> <tt>`cssysdef.h'</tt> Changes </h3>

<p>The <samp>`CS_SYSDEF_PROVIDE_FACILITY'</samp> macros, which clients would
<code>#define</code> before including <tt>`cssysdef.h'</tt> in order to alter the
behavior of <tt>`cssysdef.h'</tt>, have been removed. Retirement of these macros
eliminates the polymorphic behavior of <tt>`cssysdef.h'</tt>, thus helping to pave
the way toward eventually pre-compiling Crystal Space's headers in order to
reduce overall compilation time.  In addition to removing these macros from
your code, the following table explains what else (if anything) needs to be
done to account for the removal.
</p>
<dl compact="compact">
<dt> <code>CS_SYSDEF_PROVIDE_ACCESS</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_ALLOCA</code></dt>
<dd><p>Use the <samp>`CS_ALLOC_STACK_ARRAY()'</samp> macro, rather than <code>alloca()</code>.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_CASE</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_DIR</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_EXPAND_PATH</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_GETCWD</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_GETOPT</code></dt>
<dd><p>Include <tt>`csutil/getopt.h'</tt>.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_MKDIR</code></dt>
<dd><p>Use the <samp>`CS_MKDIR(path)'</samp> macro to create the directory, rather than the
obsolete <samp>`MKDIR()'</samp> macro.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_PATH</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_SELECT</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_SOCKETS</code></dt>
<dd><p>Include <tt>`csutil/sockets.h'</tt>.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_SOFTWARE2D</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_TEMP</code></dt>
<dd><p>Use the <samp>`CS_TEMP_DIR'</samp> and <samp>`CS_TEMP_FILE'</samp> macros, rather than the
obsolete <samp>`TEMP_DIR'</samp> and <samp>`TEMP_FILE'</samp> macros.
</p></dd>
<dt> <code>CS_SYSDEF_PROVIDE_UNLINK</code></dt>
<dd><p>No additional changes.
</p></dd>
<dt> <code>CS_SYSDEF_VFS_PROVIDE_CHECK_VAR</code></dt>
<dd><p>No additional changes.
</p></dd>
</dl>

<p>The age-old restriction that <tt>`cssysdef.h'</tt> could be included only by source
files (<tt>`.cpp'</tt>) has been lifted. This restriction was an unfortunate
side-effect of the polymorphic behavior of <tt>`cssysdef.h'</tt> in the presence
of various <samp>`CS_SYSDEF_PROVIDE_FACILITY'</samp> macros. It is now safe, even
recommended, to include <tt>`cssysdef.h'</tt> in header files (<tt>`.h'</tt>). Doing so
helps to make header files more self-contained, thus reducing the burden of
clients of those headers.
</p>
<a name="SEC891"></a>
<h3 class="subheading"> Library Consolidation </h3>

<p>In order to simplify end-user documentation and client usage, the Crystal Space
link libraries <tt>`csutil'</tt>, <tt>`csgeom'</tt>, <tt>`csgfx'</tt>, and <tt>`cstool'</tt>
have been merged into a single master library named <tt>`crystalspace'</tt> 
(i.e. <tt>`libcrystalspace.a'</tt> or <samp>`crystalspace.lib'</samp>).
</p>
<p>The tools <samp>`cs-config'</samp> and <samp>`jamtemplate'</samp> (see section <a href="cs_4.22.1.html#4.22.1">Creating an External Crystal Space Application</a>),
documentation, and all other client-oriented utilities have been updated
appropriately to reflect this change. If you had installed Crystal Space
previously, you should manually removed the now obsolete installed libraries
from the installation location (typically, <tt>`${prefix}/lib'</tt>).
</p>
<p>Developers of Crystal Space itself should note that the sources and headers
continue to reside in their separate <tt>`csutil'</tt>, <tt>`csgeom'</tt>, etc.,
directories; and (importantly) the modules themselves remain conceptually
distinct. This will not change. The consolidation of the physical link library
was an end-user convenience.
</p>
<a name="SEC892"></a>
<h3 class="subheading"> Convenience Classes and Libraries </h3>

<p>Crystal Space now publishes several convenience classes and libraries which
eliminate much of the drudgery associated with implementing <small>SCF</small> interfaces
in certain types of common plugin modules. For example, the <samp>`csGraphics2D'</samp>
class implements the <samp>`iGraphics2D'</samp> interface and provides much of the
functionality common to most canvases.  Likewise, the <samp>`csGraphics3D'</samp> class
implements the <samp>`iGraphics3D'</samp> interface and provides much functionality
common to renderers. You are not required to utilize these implementations when
authoring your own plugins, but they are available for your convenience.
</p>
<p>Most of these newly published facilities are bundled in the consolidated master
<tt>`crystalspace'</tt> library, but a few are provided in separate libraries
because they rely upon external resources which may not be present on all
platforms or in all installations. The convenience libraries are:
</p>
<dl compact="compact">
<dt> <code>crystalspace</code></dt>
<dd><p>Canvas, image loader, particle system, renderer, shader, sound loader, and
sound renderer support, in addition to the normal Crystal Space classes and
utilities.
</p></dd>
<dt> <code>crystalspace_directx</code></dt>
<dd><p>DirectX support.
</p></dd>
<dt> <code>crystalspace_macosx</code></dt>
<dd><p>MacOS/X canvas support.
</p></dd>
<dt> <code>crystalspace_opengl</code></dt>
<dd><p>OpenGL support.
</p></dd>
<dt> <code>crystalspace_python</code></dt>
<dd><p>Python support.
</p></dd>
<dt> <code>crystalspace_windows</code></dt>
<dd><p>Windows support.
</p></dd>
</dl>

<p>For a complete list of available convenience classes, consult the header files
in the subdirectories of <tt>`CS/include/csplugincommon'</tt>.
</p>
<a name="SEC893"></a>
<h3 class="subheading"> Convenience Headers </h3>

<p>For convenience, several top-level <em>master header</em> files have been added to
the project. These should simplify client usage by allowing users to choose the
level of granularity which suits them best.  The list of new header files
follows.
</p>
<dl compact="compact">
<dt> <code>crystalspace.h</code></dt>
<dd><p>Nearly all public headers in entire Crystal Space <small>SDK</small>.
</p></dd>
<dt> <code>csgeom.h</code></dt>
<dd><p>Content of <tt>`CS/include/csgeom'</tt>.
</p></dd>
<dt> <code>csgfx.h</code></dt>
<dd><p>Content of <tt>`CS/include/csgfx'</tt>.
</p></dd>
<dt> <code>csplugincommon.h</code></dt>
<dd><p>Content of <tt>`CS/include/csplugincommon'</tt>.
</p></dd>
<dt> <code>cstool.h</code></dt>
<dd><p>Content of <tt>`CS/include/cstool'</tt>.
</p></dd>
<dt> <code>csutil.h</code></dt>
<dd><p>Content of <tt>`CS/include/csutil'</tt>.
</p></dd>
<dt> <code>iaws.h</code></dt>
<dd><p>Content of <tt>`CS/include/iaws'</tt>.
</p></dd>
<dt> <code>iengine.h</code></dt>
<dd><p>Content of <tt>`CS/include/iengine'</tt>.
</p></dd>
<dt> <code>igeom.h</code></dt>
<dd><p>Content of <tt>`CS/include/igeom'</tt>.
</p></dd>
<dt> <code>igraphic.h</code></dt>
<dd><p>Content of <tt>`CS/include/igraphic'</tt>.
</p></dd>
<dt> <code>imap.h</code></dt>
<dd><p>Content of <tt>`CS/include/imap'</tt>.
</p></dd>
<dt> <code>imesh.h</code></dt>
<dd><p>Content of <tt>`CS/include/imesh'</tt>.
</p></dd>
<dt> <code>inetwork.h</code></dt>
<dd><p>Content of <tt>`CS/include/inetwork'</tt>.
</p></dd>
<dt> <code>isound.h</code></dt>
<dd><p>Content of <tt>`CS/include/isound'</tt>.
</p></dd>
<dt> <code>itexture.h</code></dt>
<dd><p>Content of <tt>`CS/include/itexture'</tt>.
</p></dd>
<dt> <code>iutil.h</code></dt>
<dd><p>Content of <tt>`CS/include/iutil'</tt>.
</p></dd>
<dt> <code>ivaria.h</code></dt>
<dd><p>Content of <tt>`CS/include/ivaria'</tt>.
</p></dd>
<dt> <code>ivideo.h</code></dt>
<dd><p>Content of <tt>`CS/include/ivideo'</tt>.
</p></dd>
</dl>

<p>Users new to the <small>SDK</small> will probably want to include <tt>`crystalspace.h'</tt>
since it is simplest; whereas more advanced users may want to include
<tt>`csutil.h'</tt>, <tt>`cstool.h'</tt>, etc.; and power users can continue to include
only the individual headers required by a particular piece of code.
</p>
<p>As a corollary, the old <tt>`CS/include/css.h'</tt> header, which included many,
though not all Crystal Space header files, has been removed. If you require
this type functionality from a header, then include the new
<tt>`crystalspace.h'</tt> instead.
</p>
<p>Be aware that there is a very small set of public headers not included in any
of the master headers. These are omitted from the master headers because they
reference external resources which might not be known or available to all
clients of the master headers. Clients requiring these special-case headers
will need to include them manually, on an as-needed basis, and arrange that the
build system has sufficient knowledge about the external resources to satisfy
the dependencies at build time.  The list of headers which are excluded from
the master headers follows.
</p>
<dl compact="compact">
<dt> <code>csplugincommon/directx/*.h</code></dt>
<dd><p>DirectX-specific.
</p></dd>
<dt> <code>csplugincommon/macosx/*.h</code></dt>
<dd><p>MacOS/X-specific.
</p></dd>
<dt> <code>csplugincommon/opengl/*.h</code></dt>
<dd><p>OpenGL-specific.
</p></dd>
<dt> <code>csplugincommon/win32/*.h</code></dt>
<dd><p>Windows-specific.
</p></dd>
<dt> <code>csutil/archive.h</code></dt>
<dd><p>Requires zlib indirectly via <tt>`csutil/zip.h'</tt>.
</p></dd>
<dt> <code>csutil/getopt.h</code></dt>
<dd><p>Conflicts with platform-supplied <tt>`&lt;getopt.h&gt;'</tt>.
</p></dd>
<dt> <code>csutil/zip.h</code></dt>
<dd><p>Requires zlib; <a href="http://www.gzip.org/zlib/">http://www.gzip.org/zlib/</a>
</p></dd>
<dt> <code>inetwork/vosapi.h</code></dt>
<dd><p>Requires <small>VOS</small>; <a href="http://www.interreality.org/">http://www.interreality.org/</a>
</p></dd>
<dt> <code>ivaria/ode.h</code></dt>
<dd><p>Requires <small>ODE</small>; <a href="http://www.ode.org/">http://www.ode.org/</a>
</p></dd>
<dt> <code>ivideo/wxwin.h</code></dt>
<dd><p>Requires wxWidgets; <a href="http://www.wxwidgets.org/">http://www.wxwidgets.org/</a>
</p></dd>
</dl>

<p>As an example, if you need access to the <samp>`iWxWindow'</samp> interface, then you
must include <tt>`ivideo/wxwin.h'</tt> manually; it will not be included as part of
<tt>`crystalspace.h'</tt> or <tt>`ivideo.h'</tt>. Furthermore, you will need
to let the build system know where it can find the wxWidgets resources (headers
and libraries). Typically, this is done by adding a wxWidgets check to your
project's <tt>`configure'</tt> script; emitting the results of the check to your
<tt>`Jamconfig'</tt> file with the <code>CS_EMIT_BUILD_RESULT()</code> Autoconf macro;
and finally utilizing the result of that check in your project's <tt>`Jamfile'</tt>
by invoking the Jam rule <samp>`ExternalLibs'</samp>. For <small>MSVC</small> project files, the
location of the wxWidgets resources will have to be added as <em>additional
include directories</em> and <em>additional library directories</em>, in the project
settings or globally, to ensure that <small>MSVC</small> will be able to find them.
</p>
<a name="SEC894"></a>
<h3 class="subheading"> Procedural Texture Relocation </h3>
 
<p>Implementations of the standard procedural textures (dots, fire, plasma, etc.)
now reside directly in the <tt>`stdpt'</tt> plugin
(<tt>`CS/plugins/proctex/standard'</tt>), rather than in the <tt>`cstool'</tt>
module. Consequently, the following previously public headers are no longer
available:
</p> 
<ul>
<li>
<code>cstool/prdots.h</code>
</li><li>
<code>cstool/prfire.h</code>
</li><li>
<code>cstool/prplasma.h</code>
</li><li>
<code>cstool/prsky.h</code>
</li><li>
<code>cstool/prwater.h</code>
</li></ul>
 
<p>Likewise, procedural textures can no longer be allocated directly (for
instance, via <samp>`new csProcFire'</samp>).  Instead, you must now use the plugin
system to create such textures. For example:
</p> 
<table><tr><td>&nbsp;</td><td><pre class="example">csRef&lt;iPluginManager&gt; plugin_mgr(
  CS_QUERY_REGISTRY(object_reg, iPluginManager));
csRef&lt;iTextureType&gt; type(CS_QUERY_PLUGIN_CLASS (plugin_mgr,
  &quot;crystalspace.texture.type.fire&quot;, iTextureType));
if (!type)
{
  type = CS_LOAD_PLUGIN(plugin_mgr,
    &quot;crystalspace.texture.type.fire&quot;, iTextureType);
}
csRef&lt;iTextureFactory&gt; fireFact = type-&gt;NewFactory();
csRef&lt;iTextureWrapper&gt; tex = fireFact-&gt;Generate();
csRef&lt;iFireTexture&gt; fire = SCF_QUERY_INTERFACE(tex, iFireTexture);
</pre></td></tr></table> 
<p>Various procedural textures may or may not implement their own custom <small>SCF</small>
interfaces beyond the normal interfaces implemented by all procedural
textures. In the example above, the &quot;fire&quot; texture implements the specialized
<samp>`iFireTexture'</samp>.
</p>
<a name="SEC895"></a>
<h3 class="subheading"> Joystick Corrections </h3>

<p>The implementation of <samp>`iJoystickDriver'</samp> has been fixed to treat joystick
numbers consistently. Previously, on account of buggy implementation, some
parts of the driver considered joystick numbers 0-based, while other parts
considered them 1-based.  It now uniformly treats joystick numbers as
1-based. This is consistent with button numbers for joysticks and mice, which
are also 1-based.
</p>
<a name="SEC896"></a>
<h3 class="subheading"> <code>iGraphics2D</code> Alpha Color Support </h3>

<p><samp>`iGraphics2D'</samp> now supports an alpha channel. <code>iGraphics2D::FindRGB()</code>
accepts an optional alpha value (0 being completely transparent, and
255 being fully opaque) which defaults to 255. All canvases will then blend 
the pixels appropriately if the color depth is 15 bpp or higher. Furthermore, 
as <code>iGraphics2D::Write()</code> also handles alpha in both foreground and 
background colors, it is recommended for transparent backgrounds, instead 
of using <samp>`-1'</samp> as the color value, to obtain a color value from 
<code>FindRGB()</code> that has the same R, G, B components as the foreground color, 
but an alpha component of 0.
</p>
<a name="SEC897"></a>
<h3 class="subheading"> <tt>`csutil/garray.h'</tt> Deprecated </h3>

<p>The <tt>`csutil/garray.h'</tt> file, containing the class 
<code>csDirtyAccessArray&lt;&gt;</code>, has been deprecated in favor of the more sensible
file name <tt>`csutil/dirtyaccessarray.h'</tt>. No functional changes have been
made to the class.
</p>
<a name="SEC898"></a>
<h3 class="subheading"> <code>csList&lt;&gt;::Iterator</code> Normalization </h3>

<p>The behavior of <code>csList&lt;&gt;::Iterator</code> has been normalized so that it
functions identically to all other iterators in Crystal Space.  In the past, a
newly created <code>csList&lt;&gt;::Iterator</code> already pointed at the first element in
the container.  This differed from all other iterator implementations, in which
the first element, like all other elements, is accessed by an invocation of
<code>Next()</code>.
</p>
<p>Old code which accessed the elements of a <code>csList&lt;&gt;::Iterator</code> required a
non-standard idiom, such as:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csList&lt;sometype&gt; list = ...;
csList&lt;sometype&gt;::Iterator it(list);
if (it.HasCurrent())
{
  do_something(*it);         // First value.
  while (it.HasNext())
  {
    do_something(it.Next()); // Remaining values.
  }
}
</pre></td></tr></table>

<p>Or, the slightly less complicated, though still somewhat convoluted:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csList&lt;sometype&gt;::Iterator it(list);
while (it.HasCurrent())
{
  do_something(*it);
  it.Next();
}
</pre></td></tr></table>
<p>Following normalization, <code>csList&lt;&gt;::Iterator</code> now works like all other
iterators throughout the toolkit.  In particular, for forward iteration, all
elements can be accessed via the standard <code>HasNext()</code> / <code>Next()</code>
idiom:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csList&lt;sometype&gt;::Iterator it(list);
while (it.HasNext())
{
  do_something(it.Next());
}
</pre></td></tr></table>

<p>Likewise, for backward iteration, the <code>HasPrevious()</code> / <code>Previous()</code>
idiom works in the obvious and expected inverse fashion.
</p>
<p>Finally, <code>csList&lt;&gt;::Iterator::Next()</code> and <code>Previous()</code> now return
references to contained elements, rather than pointers.  This makes the
interface of <code>csList&lt;&gt;::Iterator</code> internally consistent, as well as
consistent with other iterators throughout the toolkit, in which these methods
return references.
</p>
<a name="SEC899"></a>
<h3 class="subheading"> <code>iDocument</code> Changes </h3>

<p>The <code>iDocument::Parse()</code> method now accepts an optional argument
indicating whether or not extraneous whitespace in <samp>`CS_NODE_TEXT'</samp> nodes
should be condensed.  Most implementations of <samp>`iDocument'</samp> will attempt to
respect this option if possible.  For implementations where it does not make
sense, the option will be ignored.
</p>
<p>Previously, <small>XML</small>-based implementations of the <samp>`iDocument'</samp> interface
condensed whitespace in <samp>`CS_NODE_TEXT'</samp> nodes at <code>Parse()</code> time.  This
is no longer the case.  Whitespace is now preserved by default.  If the new
behavior is unsuitable for your case, use the new argument to
<code>iDocument::Parse()</code> to indicate that whitespace should be condensed.
This change was made in order to conform to the latest <small>XML</small> specification
which states that <small>XML</small> scanners must preserve whitespace by default.
Consult the following documents for more information regarding this issue.
</p>

<p><a href="http://www.w3.org/TR/REC-xml/#sec-white-space">http://www.w3.org/TR/REC-xml/#sec-white-space</a><br>
<a href="http://www.xml.com/axml/notes/AllWSAlways.html">http://www.xml.com/axml/notes/AllWSAlways.html</a>
</p>
<a name="SEC900"></a>
<h3 class="subheading"> Naming Normalization </h3>

<p>The following <small>SCF</small> class names have been normalized in order to be
consistent with the names of all other available &quot;null&quot; and &quot;multiplexer&quot;
plugins:
</p>
<ul>
<li>
<code>crystalspace.mesh.object.nullmesh</code> =&gt;
<code>crystalspace.mesh.object.null</code>
</li><li>
<code>crystalspace.graphics2d.null2d</code> =&gt;
<code>crystalspace.graphics2d.null</code>
</li><li>
<code>crystalspace.documentsystem.multiplex</code> =&gt;
<code>crystalspace.documentsystem.multiplexer</code>
</li><li>
<code>crystalspace.graphic.image.io.multiplex</code> =&gt;
<code>crystalspace.graphic.image.io.multiplexer</code>
</li></ul>

<p>For <small>API</small> consistency and uniformity between container classes, the
following methods have been renamed:
</p>
<ul>
<li>
<code>csArray&lt;&gt;::Length()</code> =&gt; <code>csArray&lt;&gt;::GetSize()</code>
</li><li>
<code>csArray&lt;&gt;::SetLength()</code> =&gt; <code>csArray&lt;&gt;::SetSize()</code>
</li><li>
<code>csHash&lt;&gt;::DeleteAll()</code> =&gt; <code>csHash&lt;&gt;::Empty()</code>
</li><li>
<code>csHash&lt;&gt;::In()</code> =&gt; <code>csHash&lt;&gt;::Contains()</code>
</li><li>
<code>csHash&lt;&gt;::PutFirst()</code> =&gt; <code>csHash&lt;&gt;::PutUnique()</code>
</li><li>
<code>csList&lt;&gt;::FetchPrev()</code> =&gt; <code>csList&lt;&gt;::FetchPrevious()</code>
</li><li>
<code>csList&lt;&gt;::HasPrev()</code> =&gt; <code>csList&lt;&gt;::HasPrevious()</code>
</li><li>
<code>csSet&lt;&gt;::DeleteAll()</code> =&gt; <code>csSet&lt;&gt;::Empty()</code>
</li><li>
<code>csSet&lt;&gt;::In()</code> =&gt; <code>csSet&lt;&gt;::Contains()</code>
</li><li>
<code>csString::Clear()</code> =&gt; <code>csString::Empty()</code>
</li><li>
<code>csString::FindReplace()</code> =&gt; <code>csString::ReplaceAll()</code>
</li><li>
<code>csString::FindStr()</code> =&gt; <code>csString::Find()</code>
</li><li>
<code>csString::Reclaim()</code> =&gt; <code>csString::ShrinkBestFit()</code>
</li><li>
<code>iString::FindReplace()</code> =&gt; <code>iString::ReplaceAll()</code>
</li><li>
<code>iString::FindStr()</code> =&gt; <code>iString::Find()</code>
</li><li>
<code>iStringArray::DeleteAll()</code> =&gt; <code>iStringArray::Empty()</code>
</li><li>
<code>iStringSet::Clear()</code> =&gt; <code>iStringSet::Empty()</code>
</li></ul>


<p>In most cases, the old names listed above are still recognized for backward
compatibility, but they are deprecated, so you probably ought to convert to the
new <small>API</small> at some point. The <small>API</small> of most of the container classes also
has been expanded, so you may want to study the <small>API</small> reference manual to
learn about newly available functionality.
</p>
<p>Likewise, the following global functions have been renamed:
</p>
<ul>
<li>
<code>csFindReplace()</code> =&gt; <code>csReplaceAll()</code>
</li></ul>

<p>For consistency with like-named methods in other <small>SCF</small> interfaces, the
following <samp>`iImage'</samp> methods have been renamed:
</p>
<ul>
<li>
<code>GetKeycolor()</code> =&gt; <code>GetKeyColor()</code>
</li><li>
<code>HasKeycolor()</code> =&gt; <code>HasKeyColor()</code>
</li></ul>

<p>Various methods in <samp>`csIntersect3'</samp> have been renamed in order to improve
consistency and clarity.  In addition, some arguments have been reversed order
so that, for example, a method named <code>SegmentTriangle()</code> will receive
first the segment argument followed by the triangle argument.
</p>
<ul>
<li>
<code>AxisPlane()</code> =&gt; <code>SegmentAxisPlane()</code>
</li><li>
<code>IntersectPolygon()</code> =&gt; <code>PlanePolygon()</code> (plane version)
</li><li>
<code>IntersectPolygon()</code> =&gt; <code>SegmentPolygon()</code> (segment version)
</li><li>
<code>IntersectSegment()</code> =&gt; <code>SegmentFrustum()</code>
</li><li>
<code>IntersectTriangle()</code> =&gt; <code>SegmentTriangle()</code>
</li><li>
<code>Plane()</code> =&gt; <code>SegmentPlane()</code>
</li><li>
<code>Planes()</code> =&gt; <code>SegmentPlanes()</code> (segment version)
</li><li>
<code>Planes()</code> =&gt; <code>ThreePlanes()</code> (three planes version)
</li><li>
<code>XFrustum()</code> =&gt; <code>SegmentXFrustum()</code>
</li><li>
<code>XPlane()</code> =&gt; <code>SegmentXPlane()</code>
</li><li>
<code>YFrustum()</code> =&gt; <code>SegmentYFrustum()</code>
</li><li>
<code>YPlane()</code> =&gt; <code>SegmentYPlane()</code>
</li><li>
<code>Z0Plane()</code> =&gt; <code>SegmentZ0Plane()</code>
</li><li>
<code>ZPlane()</code> =&gt; <code>SegmentZPlane()</code>
</li></ul>

<p>In addition to that the function <code>csMath3::FindIntersection()</code> has been
removed and is replaced with a new <code>csIntersect3::TriangleTriangle()</code>
routine which is faster and more correct.
</p>

<p>The same improvements have been made to <code>csIntersect2</code>:
</p>
<ul>
<li>
<code>IntersectPolygon()</code> =&gt; <code>PlanePolygon()</code> (plane version)
</li><li>
<code>Lines()</code> =&gt; <code>LineLine()</code> (plane version)
</li><li>
<code>Plane()</code> =&gt; <code>SegmentPlane()</code>
</li><li>
<code>PlaneNoTest()</code> =&gt; <code>SegmentPlaneNoTest()</code>
</li><li>
<code>Planes()</code> =&gt; <code>PlanePlane()</code>
</li><li>
<code>Segments()</code> =&gt; <code>SegmentSegment()</code> (plane version)
</li></ul>

<p>The following configuration control macros (most of which are emitted to
<tt>`csconfig.h'</tt> by the Crystal Space <tt>`configure'</tt> script) have been
renamed in order to improve internal naming consistency, and to conform more
closely to naming scheme used by Autoconf.
</p>
<ul>
<li>
<code>CS_HAS_CAL3D</code> =&gt; <code>CS_HAVE_CAL3D</code>
</li><li>
<code>CS_HAS_CMATH_H</code> =&gt; <code>CS_HAVE_CMATH_H</code>
</li><li>
<code>CS_HAS_GLHANDLEARB_T</code> =&gt; <code>CS_HAVE_GLHANDLEARB_T</code>
</li><li>
<code>CS_HAS_INT64_C</code> =&gt; <code>CS_HAVE_INT64_C</code>
</li><li>
<code>CS_HAS_INTMAX_T</code> =&gt; <code>CS_HAVE_INTMAX_T</code>
</li><li>
<code>CS_HAS_INTPTR_T</code> =&gt; <code>CS_HAVE_INTPTR_T</code>
</li><li>
<code>CS_HAS_INTTYPES_H</code> =&gt; <code>CS_HAVE_INTTYPES_H</code>
</li><li>
<code>CS_HAS_MACHINE_SOUNDCARD_H</code> =&gt; <code>CS_HAVE_MACHINE_SOUNDCARD_H</code>
</li><li>
<code>CS_HAS_MEMORY_MAPPED_IO</code> =&gt; <code>CS_HAVE_MEMORY_MAPPED_IO</code>
</li><li>
<code>CS_HAS_POSIX_MMAP</code> =&gt; <code>CS_HAVE_POSIX_MMAP</code>
</li><li>
<code>CS_HAS_REGEX</code> =&gt; <code>CS_HAVE_REGEX</code>
</li><li>
<code>CS_HAS_SOUNDCARD_H</code> =&gt; <code>CS_HAVE_SOUNDCARD_H</code>
</li><li>
<code>CS_HAS_STDINT_H</code> =&gt; <code>CS_HAVE_STDINT_H</code>
</li><li>
<code>CS_HAS_SYS_PARAM_H</code> =&gt; <code>CS_HAVE_SYS_PARAM_H</code>
</li><li>
<code>CS_HAS_SYS_SOUNDCARD_H</code> =&gt; <code>CS_HAVE_SYS_SOUNDCARD_H</code>
</li><li>
<code>CS_HAS_WCHAR_H</code> =&gt; <code>CS_HAVE_WCHAR_H</code>
</li><li>
<code>CS_RTLD_NOW_AVAILABLE</code> =&gt; <code>CS_HAVE_RTLD_NOW</code>
</li></ul>


<p>Likewise, the same normalization has been applied to the
<samp>`CS_USE_FAKE_feature'</samp> macros published by the <tt>`configure'</tt> script, and
the boolean sense of these control macros has been reversed to account for the
name change.
</p>
<ul>
<li>
<code>CS_USE_FAKE_EXPLICIT_KEYWORD</code> =&gt;
<code>CS_HAVE_CXX_KEYWORD_EXPLICIT</code>
</li><li>
<code>CS_USE_FAKE_MATH_H_FLOAT_FUNCS</code> =&gt;
<code>CS_HAVE_MATH_H_FLOAT_FUNCS</code>
</li><li>
<code>CS_USE_FAKE_SOCKLEN_TYPE</code> =&gt; <code>CS_HAVE_SOCKLEN_T</code>
</li><li>
<code>CS_USE_FAKE_TYPENAME_KEYWORD</code> =&gt;
<code>CS_HAVE_CXX_KEYWORD_TYPENAME</code>
</li><li>
<code>CS_USE_FAKE_WCHAR_TYPE</code> =&gt; <code>CS_HAVE_WCHAR_T</code>
</li><li>
<code>CS_USE_FAKE_WCSLEN</code> =&gt; <code>CS_HAVE_WCSLEN</code>
</li></ul>

<p>For consistency with like-named macros (such as <samp>`CS_PROCESSOR_NAME'</samp> and
<samp>`CS_PROCESSOR_arch'</samp>), the following control macros have been renamed:
</p>
<ul>
<li>
<code>CS_PROCSIZE</code> =&gt; <code>CS_PROCESSOR_SIZE</code>
</li></ul>

<p>The <code>csOrdering&lt;&gt;</code> template has been renamed to the more general
<code>csComparator&lt;&gt;</code> to reflect the fact that this template can perform both
ordering and equality comparisons.
</p>
<a name="SEC901"></a>
<h3 class="subheading"> Default <code>csHash&lt;&gt;</code> (and <code>csHashReversible&lt;&gt;</code>) Table Size </h3>

<p>The default hash table size and grow rate has been reduced from 257 and 64 to
23 and 5, respectively, to have hashes use less memory.  If a hash is expected
to contain a large quantity of elements, those two parameters can be tweaked
upon construction of a <code>csHash&lt;&gt;</code> or <code>csHashReversible&lt;&gt;</code>.  Consult
the Public <small>API</small> Documentation of <code>csHash&lt;&gt;</code> for more information.
</p>
<a name="SEC902"></a>
<h3 class="subheading"> <code>iTextureManager::FreeImages()</code> Removal </h3>

<p><code>iTextureManager::FreeImages()</code> has been removed.  It was used to release
the <samp>`iImage'</samp> objects associated with textures with the purpose of freeing
up memory.  This happens automatically now; the images associated with a
texture are released by the renderer as soon as the image data is converted
into the internal texture format (that is, uploaded to the graphics hardware).
</p>
<a name="SEC903"></a>
<h3 class="subheading"> Java Bindings </h3>

<p>The Java bindings for Crystal Space have been fully integrated into the project
and are now well-supported. It is now possible to write Crystal Space program
entirely in Java. See section <a href="cs_4.19.2.html#4.19.2">Java Bindings</a>.
</p>
<p>The Crystal Space Java classes now reside in a package named
<samp>`org.crystalspace3d'</samp> in order to reflect Crystal Space's new official
domain name &quot;crystalspace3d.org&quot;. This replaces the older package name
<samp>`com.crystalspace'</samp>, which itself replaced the much older name
<samp>`net.sourceforge.crystal'</samp>.
</p>
<a name="SEC904"></a>
<h3 class="subheading"> <small>VFS</small> Changes </h3>

<p>At initialization time, <small>VFS</small> now merges all <tt>`vfs.cfg'</tt> files located
during its start-up scan.  Previously, <small>VFS</small> stopped scanning at the first
discovered <tt>`vfs.cfg'</tt>, and loaded only that file.  During the start-up
scan, it searches for a file named <tt>`vfs.cfg'</tt> in the application resource
directory (<code>csGetResourceDir()</code>), then in the directory containing the
application (<code>csGetAppDir()</code>), and finally in the Crystal Space
installation directory (<code>csGetConfigPath()</code>).  The full set of directories
mounted by <small>VFS</small> following the initial configuration file scan is the union
of the entries in all of the discovered <tt>`vfs.cfg'</tt> files.  If there are
conflicting entries, then mounts and variable assignments specified in
configuration files discovered earlier in the scan take precedence over those
discovered later.
</p>
<a name="SEC905"></a>
<h3 class="subheading"> <code>iEvent</code> Changes </h3>

<a name="SEC906"></a>
<h4 class="subsubheading"> Property Bags </h4>

<p>The <code>iEvent::Find()</code> method was renamed to <code>Retrieve()</code> and exhibits
different return value semantics. Rather than returning a mere boolean result,
it now returns one of the <samp>`csEventError'</samp> enumeration constants.  Of
particular note, in the case of success, <code>csEventErrNone</code> is returned,
which has a value of 0. This success value could be misinterpreted as &quot;false&quot;
by the unwary when fixing code to deal with this semantic change. Conditionals
which test if retrieval of an attribute succeeded must be changed to take this
new semantic into account. For instance, code such as the following:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">iEvent* ev = ...;
if (ev-&gt;Find(...))
{
  ...
}
</pre></td></tr></table>

<p>must be changed to perform an explicit test on the return value of
<code>Retrieve()</code>, rather than relying upon default boolean semantics:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">if (ev-&gt;Retrieve(...) == csEventErrNone)
{
  ...
}
</pre></td></tr></table>
<a name="SEC907"></a>
<h4 class="subsubheading"> Mouse, Joystick, and Command event properties </h4>

<p>The <samp>`union'</samp> containing the <samp>`Mouse'</samp>, <samp>`Joystick'</samp>, and <samp>`Command'</samp>
structures has been removed; all event attributes are now stored and accessed
using the <code>Add()</code> and <code>Retrieve()</code> mechanisms.  To ease access to
event data, use the static methods of the <samp>`csMouseEventHelper'</samp>, 
<samp>`csJoystickEventHelper'</samp>, and <samp>`csCommandEventHelper'</samp> classes.  
For example, code such as the following:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">iEvent* ev = ...;
let X = ev-&gt;Mouse.X;
</pre></td></tr></table>

<p>should be changed to:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">iEvent* ev = ...;
let X = csMouseEventHelper::GetX(ev);
</pre></td></tr></table>

<p>See the <small>API</small> documentation for details.
</p>
<a name="SEC908"></a>
<h4 class="subsubheading"> Multiple mice </h4>

<p>There is now support for handling input from more than one mouse.
You can retrieve the identity (basis 1) of the mouse producing a 
mouse event with <code>csMouseEventHelper::GetNumber()</code>.
</p>
<a name="SEC909"></a>
<h4 class="subsubheading"> Joystick and Mouse axes </h4>

<p>Joysticks can now have up to <samp>`CS_MAX_JOYSTICK_AXES'</samp> axes,
and mice can have up to <samp>`CS_MAX_MOUSE_AXES'</samp>.  Their values should
be accessed using the <code>csJoystickEventHelper::GetAxis()</code>
and <code>csMouseEventHelper::GetAxis()</code> functions, respectively,
where both devices and axes are enumerated basis 1.
Each helper class also has <code>GetX()</code> and <code>GetY()</code> methods
available; for joystick events, these are deprecated.
</p>
<a name="SEC910"></a>
<h3 class="subheading"> Old Renderer Architecture Removal </h3>

<p>The old rendering architecture along with the old renderer plugins have been
removed. Additionally, a few plugins, applications, classes, and methods have
been deprecated because they are not applicable to the new rendering
architecture. The results of the old renderer removal are summarized below.
</p>
<a name="SEC911"></a>
<h4 class="subsubheading"> Removed Plugins </h4>

<p>The following plugin modules have been removed:
</p>
<ul>
<li>
<code>terrfunc</code> (<code>crystalspace.mesh.object.terrfunc</code>)
</li><li>
Old <code>gl3d</code> (<tt>`plugins/video/renderer/opengl'</tt>)
</li><li>
Old <code>soft3d</code> (<tt>`plugins/video/renderer/software'</tt>)
</li><li>
Old <code>null3d</code> (<tt>`plugins/video/renderer/null'</tt>)
</li></ul>

<a name="SEC912"></a>
<h4 class="subsubheading"> Removed Application </h4>

<p>The <samp>`perftest'</samp> application has been removed, since it is no longer has any
purpose.  For the future the <samp>`csbench'</samp> application should be extended to
provide more information.
</p>
<a name="SEC913"></a>
<h4 class="subsubheading"> Removed and Renamed Files </h4>

<p>The following files were removed:
</p>
<ul>
<li>
<code>include/ivideo/vbufmgr.h</code>
</li></ul>

<p>The following files in <tt>`data/shader'</tt> were renamed:
</p>
<ul>
<li>
<code>or_lighting.xml</code> =&gt; <code>std_lighting.xml</code>
</li><li>
<code>or_lighting_detail.xml</code> =&gt; <code>std_lighting_detail.xml</code>
</li><li>
<code>or_lighting_detail_add.xml</code> =&gt; <code>std_lighting_detail_add.xml</code>
</li><li>
<code>or_lighting_detail_alpha.xml</code> =&gt;
<code>std_lighting_detail_alpha.xml</code>
</li><li>
<code>or_lighting_portal.xml</code> =&gt; <code>std_lighting_portal.xml</code>
</li></ul>

<a name="SEC914"></a>
<h4 class="subsubheading"> Removed Methods and Classes </h4>

<p>The following methods have been removed from the <samp>`iGraphics3D'</samp> interface:
</p>
<ul>
<li>
<code>ClearCache()</code>
</li><li>
<code>CloseFogObject()</code>
</li><li>
<code>DrawFogPolygon()</code>
</li><li>
<code>DrawPolygonDebug()</code>
</li><li>
<code>DrawPolygonFX()</code>
</li><li>
<code>DrawPolygonMesh()</code>
</li><li>
<code>DrawTriangleMesh()</code>
</li><li>
<code>DumpCache()</code>
</li><li>
<code>GetVertexBufferManager()</code>
</li><li>
<code>GetZBuffAt()</code>
</li><li>
<code>OpenFogObject()</code>
</li></ul>

<p>From <samp>`iRenderView'</samp>, the following fog-related methods have been removed.
Fog is now calculated within the renderer.
</p>
<ul>
<li>
<code>CalculateFogMesh()</code>
</li><li>
<code>CalculateFogPolygon()</code>
</li></ul>

<p>From <samp>`iMeshObject'</samp> and <samp>`iParticle'</samp>, the following rendering-related
methods have been removed:
</p>
<ul>
<li>
<code>Draw()</code>
</li><li>
<code>DrawTest()</code>
</li></ul>

<p>Apart from these methods, the following classes and structures have been
removed or have become private, and are no longer available to client code:
</p>
<ul>
<li>
<code>G3DFogInfo</code>
</li><li>
<code>G3DPolygonDFP</code>
</li><li>
<code>G3DPolygonDPFX</code>
</li><li>
<code>G3DPolygonDPF</code>
</li><li>
<code>G3DPolygonDP</code>
</li><li>
<code>G3DPolygonMesh</code>
</li><li>
<code>G3DTriangleMesh</code>
</li></ul>

<a name="SEC915"></a>
<h3 class="subheading"> Query Macros </h3>

<p>The macro <code>CS_QUERY_REGISTRY_PLUGIN()</code> has been added to
<tt>`iutil/plugin.h'</tt>. This is a convenience macro which embodies the common
idiom of first querying the object-registry for an object implementing some
interface, and then asking the plugin manager to load a plugin supplying the
desired object if it was not found in the object-registry. It also registers
the object with the object-registry if the plugin manager loads it
successfully.
</p>
<a name="SEC916"></a>
<h3 class="subheading"> Random Number Generator Changes </h3>

<p>The global function <code>csFastRandFloat()</code> has been retired.  In its stead is
the new instantiable class <samp>`csRandomFloatGen'</samp>, which is modeled after the
<samp>`csRandomGen'</samp> class.  Unlike the old <code>csFastRandFloat()</code> function
which was shared by all clients, instances of <samp>`csRandomFloatGen'</samp> can be
controlled and seeded individually, thus making it far more flexible and
useful.  (Note that the more general-purpose <samp>`csRandomGen'</samp> class is also
able to vend floating point numbers.)
</p>
<a name="SEC917"></a>
<h3 class="subheading"> <samp>`iImage'</samp> Changes </h3>

<p>The <samp>`iImage'</samp> interface has been reduced to a level where it merely serves
as a container for pixel data; however, the image editing functionality was
only relocated, not removed.
</p>
<p>Forbidding direct manipulation of an <samp>`iImage'</samp>'s pixel data has the 
following consequences:
</p>
<ul>
<li>
The <code>Clone()</code> function was removed. The
<samp>`csImageMemory'</samp> class provides a constructor that copies the pixel data
from another <samp>`iImage'</samp> object, providing a functionality equal to 
<code>Clone()</code>.

</li><li>
To edit the pixel data of an image, create a clone of an image (e.g. a
<samp>`csImageMemory'</samp> as mentioned above) and manipulate the data in the newly
cerated instance.

</li><li>
If the image data is needed in another
format, as the <code>SetFormat()</code> call has been removed from the interface.

</li><li>
The image editing functionality found in methods such as <code>Rescale()</code>,
<code>Sharpen()</code> was moved into the <samp>`csImageManipulate'</samp> class.

</li><li>
The <code>CopyXXX()</code> method that copied an image into another are now provided
by <samp>`csImageMemory'</samp>.
</li></ul>

<p>As a side-effect of these changes, the <samp>`csImageFile'</samp> and 
<samp>`csImageMemory'</samp> were merged and the former removed.
</p>
<a name="SEC918"></a>
<h3 class="subheading"> <samp>`iMaterialList'</samp> Change </h3>

<p>The function <code>iMaterialList::NewMaterial()</code> now needs an additional
name parameter. It is not recommended to change the name later.
</p>
<a name="SEC919"></a>
<h3 class="subheading"> <code>iObjectModel</code> Change </h3>

<p>The function <code>iObjectModel::GetObjectBoundingBox()</code> only has one
parameter now. The optional <samp>`type'</samp> parameter has been removed as it
was not implemented anywhere. In addition to that the constants
<code>CS_BBOX_NORMAL</code>, <code>CS_BBOX_ACCURATE</code>, and <code>CS_BBOX_MAX</code>
are also removed.
</p>
<a name="SEC920"></a>
<h3 class="subheading"> <code>iImageIO::Load()</code> Parameter Change </h3>

<p><code>iImageIO::Load()</code> now requires the image source data in an 
<samp>`iDataBuffer'</samp> object, instead of separate <samp>`buffer'</samp> and <samp>`size'</samp>
parameters.
</p>
<a name="SEC921"></a>
<h3 class="subheading"> <samp>`iLight'</samp> Changes </h3>

<p>The <samp>`iLight'</samp> and its implementation (<samp>`csLight'</samp>) have been extended to
also handle spot- and directional-lights. Note that the accual computation of
lighting does not yet support these, however the engine can now store and
handle the required data.
</p>
<p>There have also been two smaller changes to the interface to make it more
coherent. The influence radius have been renamed <em>cut-off</em> distance, and
thus the methods <code>GetInfluenceRadius()</code> and <code>SetInfluenceRadius()</code>
have been renamed accordingly to <code>GetCutoffDistance()</code> and
<code>SetCutoffDistance()</code>, respectively.  Also, <code>SetAttenuation()</code> has
been renamed to <code>SetAttenuationMode()</code> in order to avoid confusion with
other similary named methods.  For the <code>CS_ATTN_LINEAR</code> attenuation type
the specification has changed slightly. As a default, the distance where light
goes out is same as the cut-off distance, but this can be changed by altering
the first attenuation constant. See comments in
<tt>`CS/include/iengine/light.h'</tt> for exact details of the different
attenuation modes.
</p>
<a name="SEC922"></a>
<h3 class="subheading"> <code>CS_DECLARE_OBJECT_ITERATOR()</code> Removal </h3>

<p>The <samp>`iObject'</samp> iterator creation macro <code>CS_DECLARE_OBJECT_ITERATOR()</code>
has been replaced by the templated class <code>csTypedObjectIterator&lt;&gt;</code>. Given
existing code, such as:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">iObject* parent = ...;
CS_DECLARE_OBJECT_ITERATOR(MyFooIter, iFoo);
MyFooIter iter(parent);
while (iter.HasNext())
{
  iFoo* foo = iter.Next();
  ...
}
</pre></td></tr></table>

<p>Revise the code by instantiating the new template class:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">typedef csTypedObjectIterator&lt;iFoo&gt; MyFooIter;
MyFooIter iter(parent);
while (iter.HasNext())
{
</pre></td></tr></table>

<p>Or, even simpler without the <samp>`typedef'</samp>:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csTypedObjectIterator&lt;iFoo&gt; iter(parent);
while (iter.HasNext())
{
</pre></td></tr></table>
<a name="SEC923"></a>
<h3 class="subheading"> Reference Count Automation </h3>

<p>For consistency with the bulk of the Crystal Space <small>API</small>, and in order to
simplify reference-count management, the following methods have been changed
to return <code>csRef&lt;&gt;</code> rather than raw pointers of which the client had to
dispose manually via <code>DecRef()</code>.
</p>
<ul>
<li>
<code>iEmitFactoryState::CreateBox()</code>
</li><li>
<code>iEmitFactoryState::CreateCone()</code>
</li><li>
<code>iEmitFactoryState::CreateCylinder()</code>
</li><li>
<code>iEmitFactoryState::CreateCylinderTangent()</code>
</li><li>
<code>iEmitFactoryState::CreateFixed()</code>
</li><li>
<code>iEmitFactoryState::CreateLine()</code>
</li><li>
<code>iEmitFactoryState::CreateMix()</code>
</li><li>
<code>iEmitFactoryState::CreateSphere()</code>
</li><li>
<code>iEmitFactoryState::CreateSphereTangent()</code>
</li><li>
<code>iHazeHullCreation::CreateBox()</code>
</li><li>
<code>iHazeHullCreation::CreateCone()</code>
</li></ul>

<a name="SEC924"></a>
<h3 class="subheading"> Render Buffer Changes </h3>

<p>The <samp>`iRenderBuffer'</samp> interface was made renderer-independant. Consequently,
creation was moved out of <samp>`iGraphics3D'</samp> and into <samp>`csRenderBuffer'</samp> in
the <tt>`csgfx'</tt> module (see <tt>`csgfx/renderbuffer.h'</tt>).  The semantics of
the parameters have changed too: notably, instead of specifying the byte size
of a buffer, the element count is specified. The same change has been made to
<code>CopyToBuffer()</code> (which has been renamed to <code>CopyInto()</code> to enforce
human correction of the arguments).
</p>
<p>More serious changes involve the publication of render buffers by renderers.
Previously meshes provided render buffers via name, and these were mapped using
<em>name</em> &lt;-&gt; <em>OpenGL</em> name mapping. But most meshes only provided a few
standard-named buffers (such as, <samp>`vertices'</samp>, <samp>`texcoords'</samp>, etc.), and
the mapping itself took some time (5%+ per frame). This has been reworked.
</p>
<p>Now, meshes can provide a set of 16 buffers in a fixed structure. Meshes can
provide <samp>`index'</samp>, <samp>`position'</samp> (vertices), <samp>`normal'</samp>, <samp>`color'</samp>,
<samp>`color_lighting'</samp> (pre-lit colors), <samp>`texcoord0'</samp>, <samp>`texcoord1'</samp>,
<samp>`texcoord2'</samp>, <samp>`texcoord3'</samp>, <samp>`texcoord_lightmap'</samp>, <samp>`generic0'</samp>,
<samp>`generic1'</samp>, <samp>`generic2'</samp>, <samp>`generic3'</samp>, <samp>`tangent'</samp> and
<samp>`binormal'</samp> buffers.  At the very least, meshes <em>should</em> provide
<samp>`index'</samp>, <samp>`position'</samp>, and if possible <samp>`texcoord<em>n</em>'</samp>. The old
system with custom named buffers is also supported.
</p>
<p>Both kinds of buffers can be mapped, and the destinations for both kinds of
buffers are the same (listed here): <samp>`position'</samp>, <samp>`normal'</samp>,
<samp>`color'</samp>, <samp>`primary color'</samp> (alias for <samp>`color'</samp>), <samp>`secondary
color'</samp>, <samp>`texture coordinate n'</samp> (where 0 &lt;= n &lt; texture units;
<samp>`texture coordinate'</samp> is alias for n = 0), and <samp>`attribute n'</samp> (where 0
&lt;= n &lt; 16).  Note that you can not map buffers of different kinds (the
<samp>`normal'</samp> and the custom buffers) to same destination; the result is
undefined).
</p>
<p>The normal buffers are named <samp>`position'</samp>, <samp>`normal'</samp>, <samp>`color'</samp>,
<samp>`primary color'</samp>, <samp>`lit color'</samp>, <samp>`texture coordinate n'</samp> (where 0 &lt;=
n &lt; 3), <samp>`texture coordinate lightmap'</samp>, <samp>`generic n'</samp> (where 0 &lt;= n &lt;
3), <samp>`binormal'</samp>, and <samp>`tangent'</samp>. These appear in the
<samp>`source=&quot;<small class="dots">...</small>&quot;'</samp> tag within the <small>XML</small> shader description.
</p>
<p>Mapping of custom buffers is accomplished as so:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">&lt;buffer
  customsource=&quot;custombuffername&quot;
  destination=&quot;texture coordinate 1&quot;
/&gt;
</pre></td></tr></table>

<p>And, mapping of a normal buffer is done this way:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">&lt;buffer
  source=&quot;tangent&quot;
  destination=&quot;texture coordinate 2&quot;
/&gt;
</pre></td></tr></table>
<p>As a convenience, three buffers are mapped automatically by default (as long as
the mesh provides them). They are:
</p>
<ul>
<li>
<samp>`position'</samp> =&gt; <samp>`position'</samp>
</li><li>
<samp>`color'</samp> =&gt; <samp>`primary color'</samp>
</li><li>
<samp>`texture coordinate 0'</samp> =&gt; <samp>`texture coordinate 0'</samp>
</li></ul>

<a name="SEC925"></a>
<h3 class="subheading"> String Changes </h3>

<p>The class hierarchy of <samp>`csString'</samp> has changed. Most functionality is now
provided by the new superclass <samp>`csStringBase'</samp>. From this,
<code>csStringFast&lt;&gt;</code> is subclassed, and <samp>`csString'</samp> descends from
<code>csStringFast&lt;&gt;</code>. <code>csStringFast&lt;&gt;</code> is a templated class featuring an
internal character buffer which is used instead of dynamically heap-allocated
memory when the string length is sufficently short (as controlled by the class
template argument). This generalization can make <samp>`csStringFast&lt;&gt;'</samp> (and its
subclass <samp>`csString'</samp>) much faster when used as automatic (stack-allocated)
variables, even when declared inside <samp>`for{}'</samp>-loops, since slow
heap-allocation often can be avoided.
</p>
<p>For simplification purposes, several methods have been removed from
<samp>`csString'</samp> and <samp>`iString'</samp> (when present):
</p>
<ul>
<li>
Static <code>PadFoo()</code> methods. The same functionality can be achieved with
the remaining instance <code>PadFoo()</code> methods.

</li><li>
<code>AsPadFoo()</code> instance methods. The same functionality can be achieved with
the remaining instance <code>PadFoo()</code> methods.

</li><li>
Static integer and float <code>Format()</code> methods.  The same functionality can
be achieved by utilizing the remaining <code>Replace()</code> or <code>Format()</code>
methods.

</li><li>
<code>SetGrowsExponentially()</code> and <code>GetGrowsExponentially()</code>. The same
functionality is provided by <code>SetGrowsBy(0)</code> and <code>GetGrowsBy()</code>.
</li></ul>

<a name="SEC926"></a>
<h3 class="subheading"> <small>RAPID</small> Collision Detection Plugin Removal </h3>

<p>The <small>RAPID</small> collision detection plugin has been removed. In addition to
being slower than the <small>OPCODE</small> plugin and consuming more memory, its license
prevented its use in commercial applications.  You should instead now use the
<small>OPCODE</small> plugin.
</p>
<a name="SEC927"></a>
<h3 class="subheading"> 64-Bit Portability Changes </h3>

<p>Some changes have been made to the Crystal Space <small>API</small> in order to better
support 64-bit hardware, which is now becoming common. Additional changes to
improve 64-bit support have also been made internally, but the internal changes
essentially are transparent to external clients.
</p>
<p>The most significant change to the <small>API</small> involves methods and classes
dealing with data opaquely. Historically, opaque data has been handled using
<samp>`void*'</samp>, and programmers would cast numbers, booleans, and pointers to
<samp>`void*'</samp> when it was necessary to deal with the data in an opaque fashion.
This technique, however, is not portable to 64-bit platforms. For this reason,
the new standard type <samp>`intptr_t'</samp> was introduced. This type is guaranteed
to be large enough to store any integral numeric or pointer value regardless of
the machine's word size.
</p>
<p>Crystal Space now uniformly uses <samp>`intptr_t'</samp>, rather than <samp>`void*'</samp>,
when dealing with opaque data. Upgrading your code to reflect this change is
usually quite simple. Where your code presently declares a variable or casts a
value to <samp>`void*'</samp>, change it to <samp>`intptr_t'</samp>. Likewise, <samp>`void**'</samp>
becomes <samp>`intptr_t*'</samp>. For example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">iGraphics2D canvas = ...;
iEventOutlet* outlet = ...;
outlet-&gt;Broadcast(cscmdCanvasExposed, (void*)canvas);
</pre></td></tr></table>

<p>Becomes:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">outlet-&gt;Broadcast(cscmdCanvasExposed, (intptr_t)canvas);
</pre></td></tr></table>
<p>The event system is impacted by this change. Specifically, the following
methods and data members now deal with <samp>`intptr_t'</samp> rather than <samp>`void*'</samp>
for the opaque &quot;info&quot; member of <code>csevCommand</code>-type events.
</p>
<ul>
<li>
<code>csEvent::csEvent()</code>
</li><li>
<code>csEventCommandData::Info</code>
</li><li>
<code>iEventOutlet::Broadcast()</code>
</li><li>
<code>iEventOutlet::ImmediateBroadcast()</code>
</li></ul>

<p>The <small>AWS</small> plugin (Alternate Windowing System) and its interfaces have been
been updated for 64-bit platform conformance.  Specifically, the following
methods now deal with <samp>`intptr_t'</samp> rather than <samp>`void*'</samp> for all of
<small>AWS</small>'s opaque data needs.
</p>
<ul>
<li>
<code>iAwsComponent::GetProperty()</code>
</li><li>
<code>iAwsComponent::SetProperty()</code>
</li><li>
<code>iAwsParmList::AddOpaque()</code>
</li><li>
<code>iAwsParmList::GetOpaque()</code>
</li><li>
<code>iAwsSink::RegisterTrigger()</code>
</li><li>
<code>iAwsSinkManager::CreateSink()</code>
</li></ul>

<p><small>AWS</small> callback functions (<em>triggers</em>) are likewise impacted. You need to
change the declaration of your triggers to use <samp>`intptr_t'</samp> rather than
<samp>`void*'</samp>. For example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">void MyTrigger(void* sink, iAwsSource* source);
</pre></td></tr></table>

<p>Becomes:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">void MyTrigger(intptr_t sink, iAwsSource* source);
</pre></td></tr></table>
<p>Since converting client <small>AWS</small> code to the new <small>API</small> can be rather onerous
on account of the amount of repetitious manual labor involved, the old
<samp>`void*'</samp> <small>API</small> is still present in <small>AWS</small>, though heavily
deprecated. In the interests of 64-bit portability, the old <small>API</small> will be
removed at some point in the future.  You are encouraged, therefore, to convert
your code to the new <small>API</small>. As an aid to clients in upgrading their code to
the new <small>API</small>, one of two control macros can be defined which will help to
isolate code which needs to be updated.  Defining <samp>`AWS_OBSOLETE_VOIDP'</samp>
(via <samp>`#define'</samp> before including <tt>`iaws/aws.h'</tt>) removes from the
<small>API</small> all methods dealing with <samp>`void*'</samp>, thus invocations of any such
methods will result in compilation errors. Alternately, defining
<samp>`AWS_DEPRECATE_VOIDP'</samp>, will cause invocations of methods dealing with
<samp>`void*'</samp> to generate compilation warnings, assuming that the compiler
supports such deprecation warnings. (Presently, only modern version of the
<small>GNU</small> compiler are so configured.)
</p>
<a name="SEC928"></a>
<h3 class="subheading"> Cg Matrix Bindings </h3>

<p>Previously, the semantics of a Cg vertex program matrix parameter were
determined through the variable name; e.g. a name of <samp>`ModelViewProj'</samp> bound
the combined model view and projection matrix to the variable. This is still
supported but deprecated. Crystal Space now requires Cg 1.3 which allows the
matrix semantics specification in a way similar to other semantics
specification. For example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">uniform float4x4 ModelViewProj
</pre></td></tr></table>

<p>Becomes:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">uniform float4x4 ModelViewProj : state.matrix.mvp
</pre></td></tr></table>
<p>Check the <tt>`data/shaders/'</tt> directory for further examples. For more
detailed information, consult the Cg and <samp>`ARB_vertex_program'</samp>
documentations.
</p>
<a name="SEC929"></a>
<h3 class="subheading"> <small>CSWS</small> Removal </h3>

<p>The long-deprecated Crystal Space Windowing System (<small>CSWS</small>) was removed. 
Instead use <small>AWS</small>. See section <a href="cs_4.20.html#4.20">Alternate Windowing System (<small>AWS</small>)</a>.
</p>
<a name="SEC930"></a>
<h3 class="subheading"> Transform Split </h3>

<p>To allow more control over how geometry is transformed when using shaders the
<samp>`csRenderMesh::object2camera'</samp> has been split into two transforms:
<samp>`object2world'</samp> and <samp>`world2camera'</samp>. The <samp>`object2world'</samp> transform
is sent via a shader variable, while <samp>`world2camera'</samp> is specified via
<code>iGraphics3D::SetWorldToCamera()</code> (but it is also available as a shader
variable to shader programs).
</p>
<a name="SEC931"></a>
<h3 class="subheading"> <samp>`chunklod'</samp> Terrain Removal </h3>

<p>The <samp>`chunklod'</samp> terrain plugin has been removed:
</p>

<p><code>crystalspace.mesh.object.terrain.chunklod</code>
</p>

<p>Instead use the <samp>`bruteblock'</samp> terrain engine.
</p>

<p><code>crystalspace.mesh.object.terrain.bruteblock</code>
</p>
<a name="SEC932"></a>
<h3 class="subheading"> <samp>`csHashMap'</samp> and <samp>`csHashSet'</samp> Removal </h3>

<p>The long-deprecated <samp>`csHashMap'</samp>, <samp>`csHashMapReversible'</samp>, and
<samp>`csHashSet'</samp> classes have been removed. Instead, use the templated classes
<code>csHash&lt;&gt;</code>, <code>csHashReversible&lt;&gt;</code>, and <code>csSet&lt;&gt;</code>.  For
string-related <em>set</em> functionality, you may also want to consider using
<samp>`csStringHash'</samp> and <samp>`csStringSet'</samp>.
</p>
<a name="SEC933"></a>
<h3 class="subheading"> <code>csObjectPool&lt;&gt;</code> Removal </h3>

<p>The <code>csObjectPool&lt;&gt;</code> utility class has been removed since it managed
memory poorly, and failed to invoke the destructor of contained objects at the
time they were recycled via <code>csObjectPool&lt;&gt;::Free()</code>, which meant that the
objects might not release their own resources in a timely fashion.  (It did
correctly destroy the freed objects when the pool itself was destroyed, but
should have been doing so at <code>Free()</code>-time.)
</p>
<p>You can use <code>csBlockAllocator&lt;&gt;</code> (see <tt>`csutil/blockallocator.h'</tt>) as a
drop-in replacement for <code>csObjectPool&lt;&gt;</code> since the <small>API</small> of
<code>csBlockAllocator&lt;&gt;</code> is a proper superset of the <code>csObjectPool&lt;&gt;</code>
<small>API</small>. A global search and replace should be sufficient to account for this
change.
</p>
<a name="SEC934"></a>
<h3 class="subheading"> <samp>`csStringSetIterator'</samp> and <samp>`csStringHashIterator'</samp> Removal </h3>

<p><samp>`csStringSetIterator'</samp> and <samp>`csStringHashIterator'</samp> have been replaced
with the iterator classes <samp>`csStringSet::GlobalIterator'</samp> and
<samp>`csStringHash::GlobalIterator'</samp>, respectively.  Rather than instantiating
iterators directly, you now ask the set or hash for an iterator. This brings
the <samp>`csStringSet'</samp> and <samp>`csStringHash'</samp> <small>API</small>'s in line with other
container classes which vend iterators. Given old code which is using
<samp>`csStringSetIterator'</samp>:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csStringSet set;
// ...populate set...
csStringSetIterator iter(&amp;set);
while (iter.HasNext())
{
  char const* s = iter.Next();
  // ...do something with `s'...
}
</pre></td></tr></table>

<p>Convert it like this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">csStringSet::GlobalIterator iter = set.GetIterator();
while (iter.HasNext())
{
</pre></td></tr></table>

<p>Code using <samp>`csStringHashIterator'</samp> can be fixed using the same simple
transformation.
</p>
<a name="SEC935"></a>
<h3 class="subheading"> Miscellaneous Removals </h3>

<p>The following facilities have been removed because they were unused and/or of
questionable use.
</p>
<ul>
<li>
<code>csCrystalBall</code> and <tt>`csgeom/crysball.h'</tt>
</li><li>
<code>csIndPrint</code> and <tt>`csutil/indprint.h'</tt>
</li><li>
<code>iMaterialHandle</code>.  Use <samp>`iTextureHandle'</samp> or <samp>`iMaterial'</samp> directly
(whichever is more appropriate) to achieve equivalent functionality.
</li><li>
<code>csRenderMeshHolderMultiple</code>. Equivalent functionality can be achieved by 
using <samp>`csFrameDataHolder&lt;csDirtyAccessArray&lt;csRenderMesh*&gt; &gt;'</samp>.
</li></ul>

<a name="SEC936"></a>
<h3 class="subheading"> <code>csRenderMeshHolderSingle</code> Renamed </h3>

<p><samp>`csRenderMeshHolderSingle'</samp> has been renamed to <samp>`csRenderMeshHolder'</samp>
as a consequence of the removal of <samp>`csRenderMeshHolderMultiple'</samp>.
</p>
<a name="SEC937"></a>
<h3 class="subheading"> C++ Standard Conformance </h3>

<p>Crystal Space's public header files are now C++ Language Standard
conformant. This means that Crystal Space-based projects which choose to adhere
strictly to the C++ Language Standard (such as those which employ <em>gcc</em>'s
<samp>`-ansi'</samp> and <samp>`-pedantic'</samp> options) can now include Crystal Space
headers safely.
</p>
<a name="SEC938"></a>
<h3 class="subheading"> <tt>`imap/parser.h'</tt> Deprecated </h3>

<p>All functionality in the header <tt>`imap/parser.h'</tt> was long ago moved to
<tt>`imap/loader.h'</tt>, which declares interfaces to access the Crystal Space
map loader. At that time, <tt>`imap/parser.h'</tt> became a very thin wrapper which
merely included <tt>`imap/loader.h'</tt> and did nothing more. Since
<tt>`imap/parser.h'</tt> has no useful purpose, it is now officially deprecated,
and deprecation warnings have been added. Use <tt>`imap/loader.h'</tt> instead.
</p>
<a name="SEC939"></a>
<h3 class="subheading"> <code>csSet&lt;&gt;</code> Relocation and Changes </h3>

<p>The declaration of <code>csSet&lt;&gt;</code> was moved out from <tt>`csutil/hash.h'</tt> and
into its own header file, <tt>`csutil/set.h'</tt>. The method
<code>csSet&lt;&gt;::GetHash()</code> has likewise been removed since it unnecessarily
exposed an underlying implementation detail of <code>csSet&lt;&gt;</code>.
</p>
<p>However, this implementation detail still affects the use of <code>csSet&lt;&gt;</code> as
for storage of pointers in a <code>csSet&lt;&gt;</code> the <code>csPtrKey&lt;&gt;</code> wrapper must
be used.
</p>
<a name="SEC940"></a>
<h3 class="subheading"> <code>csHash&lt;&gt;</code> Changes </h3>

<p>The way <code>csHash&lt;&gt;</code> handles support for arbitrary key types has been
changed. Previously, a so-called &quot;hash key handler&quot; was passed as an optional
third template parameter that computed hash keys and was able to compare
keys. Now, the hash computation is handled through the new
<code>csHashComputer&lt;&gt;</code> template, and key comparison through
<code>csComparator&lt;&gt;</code>. To provide hash computation and comparisons for specific
types used as hash keys, specializations of the templates mentioned above are
needed. Alternatively the default comparator uses the <samp>`operator &lt;'</samp> and
<samp>`operator &gt;'</samp> operators, so you can also implement those operators instead
of a <code>csComparator&lt;&gt;</code> specialization. The default <code>csHashComputer&lt;&gt;</code>
implementation assumes that a type provides a <samp>`GetHash()'</samp> method that
computes the hash value for an object. However, this means that integral types 
need a specialization. As a convenience, Crystal Space already provides 
specializations of <code>csHashComputer&lt;&gt;</code> for a number of commonly used 
intergrals. Further, <code>csComparator&lt;&gt;</code> and/or <code>csHashComputer&lt;&gt;</code> 
specializations are provided for the commonly used types <samp>`csString'</samp>, 
<samp>`const char*'</samp> and <samp>`csStrKey'</samp>; and the default comparison semantics of 
<samp>`operator &lt;'</samp> and <samp>`operator &gt;'</samp> handle the remaining fundamental types 
and any composite types which provide these operators. Pointers (other than 
<samp>`void*'</samp> for which exists a specialization) as hash keys are a special 
case: to use a pointer of type <samp>`Foo*'</samp> as a hash key, employ 
<samp>`csPtrKey&lt;Foo&gt;'</samp> as the key type in the hash declaration. 
</p>
<a name="SEC941"></a>
<h3 class="subheading"> <code>iConfig</code> Renamed </h3>

<p>The <code>iConfig</code> interface has been renamed to the more fitting 
<code>iPluginConfig</code>, and the containing header from <tt>`iutil/config.h'</tt> to
<code>iutil/pluginconfig.h</code>. Other changes have not been made.
</p>
<a name="SEC942"></a>
<h3 class="subheading"> Changes for Mesh Object Writers </h3>

<p><code>iMeshObject::SetLogicalParent()</code> has been renamed to
<code>iMeshObject::SetMeshWrapper()</code>. Same for <code>GetLogicalParent()</code>.
It also uses a <code>iMeshWrapper</code> instead of <code>iBase</code> as the type
of the parameter.
<code>iMeshObjectFactory::SetLogicalParent()</code> has been renamed to
<code>iMeshObjectFactory::SetMeshFactoryWrapper()</code>.
Same for <code>GetLogicalParent()</code>. It also uses a <code>iMeshFactoryWrapper</code>
instead of <code>iBase</code> as the type of the parameter.
</p>
<a name="SEC943"></a>
<h3 class="subheading"> <code>csRGBVector</code> Removed </h3>

<p>The <code>csRGBVector</code> class has been removed. A <code>csComparator&lt;&gt;</code> 
specialization has been provided, so equivalent functionality can be achieved
by simply using <code>csArray&lt;csRGBcolor*&gt;</code>.
</p>
<hr size="1">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="cs_C.html#C." title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.2.html#C.2" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="cs_C.html#C." title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_C.html#C." title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="cs_D.html#D." title="Next chapter"> &gt;&gt; </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.76</em></a>.
 </font>
 <br>

</p>
</body>
</html>
