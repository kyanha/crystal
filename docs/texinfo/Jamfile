SubDir TOP docs texinfo ;

if $(CMD.MAKEINFO)
{
  Texi2Info manualinfo : cs-unix.txi : info : info manual ;
  FLAGS.MAKEINFO on manualinfo += --output=crystal.info ;
  Help manualinfo : "user manual in Info format" ;
}
  
if $(CMD.TEXI2HTML)
{
  TEXI2HTML.INIT = [ ConcatDirs $(TOP) docs support texi2html.init ] ;
  FLAGS.TEXI2HTML on manualhtml += -init_file=$(TEXI2HTML.INIT) -prefix=cs ;
  Texi2HTML manualhtml : cs-unix.txi : html manual ;
  Help manualhtml : "user manual in HTML format" ;
}

if $(CMD.TEXI2DVI)
{
  Texi2DVI manualdvi : cs-unix.txi : dvi manual ;
  Help manualdvi : "user manual in DVI format" ;
}

if $(CMD.TEXI2DVI) && $(CMD.DVIPS)
{
  Texi2PS manualps : cs-unix.txi : ps manual ;
  Help manualps : "user manual in PS format" ;
}

if $(CMD.TEXI2DVI) && $(CMD.DVIPDF)
{
  Texi2PDF manualpdf : cs-unix.txi : pdf manual ;
  Help manualpdf : "user manual in PDF format" ;
}

if $(PERL)
{
  NODEFIX = [ ConcatDirs $(TOP) docs support nodefix.pl ] ;

  rule RepairNodes
  {
    Depends $(<) : $(>) ;
    NotFile $(<) ;
    Always $(<) ;
    TEXINFO.INCDIR on $(<) = $(3) ;
  }

  actions RepairNodes
  {
    $(PERL) "$(NODEFIX)" --include-dir="$(TEXINFO.INCDIR)" "$(>)" ;
  }

  RepairNodes repairdoc : cs-unix.txi : $(SUBDIR) ;
  Help repairdoc : "Repair Texinfo @node and @menu directives" : verbatim ;
}
