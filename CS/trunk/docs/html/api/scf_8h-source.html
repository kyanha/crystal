<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Crystal Space: csutil/scf.h Source File (Crystal Space Public API Reference)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<table border="0" cellpadding="0" cellspacing="0" width="100%" class="head">
 <tr heigth="59">
  <td class="head" width="202" valign="bottom" style="padding-left:0;"><a href="http://www.crystalspace3d.org/"><img src="csblur.png" width="236" height="59" alt="CrystalSpace" border="0"></a></td>
  <td class="head"><h2>Public API Reference</h2></td>
 </tr>
 <tr heigth="11">
  <td colspan="2" class="headshadow" valign="top" style="padding-left:0;"><img src="csblurb.png" width="236" height="11" alt="" border="0"></td>
 </tr>
</table>
<div class="content">
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000022.html">csutil</a></div>
<h1>scf.h</h1><a href="scf_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">    Crystal Space Shared Class Facility (SCF)</span>
00003 <span class="comment">    Copyright (C) 1999 by Andrew Zabolotny</span>
00004 <span class="comment"></span>
00005 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">    modify it under the terms of the GNU Library General Public</span>
00007 <span class="comment">    License as published by the Free Software Foundation; either</span>
00008 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00009 <span class="comment"></span>
00010 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00011 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00013 <span class="comment">    Library General Public License for more details.</span>
00014 <span class="comment"></span>
00015 <span class="comment">    You should have received a copy of the GNU Library General Public</span>
00016 <span class="comment">    License along with this library; if not, write to the Free</span>
00017 <span class="comment">    Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
00018 <span class="comment">*/</span>
00019 
00020 <span class="preprocessor">#ifndef __CSSCF_H__</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define __CSSCF_H__</span>
00022 <span class="preprocessor"></span>
00023 <span class="preprocessor">#include "csextern.h"</span>
00024 
<a name="l00033"></a><a class="code" href="group__scf.html#ga0">00033</a> <span class="keyword">class </span><a class="code" href="classcsPathsList.html">csPathsList</a>;
00034 
00035 <span class="preprocessor">#include "<a class="code" href="ref_8h.html">ref.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="array_8h.html">array.h</a>"</span>
00037 
00041 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="group__scf.html#ga0">scfInterfaceID</a>;
00042 
00047 <span class="preprocessor">#ifdef SCF_DEBUG</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#  define SCF_TRACE(x)                                                  \</span>
00049 <span class="preprocessor">   {                                                                    \</span>
00050 <span class="preprocessor">     printf ("SCF [%s:%d]:\n", __FILE__, (int)__LINE__);                \</span>
00051 <span class="preprocessor">     printf x; SCF_PRINT_CALL_ADDRESS                                   \</span>
00052 <span class="preprocessor">   }</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00054"></a><a class="code" href="group__scf.html#ga18">00054</a> <span class="preprocessor"></span><span class="preprocessor">#  define SCF_TRACE(x)</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span>
00061 <span class="preprocessor">#if (__GNUC__ &gt;= 3) || ((__GNUC__ &gt;= 2) &amp;&amp; (__GNUC_MINOR__ &gt;= 8))</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#  define SCF_PRINT_CALL_ADDRESS                                        \</span>
00063 <span class="preprocessor">   printf ("  Called from address %p\n", __builtin_return_address (0));</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00065"></a><a class="code" href="group__scf.html#ga19">00065</a> <span class="preprocessor"></span><span class="preprocessor">#  define SCF_PRINT_CALL_ADDRESS</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
<a name="l00069"></a><a class="code" href="group__scf.html#ga20">00069</a> <span class="preprocessor">#define SCF_CONSTRUCT_VERSION(Major,Minor,Micro)                        \</span>
00070 <span class="preprocessor">  ((Major &lt;&lt; 24) | (Minor &lt;&lt; 16) | Micro)</span>
00071 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="structiBase.html">00077</a> <span class="keyword">struct </span><a class="code" href="structiBase.html">iBase</a>
00078 {
00079 <span class="comment">// Jorrit: removed the code below as it causes 'pure virtual' method</span>
00080 <span class="comment">// calls to happen upon destruction.</span>
00081 <span class="comment">//protected:</span>
00084 <span class="comment"></span>  <span class="comment">//virtual ~iBase() {}</span>
00085 <span class="keyword">public</span>:
00087   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiBase.html#a0">IncRef</a> () = 0;
00089   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiBase.html#a1">DecRef</a> () = 0;
00091   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="structiBase.html#a2">GetRefCount</a> () = 0;
00093   <span class="keyword">virtual</span> <span class="keywordtype">void</span> *<a class="code" href="structiBase.html#a3">QueryInterface</a> (<a class="code" href="group__scf.html#ga0">scfInterfaceID</a> iInterfaceID, <span class="keywordtype">int</span> iVersion) = 0;
<a name="l00098"></a><a class="code" href="structiBase.html#e0">00098</a>   <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="structiBase.html#e0">QueryInterfaceSafe</a> (<a class="code" href="structiBase.html">iBase</a>* ibase, <a class="code" href="group__scf.html#ga0">scfInterfaceID</a> iInterfaceID,
00099         <span class="keywordtype">int</span> iVersion)
00100   {
00101     <span class="keywordflow">if</span> (ibase == 0) <span class="keywordflow">return</span> 0;
00102     <span class="keywordflow">else</span> <span class="keywordflow">return</span> ibase-&gt;<a class="code" href="structiBase.html#a3">QueryInterface</a> (iInterfaceID, iVersion);
00103   }
00105   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiBase.html#a4">AddRefOwner</a> (<a class="code" href="structiBase.html">iBase</a>** ref_owner) = 0;
00107   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiBase.html#a5">RemoveRefOwner</a> (<a class="code" href="structiBase.html">iBase</a>** ref_owner) = 0;
00108 };
00109 
00110 <span class="preprocessor">#ifdef CS_REF_TRACKER</span>
00111 <span class="preprocessor"></span><span class="preprocessor"> #include &lt;typeinfo&gt;</span>
00112 <span class="preprocessor"> #define CS_TYPENAME(x)             typeid(x).name()</span>
00113 <span class="preprocessor"></span> <span class="comment">/* @@@ HACK: Force an AddAlias() call for every contained interface</span>
00114 <span class="comment">  * However, when iSCF::SCF == 0, don't call QI to prevent interface ID </span>
00115 <span class="comment">  * resolution (which will fail).</span>
00116 <span class="comment">  */</span>
00117 <span class="preprocessor"> #define SCF_INIT_TRACKER_ALIASES    \</span>
00118 <span class="preprocessor">  if (iSCF::SCF != 0) QueryInterface ((scfInterfaceID)-1, -1);</span>
00119 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00120 <span class="preprocessor"></span><span class="preprocessor"> #define CS_TYPENAME(x)             0</span>
00121 <span class="preprocessor"></span><span class="preprocessor"> #define SCF_INIT_TRACKER_ALIASES</span>
00122 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00123 <span class="preprocessor"></span>
<a name="l00128"></a><a class="code" href="group__scf.html#ga23">00128</a> <span class="preprocessor">#define SCF_DECLARE_IBASE                                               \</span>
00129 <span class="preprocessor">  int scfRefCount;              </span><span class="comment">/* Reference counter */</span>                 \
00130   csArray&lt;iBase**&gt;* scfWeakRefOwners;                                   \
00131   void scfRemoveRefOwners ();                                           \
00132   SCF_DECLARE_EMBEDDED_IBASE (iBase)
00133 
<a name="l00138"></a><a class="code" href="group__scf.html#ga24">00138</a> <span class="preprocessor">#define SCF_DECLARE_EMBEDDED_IBASE(OuterClass)                          \</span>
00139 <span class="preprocessor">public:                                                                 \</span>
00140 <span class="preprocessor">  OuterClass *scfParent;        </span><span class="comment">/* The parent object */</span>                 \
00141   virtual void IncRef ();                                               \
00142   virtual void DecRef ();                                               \
00143   virtual int GetRefCount ();                                           \
00144   virtual void AddRefOwner (iBase** ref_owner);                         \
00145   virtual void RemoveRefOwner (iBase** ref_owner);                      \
00146   virtual void *QueryInterface (scfInterfaceID iInterfaceID, int iVersion)
00147 
<a name="l00157"></a><a class="code" href="group__scf.html#ga25">00157</a> <span class="preprocessor">#define SCF_CONSTRUCT_IBASE(Parent)                                     \</span>
00158 <span class="preprocessor">  csRefTrackerAccess::TrackConstruction (this);                         \</span>
00159 <span class="preprocessor">  csRefTrackerAccess::SetDescription (this, CS_TYPENAME(*this));        \</span>
00160 <span class="preprocessor">  scfRefCount = 1;                                                      \</span>
00161 <span class="preprocessor">  scfWeakRefOwners = 0;                                                 \</span>
00162 <span class="preprocessor">  scfParent = Parent; if (scfParent) scfParent-&gt;IncRef();               \</span>
00163 <span class="preprocessor">  SCF_INIT_TRACKER_ALIASES                                              </span>
00164 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="group__scf.html#ga26">00174</a> <span class="preprocessor">#define SCF_CONSTRUCT_EMBEDDED_IBASE(Interface)                         \</span>
00175 <span class="preprocessor">  Interface.scfParent = this;                                           \</span>
00176 <span class="preprocessor">  csRefTrackerAccess::AddAlias (&amp;Interface, this);</span>
00177 <span class="preprocessor"></span>
<a name="l00183"></a><a class="code" href="group__scf.html#ga27">00183</a> <span class="preprocessor">#define SCF_DESTRUCT_IBASE()                                            \</span>
00184 <span class="preprocessor">  csRefTrackerAccess::TrackDestruction (this, scfRefCount);             \</span>
00185 <span class="preprocessor">  scfRemoveRefOwners ();</span>
00186 <span class="preprocessor"></span>
<a name="l00193"></a><a class="code" href="group__scf.html#ga28">00193</a> <span class="preprocessor">#define SCF_DESTRUCT_EMBEDDED_IBASE(Interface)                          \</span>
00194 <span class="preprocessor">  csRefTrackerAccess::RemoveAlias (&amp;Interface, this);                   \</span>
00195 <span class="preprocessor">  Interface.scfParent = 0;</span>
00196 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="group__scf.html#ga29">00202</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_INCREF(Class)                               \</span>
00203 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
00204 <span class="preprocessor">{                                                                       \</span>
00205 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;IncRef (%d)\n", #Class, this, scfRefCount + 1));\</span>
00206 <span class="preprocessor">  csRefTrackerAccess::TrackIncRef (this, scfRefCount);                  \</span>
00207 <span class="preprocessor">  scfRefCount++;                                                        \</span>
00208 <span class="preprocessor">}</span>
00209 <span class="preprocessor"></span>
<a name="l00218"></a><a class="code" href="group__scf.html#ga30">00218</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_DECREF(Class)                               \</span>
00219 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
00220 <span class="preprocessor">{                                                                       \</span>
00221 <span class="preprocessor">  csRefTrackerAccess::TrackDecRef (this, scfRefCount);                  \</span>
00222 <span class="preprocessor">  if (scfRefCount == 1)                                                 \</span>
00223 <span class="preprocessor">  {                                                                     \</span>
00224 <span class="preprocessor">    SCF_TRACE ((" delete (%s *)%p\n", #Class, this));                   \</span>
00225 <span class="preprocessor">    scfRemoveRefOwners ();                                              \</span>
00226 <span class="preprocessor">    if (scfParent)                                                      \</span>
00227 <span class="preprocessor">      scfParent-&gt;DecRef ();                                             \</span>
00228 <span class="preprocessor">    delete this;                                                        \</span>
00229 <span class="preprocessor">    return;                                                             \</span>
00230 <span class="preprocessor">  }                                                                     \</span>
00231 <span class="preprocessor">  scfRefCount--;                                                        \</span>
00232 <span class="preprocessor">}</span>
00233 <span class="preprocessor"></span>
<a name="l00240"></a><a class="code" href="group__scf.html#ga31">00240</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_REMOVE_REF_OWNERS(Class)                    \</span>
00241 <span class="preprocessor">void Class::scfRemoveRefOwners ()                                       \</span>
00242 <span class="preprocessor">{                                                                       \</span>
00243 <span class="preprocessor">  if (!scfWeakRefOwners) return;                                        \</span>
00244 <span class="preprocessor">  for (size_t i = 0 ; i &lt; scfWeakRefOwners-&gt;Length () ; i++)            \</span>
00245 <span class="preprocessor">  {                                                                     \</span>
00246 <span class="preprocessor">    iBase** p = (*scfWeakRefOwners)[i];                                 \</span>
00247 <span class="preprocessor">    *p = 0;                                                             \</span>
00248 <span class="preprocessor">  }                                                                     \</span>
00249 <span class="preprocessor">  delete scfWeakRefOwners;                                              \</span>
00250 <span class="preprocessor">  scfWeakRefOwners = 0;                                                 \</span>
00251 <span class="preprocessor">}</span>
00252 <span class="preprocessor"></span>
<a name="l00257"></a><a class="code" href="group__scf.html#ga32">00257</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_REFOWNER(Class)                             \</span>
00258 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
00259 <span class="preprocessor">{                                                                       \</span>
00260 <span class="preprocessor">  if (!scfWeakRefOwners)                                                \</span>
00261 <span class="preprocessor">    scfWeakRefOwners = new csArray&lt;iBase**&gt; (0, 4);                     \</span>
00262 <span class="preprocessor">  scfWeakRefOwners-&gt;InsertSorted (ref_owner);                           \</span>
00263 <span class="preprocessor">}                                                                       \</span>
00264 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
00265 <span class="preprocessor">{                                                                       \</span>
00266 <span class="preprocessor">  if (!scfWeakRefOwners)                                                \</span>
00267 <span class="preprocessor">    return;                                                             \</span>
00268 <span class="preprocessor">  size_t index = scfWeakRefOwners-&gt;FindSortedKey (                      \</span>
00269 <span class="preprocessor">    csArrayCmp&lt;iBase**, iBase**&gt; (ref_owner));                          \</span>
00270 <span class="preprocessor">  if (index != csArrayItemNotFound) scfWeakRefOwners-&gt;DeleteIndex (     \</span>
00271 <span class="preprocessor">    index);                                                             \</span>
00272 <span class="preprocessor">}</span>
00273 <span class="preprocessor"></span>
<a name="l00278"></a><a class="code" href="group__scf.html#ga33">00278</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_GETREFCOUNT(Class)                          \</span>
00279 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
00280 <span class="preprocessor">{                                                                       \</span>
00281 <span class="preprocessor">  return scfRefCount;                                                   \</span>
00282 <span class="preprocessor">}</span>
00283 <span class="preprocessor"></span>
<a name="l00290"></a><a class="code" href="group__scf.html#ga34">00290</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_QUERY(Class)                                \</span>
00291 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
00292 <span class="preprocessor">{                                                                       \</span>
00293 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;QueryInterface (%lu, %08X)\n",               \</span>
00294 <span class="preprocessor">    #Class, this, iInterfaceID, iVersion));</span>
00295 <span class="preprocessor"></span>
<a name="l00302"></a><a class="code" href="group__scf.html#ga35">00302</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_QUERY_END                                   \</span>
00303 <span class="preprocessor">  return scfParent ?                                                    \</span>
00304 <span class="preprocessor">    scfParent-&gt;QueryInterface (iInterfaceID, iVersion) : 0;             \</span>
00305 <span class="preprocessor">}</span>
00306 <span class="preprocessor"></span>
<a name="l00312"></a><a class="code" href="group__scf.html#ga36">00312</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE(Class)                                      \</span>
00313 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_INCREF(Class)                                     \</span>
00314 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_DECREF(Class)                                     \</span>
00315 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_GETREFCOUNT(Class)                                \</span>
00316 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_REFOWNER(Class)                                   \</span>
00317 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_REMOVE_REF_OWNERS(Class)                          \</span>
00318 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_QUERY(Class)</span>
00319 <span class="preprocessor"></span>
<a name="l00324"></a><a class="code" href="group__scf.html#ga37">00324</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_END                                         \</span>
00325 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_QUERY_END</span>
00326 <span class="preprocessor"></span>
<a name="l00333"></a><a class="code" href="group__scf.html#ga38">00333</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_INCREF(Class)                      \</span>
00334 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
00335 <span class="preprocessor">{                                                                       \</span>
00336 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;IncRef (%d)\n", #Class, this,                \</span>
00337 <span class="preprocessor">    scfParent-&gt;GetRefCount () + 1));                                    \</span>
00338 <span class="preprocessor">  scfParent-&gt;IncRef ();                                                 \</span>
00339 <span class="preprocessor">}</span>
00340 <span class="preprocessor"></span>
<a name="l00347"></a><a class="code" href="group__scf.html#ga39">00347</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_DECREF(Class)                      \</span>
00348 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
00349 <span class="preprocessor">{                                                                       \</span>
00350 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;DecRef (%d)\n", #Class, this,                \</span>
00351 <span class="preprocessor">              scfParent-&gt;GetRefCount ()-1));                            \</span>
00352 <span class="preprocessor">  scfParent-&gt;DecRef ();                                                 \</span>
00353 <span class="preprocessor">}</span>
00354 <span class="preprocessor"></span>
<a name="l00359"></a><a class="code" href="group__scf.html#ga40">00359</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_GETREFCOUNT(Class)                 \</span>
00360 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
00361 <span class="preprocessor">{                                                                       \</span>
00362 <span class="preprocessor">  return scfParent-&gt;GetRefCount ();                                     \</span>
00363 <span class="preprocessor">}</span>
00364 <span class="preprocessor"></span>
<a name="l00369"></a><a class="code" href="group__scf.html#ga41">00369</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_REFOWNER(Class)                    \</span>
00370 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
00371 <span class="preprocessor">{                                                                       \</span>
00372 <span class="preprocessor">  scfParent-&gt;AddRefOwner (ref_owner);                                   \</span>
00373 <span class="preprocessor">}                                                                       \</span>
00374 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
00375 <span class="preprocessor">{                                                                       \</span>
00376 <span class="preprocessor">  scfParent-&gt;RemoveRefOwner (ref_owner);                                \</span>
00377 <span class="preprocessor">}</span>
00378 <span class="preprocessor"></span>
<a name="l00385"></a><a class="code" href="group__scf.html#ga42">00385</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY(Class)                       \</span>
00386 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
00387 <span class="preprocessor">{                                                                       \</span>
00388 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;QueryInterface (%lu, %08X)\n",               \</span>
00389 <span class="preprocessor">    #Class, this, iInterfaceID, iVersion));</span>
00390 <span class="preprocessor"></span>
<a name="l00397"></a><a class="code" href="group__scf.html#ga43">00397</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY_END                          \</span>
00398 <span class="preprocessor">  return scfParent-&gt;QueryInterface (iInterfaceID, iVersion);            \</span>
00399 <span class="preprocessor">}</span>
00400 <span class="preprocessor"></span>
<a name="l00407"></a><a class="code" href="group__scf.html#ga44">00407</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE(Class)                             \</span>
00408 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_INCREF(Class)                            \</span>
00409 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_DECREF(Class)                            \</span>
00410 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_GETREFCOUNT(Class)                       \</span>
00411 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_REFOWNER(Class)                          \</span>
00412 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY(Class)</span>
00413 <span class="preprocessor"></span>
<a name="l00418"></a><a class="code" href="group__scf.html#ga45">00418</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_END                                \</span>
00419 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY_END</span>
00420 <span class="preprocessor"></span>
<a name="l00427"></a><a class="code" href="group__scf.html#ga46">00427</a> <span class="preprocessor">#define SCF_IMPLEMENTS_INTERFACE(Interface)                             \</span>
00428 <span class="preprocessor">  csRefTrackerAccess::AddAlias (CS_STATIC_CAST(Interface*, this), this);\</span>
00429 <span class="preprocessor">  SCF_IMPLEMENTS_INTERFACE_COMMON (Interface, this)</span>
00430 <span class="preprocessor"></span>
<a name="l00435"></a><a class="code" href="group__scf.html#ga47">00435</a> <span class="preprocessor">#define SCF_IMPLEMENTS_EMBEDDED_INTERFACE(Interface)                    \</span>
00436 <span class="preprocessor">  SCF_IMPLEMENTS_INTERFACE_COMMON (Interface, (&amp;scf##Interface))</span>
00437 <span class="preprocessor"></span>
<a name="l00441"></a><a class="code" href="group__scf.html#ga48">00441</a> <span class="preprocessor">#define SCF_IMPLEMENTS_INTERFACE_COMMON(Interface,Object)               \</span>
00442 <span class="preprocessor">  if (iInterfaceID == scfInterface&lt;Interface&gt;::GetID() &amp;&amp;               \</span>
00443 <span class="preprocessor">    scfCompatibleVersion (iVersion, scfInterface&lt;Interface&gt;::GetVersion())) \</span>
00444 <span class="preprocessor">  {                                                                     \</span>
00445 <span class="preprocessor">    (Object)-&gt;IncRef ();                                                \</span>
00446 <span class="preprocessor">    return CS_STATIC_CAST(Interface*, Object);                          \</span>
00447 <span class="preprocessor">  }</span>
00448 <span class="preprocessor"></span>
<a name="l00459"></a><a class="code" href="group__scf.html#ga49">00459</a> <span class="preprocessor">#define SCF_DECLARE_IBASE_EXT(ParentClass)                              \</span>
00460 <span class="preprocessor">  typedef ParentClass __scf_superclass;                                 \</span>
00461 <span class="preprocessor">  virtual void IncRef ();                                               \</span>
00462 <span class="preprocessor">  virtual void DecRef ();                                               \</span>
00463 <span class="preprocessor">  virtual int GetRefCount ();                                           \</span>
00464 <span class="preprocessor">  virtual void AddRefOwner (iBase** ref_owner);                         \</span>
00465 <span class="preprocessor">  virtual void RemoveRefOwner (iBase** ref_owner);                      \</span>
00466 <span class="preprocessor">  virtual void *QueryInterface (scfInterfaceID iInterfaceID, int iVersion)</span>
00467 <span class="preprocessor"></span>
<a name="l00474"></a><a class="code" href="group__scf.html#ga50">00474</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_INCREF(Class)                           \</span>
00475 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
00476 <span class="preprocessor">{                                                                       \</span>
00477 <span class="preprocessor">  __scf_superclass::IncRef ();                                          \</span>
00478 <span class="preprocessor">}</span>
00479 <span class="preprocessor"></span>
<a name="l00486"></a><a class="code" href="group__scf.html#ga51">00486</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_DECREF(Class)                           \</span>
00487 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
00488 <span class="preprocessor">{                                                                       \</span>
00489 <span class="preprocessor">  __scf_superclass::DecRef ();                                          \</span>
00490 <span class="preprocessor">}</span>
00491 <span class="preprocessor"></span>
<a name="l00498"></a><a class="code" href="group__scf.html#ga52">00498</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_GETREFCOUNT(Class)                      \</span>
00499 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
00500 <span class="preprocessor">{                                                                       \</span>
00501 <span class="preprocessor">  return __scf_superclass::GetRefCount ();                              \</span>
00502 <span class="preprocessor">}</span>
00503 <span class="preprocessor"></span>
<a name="l00508"></a><a class="code" href="group__scf.html#ga53">00508</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_REFOWNER(Class)                 \</span>
00509 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
00510 <span class="preprocessor">{                                                                       \</span>
00511 <span class="preprocessor">  __scf_superclass::AddRefOwner (ref_owner);                            \</span>
00512 <span class="preprocessor">}                                                                       \</span>
00513 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
00514 <span class="preprocessor">{                                                                       \</span>
00515 <span class="preprocessor">  __scf_superclass::RemoveRefOwner (ref_owner);                         \</span>
00516 <span class="preprocessor">}</span>
00517 <span class="preprocessor"></span>
<a name="l00524"></a><a class="code" href="group__scf.html#ga54">00524</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_QUERY(Class)                            \</span>
00525 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
00526 <span class="preprocessor">{</span>
00527 <span class="preprocessor"></span>
<a name="l00534"></a><a class="code" href="group__scf.html#ga55">00534</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_QUERY_END                               \</span>
00535 <span class="preprocessor">  return __scf_superclass::QueryInterface (iInterfaceID, iVersion);     \</span>
00536 <span class="preprocessor">}</span>
00537 <span class="preprocessor"></span>
<a name="l00542"></a><a class="code" href="group__scf.html#ga56">00542</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT(Class)                                  \</span>
00543 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_INCREF(Class)                                 \</span>
00544 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_DECREF(Class)                                 \</span>
00545 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_GETREFCOUNT(Class)                            \</span>
00546 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_REFOWNER(Class)                               \</span>
00547 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_QUERY(Class)</span>
00548 <span class="preprocessor"></span>
<a name="l00553"></a><a class="code" href="group__scf.html#ga57">00553</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_END                                     \</span>
00554 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_QUERY_END</span>
00555 <span class="preprocessor"></span>
00571 <span class="preprocessor">#ifdef CS_MEMORY_TRACKER</span>
00572 <span class="preprocessor"></span><span class="comment">// This special version of SCF_IMPLEMENT_FACTORY_INIT will make sure that</span>
00573 <span class="comment">// the memory tracker for this plugin is implemented.</span>
00574 <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_INIT(Class)                               \</span>
00575 <span class="preprocessor">static inline void Class ## _scfUnitInitialize(iSCF* SCF)               \</span>
00576 <span class="preprocessor">{                                                                       \</span>
00577 <span class="preprocessor">  iSCF::SCF = SCF;                                                      \</span>
00578 <span class="preprocessor">  extern void mtiRegisterModule (char*);                                \</span>
00579 <span class="preprocessor">  mtiRegisterModule (#Class);                                           \</span>
00580 <span class="preprocessor">}                                                                       \</span>
00581 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
00582 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfInitialize)(iSCF* SCF)                  \</span>
00583 <span class="preprocessor">{ Class ## _scfUnitInitialize(SCF); }</span>
00584 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00585"></a><a class="code" href="group__scf.html#ga58">00585</a> <span class="preprocessor"></span><span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_INIT(Class)                               \</span>
00586 <span class="preprocessor">static inline void Class ## _scfUnitInitialize(iSCF* SCF)               \</span>
00587 <span class="preprocessor">{ iSCF::SCF = SCF; }                                                    \</span>
00588 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
00589 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfInitialize)(iSCF* SCF)                  \</span>
00590 <span class="preprocessor">{ Class ## _scfUnitInitialize(SCF); }</span>
00591 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00592 <span class="preprocessor"></span>
<a name="l00598"></a><a class="code" href="group__scf.html#ga59">00598</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_FINIS(Class)                              \</span>
00599 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
00600 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfFinalize)()                             \</span>
00601 <span class="preprocessor">{                                                                       \</span>
00602 <span class="preprocessor">CS_STATIC_VARIABLE_CLEANUP                                              \</span>
00603 <span class="preprocessor">}</span>
00604 <span class="preprocessor"></span>
<a name="l00611"></a><a class="code" href="group__scf.html#ga60">00611</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_CREATE(Class)                             \</span>
00612 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
00613 <span class="preprocessor">void* CS_EXPORTED_NAME(Class,_Create)(iBase *iParent)                   \</span>
00614 <span class="preprocessor">{                                                                       \</span>
00615 <span class="preprocessor">  void *ret = new Class (iParent);                                      \</span>
00616 <span class="preprocessor">  SCF_TRACE (("  %p = new %s ()\n", ret, #Class));                      \</span>
00617 <span class="preprocessor">  return ret;                                                           \</span>
00618 <span class="preprocessor">}</span>
00619 <span class="preprocessor"></span>
<a name="l00626"></a><a class="code" href="group__scf.html#ga61">00626</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY(Class)                                    \</span>
00627 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_INIT(Class)                                     \</span>
00628 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_FINIS(Class)                                    \</span>
00629 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_CREATE(Class)</span>
00630 <span class="preprocessor"></span>
00631 <span class="preprocessor">#define SCF_STATIC_CLASS_CONTEXT      "*static*"</span>
00632 <span class="preprocessor"></span>
<a name="l00641"></a><a class="code" href="group__scf.html#ga63">00641</a> <span class="preprocessor">#define SCF_REGISTER_STATIC_CLASS(Class,Ident,Desc,Dep)                 \</span>
00642 <span class="preprocessor">  CS_EXPORTED_FUNCTION void* CS_EXPORTED_NAME(Class,_Create)(iBase*);   \</span>
00643 <span class="preprocessor">  class Class##_StaticInit__                                            \</span>
00644 <span class="preprocessor">  {                                                                     \</span>
00645 <span class="preprocessor">  public:                                                               \</span>
00646 <span class="preprocessor">    Class##_StaticInit__()                                              \</span>
00647 <span class="preprocessor">    {                                                                   \</span>
00648 <span class="preprocessor">      scfInitialize(0);                                                 \</span>
00649 <span class="preprocessor">      iSCF::SCF-&gt;RegisterClass(                                         \</span>
00650 <span class="preprocessor">        CS_EXPORTED_NAME(Class,_Create), Ident, Desc, Dep,              \</span>
00651 <span class="preprocessor">        SCF_STATIC_CLASS_CONTEXT);                                      \</span>
00652 <span class="preprocessor">    }                                                                   \</span>
00653 <span class="preprocessor">  } Class##_static_init__;</span>
00654 <span class="preprocessor"></span>
<a name="l00659"></a><a class="code" href="group__scf.html#ga64">00659</a> <span class="preprocessor">#define SCF_REGISTER_STATIC_LIBRARY(Module, MetaInfo)                   \</span>
00660 <span class="preprocessor">  class Module##_StaticInit                                             \</span>
00661 <span class="preprocessor">  {                                                                     \</span>
00662 <span class="preprocessor">  public:                                                               \</span>
00663 <span class="preprocessor">    Module##_StaticInit()                                               \</span>
00664 <span class="preprocessor">    {                                                                   \</span>
00665 <span class="preprocessor">      scfInitialize(0);                                                 \</span>
00666 <span class="preprocessor">      iSCF::SCF-&gt;RegisterClasses(MetaInfo, SCF_STATIC_CLASS_CONTEXT);   \</span>
00667 <span class="preprocessor">    }                                                                   \</span>
00668 <span class="preprocessor">  } Module##_static_init__;</span>
00669 <span class="preprocessor"></span>
<a name="l00674"></a><a class="code" href="group__scf.html#ga65">00674</a> <span class="preprocessor">#define SCF_DEFINE_FACTORY_FUNC_REGISTRATION(Class)                     \</span>
00675 <span class="preprocessor">  CS_EXPORTED_FUNCTION void* CS_EXPORTED_NAME(Class,_Create)(iBase*);   \</span>
00676 <span class="preprocessor">  class Class##_StaticInit                                              \</span>
00677 <span class="preprocessor">  {                                                                     \</span>
00678 <span class="preprocessor">  public:                                                               \</span>
00679 <span class="preprocessor">    Class##_StaticInit()                                                \</span>
00680 <span class="preprocessor">    {                                                                   \</span>
00681 <span class="preprocessor">      scfInitialize(0);                                                 \</span>
00682 <span class="preprocessor">      iSCF::SCF-&gt;RegisterFactoryFunc(CS_EXPORTED_NAME(Class,_Create),#Class); \</span>
00683 <span class="preprocessor">    }                                                                   \</span>
00684 <span class="preprocessor">  };</span>
00685 <span class="preprocessor"></span>
<a name="l00690"></a><a class="code" href="group__scf.html#ga66">00690</a> <span class="preprocessor">#define SCF_USE_STATIC_PLUGIN(Module)                                   \</span>
00691 <span class="preprocessor">  namespace csStaticPluginInit                                          \</span>
00692 <span class="preprocessor">  {                                                                     \</span>
00693 <span class="preprocessor">    class Module { public: Module(); };                                 \</span>
00694 <span class="preprocessor">    Module Module##_StaticInit;                                         \</span>
00695 <span class="preprocessor">  }</span>
00696 <span class="preprocessor"></span>
<a name="l00705"></a><a class="code" href="group__scf.html#ga67">00705</a> <span class="preprocessor">#define SCF_REGISTER_FACTORY_FUNC(Class)                                \</span>
00706 <span class="preprocessor">  SCF_DEFINE_FACTORY_FUNC_REGISTRATION(Class)                           \</span>
00707 <span class="preprocessor">  Class##_StaticInit Class##_static_init__;</span>
00708 <span class="preprocessor"></span>
00709 <span class="comment">//--------------------------------------------- Class factory interface -----//</span>
00710 
<a name="l00724"></a><a class="code" href="structiFactory.html">00724</a> <span class="keyword">struct </span><a class="code" href="structiFactory.html">iFactory</a> : <span class="keyword">public</span> <a class="code" href="structiBase.html">iBase</a>
00725 {
00727   <span class="keyword">virtual</span> <span class="keywordtype">void</span> *<a class="code" href="structiFactory.html#a0">CreateInstance</a> () = 0;
00729   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiFactory.html#a1">TryUnload</a> () = 0;
00731   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a2">QueryDescription</a> () = 0;
00733   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a3">QueryDependencies</a> () = 0;
00735   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a4">QueryClassID</a> () = 0;
00737   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a5">QueryModuleName</a> () = 0;
00738 };
00739 
00740 <span class="comment">//----------------------------------------------- Client-side functions -----//</span>
00741 
00742 <span class="keyword">struct </span><a class="code" href="structiDocument.html">iDocument</a>;
00743 <span class="keyword">struct </span><a class="code" href="structiStringArray.html">iStringArray</a>;
00744 
<a name="l00746"></a><a class="code" href="group__scf.html#ga1">00746</a> <span class="keyword">typedef</span> <span class="keywordtype">void</span>* (*scfFactoryFunc)(<a class="code" href="structiBase.html">iBase</a>*);
00747 
<a name="l00752"></a><a class="code" href="group__scf.html#ga68">00752</a> <span class="preprocessor">#define SCF_CREATE_INSTANCE(ClassID,Interface)                          \</span>
00753 <span class="preprocessor">  csPtr&lt;Interface&gt; (                                                    \</span>
00754 <span class="preprocessor">    (Interface *)iSCF::SCF-&gt;CreateInstance (                            \</span>
00755 <span class="preprocessor">    ClassID, #Interface, scfInterface&lt;Interface&gt;::GetVersion()))</span>
00756 <span class="preprocessor"></span>
<a name="l00769"></a><a class="code" href="group__scf.html#ga69">00769</a> <span class="preprocessor">#define SCF_VERSION(Name,Major,Minor,Micro)                             \</span>
00770 <span class="preprocessor">struct Name;                                                            \</span>
00771 <span class="preprocessor">CS_SPECIALIZE_TEMPLATE                                                  \</span>
00772 <span class="preprocessor">class scfInterface&lt;Name&gt;                                                \</span>
00773 <span class="preprocessor">{                                                                       \</span>
00774 <span class="preprocessor">  static scfInterfaceID&amp; GetMyID()                                      \</span>
00775 <span class="preprocessor">  {                                                                     \</span>
00776 <span class="preprocessor">    static scfInterfaceID ID = (scfInterfaceID)-1;                      \</span>
00777 <span class="preprocessor">    return ID;                                                          \</span>
00778 <span class="preprocessor">  }                                                                     \</span>
00779 <span class="preprocessor">  static void CleanupID()                                               \</span>
00780 <span class="preprocessor">  {                                                                     \</span>
00781 <span class="preprocessor">    GetMyID() = (scfInterfaceID)-1;                                     \</span>
00782 <span class="preprocessor">  }                                                                     \</span>
00783 <span class="preprocessor">public:                                                                 \</span>
00784 <span class="preprocessor">  static int GetVersion()                                               \</span>
00785 <span class="preprocessor">  {                                                                     \</span>
00786 <span class="preprocessor">    return SCF_CONSTRUCT_VERSION(Major, Minor, Micro);                  \</span>
00787 <span class="preprocessor">  }                                                                     \</span>
00788 <span class="preprocessor">  static scfInterfaceID GetID()                                         \</span>
00789 <span class="preprocessor">  {                                                                     \</span>
00790 <span class="preprocessor">    scfInterfaceID&amp; ID = GetMyID();                                     \</span>
00791 <span class="preprocessor">    if (ID == (scfInterfaceID)(-1))                                     \</span>
00792 <span class="preprocessor">    {                                                                   \</span>
00793 <span class="preprocessor">      ID = iSCF::SCF-&gt;GetInterfaceID(#Name);                            \</span>
00794 <span class="preprocessor">      </span><span class="comment">/* Mild hack to reset SCF ID on CS shutdown */</span>                    \
00795       csStaticVarCleanup (CleanupID);                                   \
00796     }                                                                   \
00797     return ID;                                                          \
00798   }                                                                     \
00799   static char const* GetName()                                          \
00800   {                                                                     \
00801     return #Name;                                                       \
00802   }                                                                     \
00803 }
00804 
<a name="l00811"></a><a class="code" href="classscfInterface.html">00811</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classscfInterface.html">scfInterface</a>
00812 {
00813 <span class="keyword">public</span>:
<a name="l00818"></a><a class="code" href="classscfInterface.html#e0">00818</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classscfInterface.html#e0">GetVersion</a>()
00819   {
00820     CS_ASSERT_MSG(<span class="stringliteral">"illegal invocation of non-specialized "</span>
00821       <span class="stringliteral">"scfInterface&lt;&gt;::GetVersion()"</span>, 1 == 0);
00822     <span class="keywordflow">return</span> 0;
00823   }
00824 
<a name="l00832"></a><a class="code" href="classscfInterface.html#e1">00832</a>   <span class="keyword">static</span> <a class="code" href="group__scf.html#ga0">scfInterfaceID</a> <a class="code" href="classscfInterface.html#e1">GetID</a>()
00833   {
00834     CS_ASSERT_MSG(<span class="stringliteral">"illegal invocation of non-specialized "</span>
00835       <span class="stringliteral">"scfInterface&lt;&gt;::GetID()"</span>, 1 == 0);
00836     <span class="keywordflow">return</span> (<a class="code" href="group__scf.html#ga0">scfInterfaceID</a>)(-1);
00837   }
00838 
<a name="l00842"></a><a class="code" href="classscfInterface.html#e2">00842</a>   <span class="keyword">static</span> <span class="keywordtype">char</span> <span class="keyword">const</span>* <a class="code" href="classscfInterface.html#e2">GetName</a>()
00843   {
00844     CS_ASSERT_MSG(<span class="stringliteral">"illegal invocation of non-specialized "</span>
00845       <span class="stringliteral">"scfInterface&lt;&gt;::GetName()"</span>, 1 == 0);
00846     <span class="keywordflow">return</span> 0;
00847   }
00848 };
00849 
<a name="l00854"></a><a class="code" href="group__scf.html#ga70">00854</a> <span class="preprocessor">#define SCF_QUERY_INTERFACE(Object,Interface)                           \</span>
00855 <span class="preprocessor">  csPtr&lt;Interface&gt; ((Interface *)(Object)-&gt;QueryInterface (             \</span>
00856 <span class="preprocessor">  scfInterface&lt;Interface&gt;::GetID (), scfInterface&lt;Interface&gt;::GetVersion()))</span>
00857 <span class="preprocessor"></span>
<a name="l00863"></a><a class="code" href="group__scf.html#ga71">00863</a> <span class="preprocessor">#define SCF_QUERY_INTERFACE_SAFE(Object,Interface)                      \</span>
00864 <span class="preprocessor">  csPtr&lt;Interface&gt; ((Interface *)(iBase::QueryInterfaceSafe ((Object),  \</span>
00865 <span class="preprocessor">  scfInterface&lt;Interface&gt;::GetID (), scfInterface&lt;Interface&gt;::GetVersion())))</span>
00866 <span class="preprocessor"></span>
00871 <span class="keyword">enum</span>
00872 {
00873   <a class="code" href="group__scf.html#gga79a56">SCF_VERBOSE_NONE</a>            = 0,      
00874   <a class="code" href="group__scf.html#gga79a57">SCF_VERBOSE_PLUGIN_SCAN</a>     = 1 &lt;&lt; 0, 
00875   <a class="code" href="group__scf.html#gga79a58">SCF_VERBOSE_PLUGIN_LOAD</a>     = 1 &lt;&lt; 1, 
00876   <a class="code" href="group__scf.html#gga79a59">SCF_VERBOSE_PLUGIN_REGISTER</a> = 1 &lt;&lt; 2, 
00877   <a class="code" href="group__scf.html#gga79a60">SCF_VERBOSE_CLASS_REGISTER</a>  = 1 &lt;&lt; 3, 
00878   <a class="code" href="group__scf.html#gga79a61">SCF_VERBOSE_ALL</a>             = ~0      
00879 };
00880 
00896 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ga2">scfInitialize</a>(<a class="code" href="classcsPathsList.html">csPathsList</a> <span class="keyword">const</span>* pluginPaths,
00897   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> verbose = <a class="code" href="group__scf.html#gga79a56">SCF_VERBOSE_NONE</a>);
00898 
00903 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ga2">scfInitialize</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> argv[]);
00904 
<a name="l00911"></a><a class="code" href="group__scf.html#ga4">00911</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__scf.html#ga4">scfCompatibleVersion</a> (<span class="keywordtype">int</span> iVersion, <span class="keywordtype">int</span> iItfVersion)
00912 {
00913   <span class="keywordflow">return</span> ((iVersion &amp; 0xff000000) == (iItfVersion &amp; 0xff000000))
00914       &amp;&amp; ((iVersion &amp; 0x00ffffff) &lt;= (iItfVersion &amp; 0x00ffffff));
00915 }
00916 
00917 <span class="preprocessor">#if defined(CS_DEBUG) || defined(CS_MEMORY_TRACKER)</span>
00918 <span class="preprocessor"></span>  <span class="keyword">struct </span><a class="code" href="structiObjectRegistry.html">iObjectRegistry</a>;
00919 <span class="preprocessor">#endif</span>
00920 <span class="preprocessor"></span>
<a name="l00927"></a><a class="code" href="structiSCF.html">00927</a> <span class="keyword">struct </span><a class="code" href="structiSCF.html">iSCF</a> : <span class="keyword">public</span> <a class="code" href="structiBase.html">iBase</a>
00928 {
<a name="l00940"></a><a class="code" href="structiSCF.html#s0">00940</a>   <span class="keyword">static</span> CS_CRYSTALSPACE_EXPORT <a class="code" href="structiSCF.html">iSCF</a>* <a class="code" href="structiSCF.html#s0">SCF</a>;
00941 
00942 <span class="preprocessor">#if defined(CS_DEBUG) || defined(CS_MEMORY_TRACKER)</span>
00943 <span class="preprocessor"></span>  <span class="comment">// This is EXTREMELY dirty but I see no other solution for now.</span>
00944   <span class="comment">// For debugging reasons I must have a global (global over the application</span>
00945   <span class="comment">// and all plugins)pointer to the object registry. I have no other</span>
00946   <span class="comment">// global object to tag this pointer on that except for iSCF.</span>
00947   <span class="comment">// This pointer is only here in debug mode though. That ensures that it</span>
00948   <span class="comment">// cannot be misused in real code.</span>
00949   <span class="comment">// If you know another solution for this problem? This global pointer</span>
00950   <span class="comment">// will be used by csDebuggingGraph in csutil.</span>
00951   <a class="code" href="structiObjectRegistry.html">iObjectRegistry</a>* object_reg;
00952 <span class="preprocessor">#endif</span>
00953 <span class="preprocessor"></span>
00957   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiSCF.html#a0">RegisterClasses</a> (<a class="code" href="structiDocument.html">iDocument</a>* metadata,
00958     <span class="keyword">const</span> <span class="keywordtype">char</span>* context = 0) = 0;
00959 
00965   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiSCF.html#a0">RegisterClasses</a> (<span class="keywordtype">char</span> <span class="keyword">const</span>* xml,
00966     <span class="keyword">const</span> <span class="keywordtype">char</span>* context = 0) = 0;
00967 
00971   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiSCF.html#a0">RegisterClasses</a> (<span class="keyword">const</span> <span class="keywordtype">char</span>* pluginPath,
00972     <a class="code" href="structiDocument.html">iDocument</a>* metadata, <span class="keyword">const</span> <span class="keywordtype">char</span>* context = 0) = 0;
00973 
00980   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="structiSCF.html#a3">ClassRegistered</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID) = 0;
00981 
00997   <span class="keyword">virtual</span> <span class="keywordtype">void</span> *<a class="code" href="structiSCF.html#a4">CreateInstance</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID,
00998         <span class="keyword">const</span> <span class="keywordtype">char</span> *iInterface, <span class="keywordtype">int</span> iVersion) = 0;
00999 
01005   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiSCF.html#a5">GetClassDescription</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID) = 0;
01006 
01012   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiSCF.html#a6">GetClassDependencies</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID) = 0;
01013 
01040   <span class="keyword">virtual</span> <a class="code" href="classcsRef.html">csRef&lt;iDocument&gt;</a> <a class="code" href="structiSCF.html#a7">GetPluginMetadata</a> (<span class="keywordtype">char</span> <span class="keyword">const</span> *iClassID) = 0;
01041 
01048   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiSCF.html#a8">UnloadUnusedModules</a> () = 0;
01049 
01060   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="structiSCF.html#a9">RegisterClass</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID,
01061         <span class="keyword">const</span> <span class="keywordtype">char</span> *iLibraryName, <span class="keyword">const</span> <span class="keywordtype">char</span> *iFactoryClass,
01062         <span class="keyword">const</span> <span class="keywordtype">char</span> *Description, <span class="keyword">const</span> <span class="keywordtype">char</span> *Dependencies = 0,
01063         <span class="keyword">const</span> <span class="keywordtype">char</span>* context = 0) = 0;
01064 
01071   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="structiSCF.html#a9">RegisterClass</a> (<a class="code" href="group__scf.html#ga1">scfFactoryFunc</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID,
01072         <span class="keyword">const</span> <span class="keywordtype">char</span> *Description, <span class="keyword">const</span> <span class="keywordtype">char</span> *Dependencies = 0,
01073         <span class="keyword">const</span> <span class="keywordtype">char</span>* context = 0) = 0;
01074 
01082   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="structiSCF.html#a11">RegisterFactoryFunc</a> (<a class="code" href="group__scf.html#ga1">scfFactoryFunc</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *FactClass) = 0;
01083 
01090   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="structiSCF.html#a12">UnregisterClass</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iClassID) = 0;
01091 
01096   <span class="keyword">virtual</span> <span class="keywordtype">char</span> <span class="keyword">const</span>* <a class="code" href="structiSCF.html#a13">GetInterfaceName</a> (<a class="code" href="group__scf.html#ga0">scfInterfaceID</a>) <span class="keyword">const </span>= 0;
01097 
01103   <span class="keyword">virtual</span> <a class="code" href="group__scf.html#ga0">scfInterfaceID</a> <a class="code" href="structiSCF.html#a14">GetInterfaceID</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *iInterface) = 0;
01104 
01111   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiSCF.html#a15">Finish</a> () = 0;
01112 
01122   <span class="keyword">virtual</span> <a class="code" href="classcsRef.html">csRef&lt;iStringArray&gt;</a> <a class="code" href="structiSCF.html#a16">QueryClassList</a> (<span class="keywordtype">char</span> <span class="keyword">const</span>* pattern) = 0;
01123 
01127   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiSCF.html#a17">ScanPluginsPath</a> (<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">bool</span> recursive = <span class="keyword">false</span>,
01128     <span class="keyword">const</span> <span class="keywordtype">char</span>* context = 0) = 0;
01129 
01139   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="structiSCF.html#a18">RegisterPlugin</a> (<span class="keyword">const</span> <span class="keywordtype">char</span>* path) = 0;
01140 };
01141 
01142 <a class="code" href="group__scf.html#ga69">SCF_VERSION</a> (<a class="code" href="structiFactory.html">iFactory</a>, 0, 0, 2);
01143 <a class="code" href="group__scf.html#ga69">SCF_VERSION</a> (<a class="code" href="structiBase.html">iBase</a>, 0, 1, 0);
01144 <a class="code" href="group__scf.html#ga69">SCF_VERSION</a> (<a class="code" href="structiSCF.html">iSCF</a>, 0, 2, 1);
01145 
01146 <span class="comment">// A bit hacky.</span>
01147 <span class="preprocessor">#include "csutil/reftrackeraccess.h"</span>
01148 
01151 <span class="preprocessor">#endif // __CSSCF_H__</span>
</pre></div><hr size="1"><address><small>Generated for Crystal Space by 
<a href="http://www.doxygen.org/index.html">doxygen</a> 1.4.2 
</small></address> </div></body> </html>
