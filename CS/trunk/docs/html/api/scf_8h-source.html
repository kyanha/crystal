<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Crystal Space: csutil/scf.h Source File (Crystal Space Public API Reference)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<table border="0" cellpadding="0" cellspacing="0" width="100%" class="head">
 <tr heigth="59">
  <td class="head" width="202" valign="bottom" style="padding-left:0;"><a href="http://www.crystalspace3d.org/"><img src="csblur.png" width="236" height="59" alt="CrystalSpace" border="0"></a></td>
  <td class="head"><h2>Public API Reference</h2></td>
 </tr>
 <tr heigth="11">
  <td colspan="2" class="headshadow" valign="top" style="padding-left:0;"><img src="csblurb.png" width="236" height="11" alt="" border="0"></td>
 </tr>
</table>
<div class="content">
<!-- Generated by Doxygen 1.4.3-20050530 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000022.html">csutil</a></div>
<h1>scf.h</h1><a href="scf_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Crystal Space Shared Class Facility (SCF)</span>
<a name="l00003"></a>00003 <span class="comment">    Copyright (C) 1999 by Andrew Zabolotny</span>
<a name="l00004"></a>00004 <span class="comment">              (C) 2005 by Marten Svanfeldt</span>
<a name="l00005"></a>00005 <span class="comment">              (C) 2005 by Michael Adams</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    This library is free software; you can redistribute it and/or</span>
<a name="l00008"></a>00008 <span class="comment">    modify it under the terms of the GNU Library General Public</span>
<a name="l00009"></a>00009 <span class="comment">    License as published by the Free Software Foundation; either</span>
<a name="l00010"></a>00010 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00015"></a>00015 <span class="comment">    Library General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">    You should have received a copy of the GNU Library General Public</span>
<a name="l00018"></a>00018 <span class="comment">    License along with this library; if not, write to the Free</span>
<a name="l00019"></a>00019 <span class="comment">    Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef __CSSCF_H__</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define __CSSCF_H__</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "csextern.h"</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="array_8h.html">csutil/array.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="ref_8h.html">csutil/ref.h</a>"</span>
<a name="l00029"></a>00029 
<a name="l00038"></a>00038 <span class="keyword">class </span><a class="code" href="classcsPathsList.html">csPathsList</a>;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">// INTERFACE DEFINITIONS</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include "<a class="code" href="scf__interface_8h.html">csutil/scf_interface.h</a>"</span>
<a name="l00043"></a>00043 <span class="comment">// NEW STYLE IMPLEMENTATION</span>
<a name="l00044"></a>00044 <span class="comment">//#include "csutil/scf_implementation.h"</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">//-- Helper macros</span>
<a name="l00048"></a>00048 
<a name="l00053"></a>00053 <span class="preprocessor">#ifdef SCF_DEBUG</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#  define SCF_TRACE(x)                                                  \</span>
<a name="l00055"></a>00055 <span class="preprocessor">   {                                                                    \</span>
<a name="l00056"></a>00056 <span class="preprocessor">     printf ("SCF [%s:%d]:\n", __FILE__, (int)__LINE__);                \</span>
<a name="l00057"></a>00057 <span class="preprocessor">     printf x; SCF_PRINT_CALL_ADDRESS                                   \</span>
<a name="l00058"></a>00058 <span class="preprocessor">   }</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00060"></a><a class="code" href="group__scf.html#ga22">00060</a> <span class="preprocessor"></span><span class="preprocessor">#  define SCF_TRACE(x)</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="preprocessor">#if (__GNUC__ &gt;= 3) || ((__GNUC__ &gt;= 2) &amp;&amp; (__GNUC_MINOR__ &gt;= 8))</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#  define SCF_PRINT_CALL_ADDRESS                                        \</span>
<a name="l00069"></a>00069 <span class="preprocessor">   printf ("  Called from address %p\n", __builtin_return_address (0));</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00071"></a><a class="code" href="group__scf.html#ga23">00071</a> <span class="preprocessor"></span><span class="preprocessor">#  define SCF_PRINT_CALL_ADDRESS</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#ifdef CS_REF_TRACKER</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor"> #include &lt;typeinfo&gt;</span>
<a name="l00077"></a>00077 <span class="preprocessor"> #define CS_TYPENAME(x)             typeid(x).name()</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span> <span class="comment">/* @@@ HACK: Force an AddAlias() call for every contained interface</span>
<a name="l00079"></a>00079 <span class="comment">  * However, when iSCF::SCF == 0, don't call QI to prevent interface ID </span>
<a name="l00080"></a>00080 <span class="comment">  * resolution (which will fail).</span>
<a name="l00081"></a>00081 <span class="comment">  */</span>
<a name="l00082"></a>00082 <span class="preprocessor"> #define SCF_INIT_TRACKER_ALIASES    \</span>
<a name="l00083"></a>00083 <span class="preprocessor">  if (iSCF::SCF != 0) QueryInterface ((scfInterfaceID)-1, -1);</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00085"></a><a class="code" href="group__scf.html#ga24">00085</a> <span class="preprocessor"></span><span class="preprocessor"> #define CS_TYPENAME(x)             0</span>
<a name="l00086"></a><a class="code" href="group__scf.html#ga25">00086</a> <span class="preprocessor"></span><span class="preprocessor"> #define SCF_INIT_TRACKER_ALIASES</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089 <span class="comment">//-- Old style implementation</span>
<a name="l00094"></a><a class="code" href="group__scf.html#ga26">00094</a> <span class="comment"></span><span class="preprocessor">#define SCF_DECLARE_IBASE                                               \</span>
<a name="l00095"></a>00095 <span class="preprocessor">  int scfRefCount;              </span><span class="comment">/* Reference counter */</span>                 \
<a name="l00096"></a>00096   csArray&lt;iBase**&gt;* scfWeakRefOwners;                                   \
<a name="l00097"></a>00097   void scfRemoveRefOwners ();                                           \
<a name="l00098"></a>00098   SCF_DECLARE_EMBEDDED_IBASE (iBase)
<a name="l00099"></a>00099 
<a name="l00104"></a><a class="code" href="group__scf.html#ga27">00104</a> <span class="preprocessor">#define SCF_DECLARE_EMBEDDED_IBASE(OuterClass)                          \</span>
<a name="l00105"></a>00105 <span class="preprocessor">public:                                                                 \</span>
<a name="l00106"></a>00106 <span class="preprocessor">  OuterClass *scfParent;        </span><span class="comment">/* The parent object */</span>                 \
<a name="l00107"></a>00107   virtual void IncRef ();                                               \
<a name="l00108"></a>00108   virtual void DecRef ();                                               \
<a name="l00109"></a>00109   virtual int GetRefCount ();                                           \
<a name="l00110"></a>00110   virtual void AddRefOwner (iBase** ref_owner);                         \
<a name="l00111"></a>00111   virtual void RemoveRefOwner (iBase** ref_owner);                      \
<a name="l00112"></a>00112   virtual void *QueryInterface (scfInterfaceID iInterfaceID, int iVersion)
<a name="l00113"></a>00113 
<a name="l00123"></a><a class="code" href="group__scf.html#ga28">00123</a> <span class="preprocessor">#define SCF_CONSTRUCT_IBASE(Parent)                                     \</span>
<a name="l00124"></a>00124 <span class="preprocessor">  csRefTrackerAccess::TrackConstruction (this);                         \</span>
<a name="l00125"></a>00125 <span class="preprocessor">  csRefTrackerAccess::SetDescription (this, CS_TYPENAME(*this));        \</span>
<a name="l00126"></a>00126 <span class="preprocessor">  scfRefCount = 1;                                                      \</span>
<a name="l00127"></a>00127 <span class="preprocessor">  scfWeakRefOwners = 0;                                                 \</span>
<a name="l00128"></a>00128 <span class="preprocessor">  scfParent = Parent; if (scfParent) scfParent-&gt;IncRef();               \</span>
<a name="l00129"></a>00129 <span class="preprocessor">  SCF_INIT_TRACKER_ALIASES                                              </span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>
<a name="l00140"></a><a class="code" href="group__scf.html#ga29">00140</a> <span class="preprocessor">#define SCF_CONSTRUCT_EMBEDDED_IBASE(Interface)                         \</span>
<a name="l00141"></a>00141 <span class="preprocessor">  Interface.scfParent = this;                                           \</span>
<a name="l00142"></a>00142 <span class="preprocessor">  csRefTrackerAccess::AddAlias (&amp;Interface, this);</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00149"></a><a class="code" href="group__scf.html#ga30">00149</a> <span class="preprocessor">#define SCF_DESTRUCT_IBASE()                                            \</span>
<a name="l00150"></a>00150 <span class="preprocessor">  csRefTrackerAccess::TrackDestruction (this, scfRefCount);             \</span>
<a name="l00151"></a>00151 <span class="preprocessor">  scfRemoveRefOwners ();</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00159"></a><a class="code" href="group__scf.html#ga31">00159</a> <span class="preprocessor">#define SCF_DESTRUCT_EMBEDDED_IBASE(Interface)                          \</span>
<a name="l00160"></a>00160 <span class="preprocessor">  csRefTrackerAccess::RemoveAlias (&amp;Interface, this);                   \</span>
<a name="l00161"></a>00161 <span class="preprocessor">  Interface.scfParent = 0;</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span>
<a name="l00168"></a><a class="code" href="group__scf.html#ga32">00168</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_INCREF(Class)                               \</span>
<a name="l00169"></a>00169 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
<a name="l00170"></a>00170 <span class="preprocessor">{                                                                       \</span>
<a name="l00171"></a>00171 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;IncRef (%d)\n", #Class, this, scfRefCount + 1));\</span>
<a name="l00172"></a>00172 <span class="preprocessor">  csRefTrackerAccess::TrackIncRef (this, scfRefCount);                  \</span>
<a name="l00173"></a>00173 <span class="preprocessor">  scfRefCount++;                                                        \</span>
<a name="l00174"></a>00174 <span class="preprocessor">}</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00184"></a><a class="code" href="group__scf.html#ga33">00184</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_DECREF(Class)                               \</span>
<a name="l00185"></a>00185 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
<a name="l00186"></a>00186 <span class="preprocessor">{                                                                       \</span>
<a name="l00187"></a>00187 <span class="preprocessor">  csRefTrackerAccess::TrackDecRef (this, scfRefCount);                  \</span>
<a name="l00188"></a>00188 <span class="preprocessor">  if (scfRefCount == 1)                                                 \</span>
<a name="l00189"></a>00189 <span class="preprocessor">  {                                                                     \</span>
<a name="l00190"></a>00190 <span class="preprocessor">    SCF_TRACE ((" delete (%s *)%p\n", #Class, this));                   \</span>
<a name="l00191"></a>00191 <span class="preprocessor">    scfRemoveRefOwners ();                                              \</span>
<a name="l00192"></a>00192 <span class="preprocessor">    if (scfParent)                                                      \</span>
<a name="l00193"></a>00193 <span class="preprocessor">      scfParent-&gt;DecRef ();                                             \</span>
<a name="l00194"></a>00194 <span class="preprocessor">    delete this;                                                        \</span>
<a name="l00195"></a>00195 <span class="preprocessor">    return;                                                             \</span>
<a name="l00196"></a>00196 <span class="preprocessor">  }                                                                     \</span>
<a name="l00197"></a>00197 <span class="preprocessor">  scfRefCount--;                                                        \</span>
<a name="l00198"></a>00198 <span class="preprocessor">}</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span>
<a name="l00206"></a><a class="code" href="group__scf.html#ga34">00206</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_REMOVE_REF_OWNERS(Class)                    \</span>
<a name="l00207"></a>00207 <span class="preprocessor">void Class::scfRemoveRefOwners ()                                       \</span>
<a name="l00208"></a>00208 <span class="preprocessor">{                                                                       \</span>
<a name="l00209"></a>00209 <span class="preprocessor">  if (!scfWeakRefOwners) return;                                        \</span>
<a name="l00210"></a>00210 <span class="preprocessor">  for (size_t i = 0 ; i &lt; scfWeakRefOwners-&gt;Length () ; i++)            \</span>
<a name="l00211"></a>00211 <span class="preprocessor">  {                                                                     \</span>
<a name="l00212"></a>00212 <span class="preprocessor">    iBase** p = (*scfWeakRefOwners)[i];                                 \</span>
<a name="l00213"></a>00213 <span class="preprocessor">    *p = 0;                                                             \</span>
<a name="l00214"></a>00214 <span class="preprocessor">  }                                                                     \</span>
<a name="l00215"></a>00215 <span class="preprocessor">  delete scfWeakRefOwners;                                              \</span>
<a name="l00216"></a>00216 <span class="preprocessor">  scfWeakRefOwners = 0;                                                 \</span>
<a name="l00217"></a>00217 <span class="preprocessor">}</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>
<a name="l00223"></a><a class="code" href="group__scf.html#ga35">00223</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_REFOWNER(Class)                             \</span>
<a name="l00224"></a>00224 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
<a name="l00225"></a>00225 <span class="preprocessor">{                                                                       \</span>
<a name="l00226"></a>00226 <span class="preprocessor">  if (!scfWeakRefOwners)                                                \</span>
<a name="l00227"></a>00227 <span class="preprocessor">    scfWeakRefOwners = new csArray&lt;iBase**&gt; (0, 4);                     \</span>
<a name="l00228"></a>00228 <span class="preprocessor">  scfWeakRefOwners-&gt;InsertSorted (ref_owner);                           \</span>
<a name="l00229"></a>00229 <span class="preprocessor">}                                                                       \</span>
<a name="l00230"></a>00230 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
<a name="l00231"></a>00231 <span class="preprocessor">{                                                                       \</span>
<a name="l00232"></a>00232 <span class="preprocessor">  if (!scfWeakRefOwners)                                                \</span>
<a name="l00233"></a>00233 <span class="preprocessor">    return;                                                             \</span>
<a name="l00234"></a>00234 <span class="preprocessor">  size_t index = scfWeakRefOwners-&gt;FindSortedKey (                      \</span>
<a name="l00235"></a>00235 <span class="preprocessor">    csArrayCmp&lt;iBase**, iBase**&gt; (ref_owner));                          \</span>
<a name="l00236"></a>00236 <span class="preprocessor">  if (index != csArrayItemNotFound) scfWeakRefOwners-&gt;DeleteIndex (     \</span>
<a name="l00237"></a>00237 <span class="preprocessor">    index);                                                             \</span>
<a name="l00238"></a>00238 <span class="preprocessor">}</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>
<a name="l00244"></a><a class="code" href="group__scf.html#ga36">00244</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_GETREFCOUNT(Class)                          \</span>
<a name="l00245"></a>00245 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
<a name="l00246"></a>00246 <span class="preprocessor">{                                                                       \</span>
<a name="l00247"></a>00247 <span class="preprocessor">  return scfRefCount;                                                   \</span>
<a name="l00248"></a>00248 <span class="preprocessor">}</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>
<a name="l00256"></a><a class="code" href="group__scf.html#ga37">00256</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_QUERY(Class)                                \</span>
<a name="l00257"></a>00257 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
<a name="l00258"></a>00258 <span class="preprocessor">{                                                                       \</span>
<a name="l00259"></a>00259 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;QueryInterface (%lu, %08X)\n",               \</span>
<a name="l00260"></a>00260 <span class="preprocessor">    #Class, this, iInterfaceID, iVersion));</span>
<a name="l00261"></a>00261 <span class="preprocessor"></span>
<a name="l00268"></a><a class="code" href="group__scf.html#ga38">00268</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_QUERY_END                                   \</span>
<a name="l00269"></a>00269 <span class="preprocessor">  return scfParent ?                                                    \</span>
<a name="l00270"></a>00270 <span class="preprocessor">    scfParent-&gt;QueryInterface (iInterfaceID, iVersion) : 0;             \</span>
<a name="l00271"></a>00271 <span class="preprocessor">}</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>
<a name="l00278"></a><a class="code" href="group__scf.html#ga39">00278</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE(Class)                                      \</span>
<a name="l00279"></a>00279 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_INCREF(Class)                                     \</span>
<a name="l00280"></a>00280 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_DECREF(Class)                                     \</span>
<a name="l00281"></a>00281 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_GETREFCOUNT(Class)                                \</span>
<a name="l00282"></a>00282 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_REFOWNER(Class)                                   \</span>
<a name="l00283"></a>00283 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_REMOVE_REF_OWNERS(Class)                          \</span>
<a name="l00284"></a>00284 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_QUERY(Class)</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>
<a name="l00290"></a><a class="code" href="group__scf.html#ga40">00290</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_END                                         \</span>
<a name="l00291"></a>00291 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_QUERY_END</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>
<a name="l00299"></a><a class="code" href="group__scf.html#ga41">00299</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_INCREF(Class)                      \</span>
<a name="l00300"></a>00300 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
<a name="l00301"></a>00301 <span class="preprocessor">{                                                                       \</span>
<a name="l00302"></a>00302 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;IncRef (%d)\n", #Class, this,                \</span>
<a name="l00303"></a>00303 <span class="preprocessor">    scfParent-&gt;GetRefCount () + 1));                                    \</span>
<a name="l00304"></a>00304 <span class="preprocessor">  scfParent-&gt;IncRef ();                                                 \</span>
<a name="l00305"></a>00305 <span class="preprocessor">}</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span>
<a name="l00313"></a><a class="code" href="group__scf.html#ga42">00313</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_DECREF(Class)                      \</span>
<a name="l00314"></a>00314 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
<a name="l00315"></a>00315 <span class="preprocessor">{                                                                       \</span>
<a name="l00316"></a>00316 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;DecRef (%d)\n", #Class, this,                \</span>
<a name="l00317"></a>00317 <span class="preprocessor">              scfParent-&gt;GetRefCount ()-1));                            \</span>
<a name="l00318"></a>00318 <span class="preprocessor">  scfParent-&gt;DecRef ();                                                 \</span>
<a name="l00319"></a>00319 <span class="preprocessor">}</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>
<a name="l00325"></a><a class="code" href="group__scf.html#ga43">00325</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_GETREFCOUNT(Class)                 \</span>
<a name="l00326"></a>00326 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
<a name="l00327"></a>00327 <span class="preprocessor">{                                                                       \</span>
<a name="l00328"></a>00328 <span class="preprocessor">  return scfParent-&gt;GetRefCount ();                                     \</span>
<a name="l00329"></a>00329 <span class="preprocessor">}</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span>
<a name="l00335"></a><a class="code" href="group__scf.html#ga44">00335</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_REFOWNER(Class)                    \</span>
<a name="l00336"></a>00336 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
<a name="l00337"></a>00337 <span class="preprocessor">{                                                                       \</span>
<a name="l00338"></a>00338 <span class="preprocessor">  scfParent-&gt;AddRefOwner (ref_owner);                                   \</span>
<a name="l00339"></a>00339 <span class="preprocessor">}                                                                       \</span>
<a name="l00340"></a>00340 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
<a name="l00341"></a>00341 <span class="preprocessor">{                                                                       \</span>
<a name="l00342"></a>00342 <span class="preprocessor">  scfParent-&gt;RemoveRefOwner (ref_owner);                                \</span>
<a name="l00343"></a>00343 <span class="preprocessor">}</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>
<a name="l00351"></a><a class="code" href="group__scf.html#ga45">00351</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY(Class)                       \</span>
<a name="l00352"></a>00352 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
<a name="l00353"></a>00353 <span class="preprocessor">{                                                                       \</span>
<a name="l00354"></a>00354 <span class="preprocessor">  SCF_TRACE (("  (%s *)%p-&gt;QueryInterface (%lu, %08X)\n",               \</span>
<a name="l00355"></a>00355 <span class="preprocessor">    #Class, this, iInterfaceID, iVersion));</span>
<a name="l00356"></a>00356 <span class="preprocessor"></span>
<a name="l00363"></a><a class="code" href="group__scf.html#ga46">00363</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY_END                          \</span>
<a name="l00364"></a>00364 <span class="preprocessor">  return scfParent-&gt;QueryInterface (iInterfaceID, iVersion);            \</span>
<a name="l00365"></a>00365 <span class="preprocessor">}</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span>
<a name="l00373"></a><a class="code" href="group__scf.html#ga47">00373</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE(Class)                             \</span>
<a name="l00374"></a>00374 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_INCREF(Class)                            \</span>
<a name="l00375"></a>00375 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_DECREF(Class)                            \</span>
<a name="l00376"></a>00376 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_GETREFCOUNT(Class)                       \</span>
<a name="l00377"></a>00377 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_REFOWNER(Class)                          \</span>
<a name="l00378"></a>00378 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY(Class)</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>
<a name="l00384"></a><a class="code" href="group__scf.html#ga48">00384</a> <span class="preprocessor">#define SCF_IMPLEMENT_EMBEDDED_IBASE_END                                \</span>
<a name="l00385"></a>00385 <span class="preprocessor">  SCF_IMPLEMENT_EMBEDDED_IBASE_QUERY_END</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span>
<a name="l00393"></a><a class="code" href="group__scf.html#ga49">00393</a> <span class="preprocessor">#define SCF_IMPLEMENTS_INTERFACE(Interface)                             \</span>
<a name="l00394"></a>00394 <span class="preprocessor">  csRefTrackerAccess::AddAlias (CS_STATIC_CAST(Interface*, this), this);\</span>
<a name="l00395"></a>00395 <span class="preprocessor">  SCF_IMPLEMENTS_INTERFACE_COMMON (Interface, this)</span>
<a name="l00396"></a>00396 <span class="preprocessor"></span>
<a name="l00401"></a><a class="code" href="group__scf.html#ga50">00401</a> <span class="preprocessor">#define SCF_IMPLEMENTS_EMBEDDED_INTERFACE(Interface)                    \</span>
<a name="l00402"></a>00402 <span class="preprocessor">  SCF_IMPLEMENTS_INTERFACE_COMMON (Interface, (&amp;scf##Interface))</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span>
<a name="l00407"></a><a class="code" href="group__scf.html#ga51">00407</a> <span class="preprocessor">#define SCF_IMPLEMENTS_INTERFACE_COMMON(Interface,Object)               \</span>
<a name="l00408"></a>00408 <span class="preprocessor">  if (iInterfaceID == scfInterfaceTraits&lt;Interface&gt;::GetID() &amp;&amp;         \</span>
<a name="l00409"></a>00409 <span class="preprocessor">    scfCompatibleVersion (iVersion, scfInterfaceTraits&lt;Interface&gt;::GetVersion())) \</span>
<a name="l00410"></a>00410 <span class="preprocessor">  {                                                                     \</span>
<a name="l00411"></a>00411 <span class="preprocessor">    (Object)-&gt;IncRef ();                                                \</span>
<a name="l00412"></a>00412 <span class="preprocessor">    return CS_STATIC_CAST(Interface*, Object);                          \</span>
<a name="l00413"></a>00413 <span class="preprocessor">  }</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span>
<a name="l00425"></a><a class="code" href="group__scf.html#ga52">00425</a> <span class="preprocessor">#define SCF_DECLARE_IBASE_EXT(ParentClass)                              \</span>
<a name="l00426"></a>00426 <span class="preprocessor">  typedef ParentClass __scf_superclass;                                 \</span>
<a name="l00427"></a>00427 <span class="preprocessor">  virtual void IncRef ();                                               \</span>
<a name="l00428"></a>00428 <span class="preprocessor">  virtual void DecRef ();                                               \</span>
<a name="l00429"></a>00429 <span class="preprocessor">  virtual int GetRefCount ();                                           \</span>
<a name="l00430"></a>00430 <span class="preprocessor">  virtual void AddRefOwner (iBase** ref_owner);                         \</span>
<a name="l00431"></a>00431 <span class="preprocessor">  virtual void RemoveRefOwner (iBase** ref_owner);                      \</span>
<a name="l00432"></a>00432 <span class="preprocessor">  virtual void *QueryInterface (scfInterfaceID iInterfaceID, int iVersion)</span>
<a name="l00433"></a>00433 <span class="preprocessor"></span>
<a name="l00440"></a><a class="code" href="group__scf.html#ga53">00440</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_INCREF(Class)                           \</span>
<a name="l00441"></a>00441 <span class="preprocessor">void Class::IncRef ()                                                   \</span>
<a name="l00442"></a>00442 <span class="preprocessor">{                                                                       \</span>
<a name="l00443"></a>00443 <span class="preprocessor">  __scf_superclass::IncRef ();                                          \</span>
<a name="l00444"></a>00444 <span class="preprocessor">}</span>
<a name="l00445"></a>00445 <span class="preprocessor"></span>
<a name="l00452"></a><a class="code" href="group__scf.html#ga54">00452</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_DECREF(Class)                           \</span>
<a name="l00453"></a>00453 <span class="preprocessor">void Class::DecRef ()                                                   \</span>
<a name="l00454"></a>00454 <span class="preprocessor">{                                                                       \</span>
<a name="l00455"></a>00455 <span class="preprocessor">  __scf_superclass::DecRef ();                                          \</span>
<a name="l00456"></a>00456 <span class="preprocessor">}</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>
<a name="l00464"></a><a class="code" href="group__scf.html#ga55">00464</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_GETREFCOUNT(Class)                      \</span>
<a name="l00465"></a>00465 <span class="preprocessor">int Class::GetRefCount ()                                               \</span>
<a name="l00466"></a>00466 <span class="preprocessor">{                                                                       \</span>
<a name="l00467"></a>00467 <span class="preprocessor">  return __scf_superclass::GetRefCount ();                              \</span>
<a name="l00468"></a>00468 <span class="preprocessor">}</span>
<a name="l00469"></a>00469 <span class="preprocessor"></span>
<a name="l00474"></a><a class="code" href="group__scf.html#ga56">00474</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_REFOWNER(Class)                 \</span>
<a name="l00475"></a>00475 <span class="preprocessor">void Class::AddRefOwner (iBase** ref_owner)                             \</span>
<a name="l00476"></a>00476 <span class="preprocessor">{                                                                       \</span>
<a name="l00477"></a>00477 <span class="preprocessor">  __scf_superclass::AddRefOwner (ref_owner);                            \</span>
<a name="l00478"></a>00478 <span class="preprocessor">}                                                                       \</span>
<a name="l00479"></a>00479 <span class="preprocessor">void Class::RemoveRefOwner (iBase** ref_owner)                          \</span>
<a name="l00480"></a>00480 <span class="preprocessor">{                                                                       \</span>
<a name="l00481"></a>00481 <span class="preprocessor">  __scf_superclass::RemoveRefOwner (ref_owner);                         \</span>
<a name="l00482"></a>00482 <span class="preprocessor">}</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>
<a name="l00490"></a><a class="code" href="group__scf.html#ga57">00490</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_QUERY(Class)                            \</span>
<a name="l00491"></a>00491 <span class="preprocessor">void *Class::QueryInterface (scfInterfaceID iInterfaceID, int iVersion) \</span>
<a name="l00492"></a>00492 <span class="preprocessor">{</span>
<a name="l00493"></a>00493 <span class="preprocessor"></span>
<a name="l00500"></a><a class="code" href="group__scf.html#ga58">00500</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_QUERY_END                               \</span>
<a name="l00501"></a>00501 <span class="preprocessor">  return __scf_superclass::QueryInterface (iInterfaceID, iVersion);     \</span>
<a name="l00502"></a>00502 <span class="preprocessor">}</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>
<a name="l00508"></a><a class="code" href="group__scf.html#ga59">00508</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT(Class)                                  \</span>
<a name="l00509"></a>00509 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_INCREF(Class)                                 \</span>
<a name="l00510"></a>00510 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_DECREF(Class)                                 \</span>
<a name="l00511"></a>00511 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_GETREFCOUNT(Class)                            \</span>
<a name="l00512"></a>00512 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_REFOWNER(Class)                               \</span>
<a name="l00513"></a>00513 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_QUERY(Class)</span>
<a name="l00514"></a>00514 <span class="preprocessor"></span>
<a name="l00519"></a><a class="code" href="group__scf.html#ga60">00519</a> <span class="preprocessor">#define SCF_IMPLEMENT_IBASE_EXT_END                                     \</span>
<a name="l00520"></a>00520 <span class="preprocessor">  SCF_IMPLEMENT_IBASE_EXT_QUERY_END</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span>
<a name="l00537"></a>00537 <span class="preprocessor">#ifdef CS_MEMORY_TRACKER</span>
<a name="l00538"></a>00538 <span class="preprocessor"></span><span class="comment">// This special version of SCF_IMPLEMENT_FACTORY_INIT will make sure that</span>
<a name="l00539"></a>00539 <span class="comment">// the memory tracker for this plugin is implemented.</span>
<a name="l00540"></a>00540 <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_INIT(Class)                               \</span>
<a name="l00541"></a>00541 <span class="preprocessor">static inline void Class ## _scfUnitInitialize(iSCF* SCF)               \</span>
<a name="l00542"></a>00542 <span class="preprocessor">{                                                                       \</span>
<a name="l00543"></a>00543 <span class="preprocessor">  iSCF::SCF = SCF;                                                      \</span>
<a name="l00544"></a>00544 <span class="preprocessor">  extern void mtiRegisterModule (char*);                                \</span>
<a name="l00545"></a>00545 <span class="preprocessor">  mtiRegisterModule (#Class);                                           \</span>
<a name="l00546"></a>00546 <span class="preprocessor">}                                                                       \</span>
<a name="l00547"></a>00547 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00548"></a>00548 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfInitialize)(iSCF* SCF)                  \</span>
<a name="l00549"></a>00549 <span class="preprocessor">{ Class ## _scfUnitInitialize(SCF); }</span>
<a name="l00550"></a>00550 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00551"></a><a class="code" href="group__scf.html#ga61">00551</a> <span class="preprocessor"></span><span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_INIT(Class)                               \</span>
<a name="l00552"></a>00552 <span class="preprocessor">static inline void Class ## _scfUnitInitialize(iSCF* SCF)               \</span>
<a name="l00553"></a>00553 <span class="preprocessor">{ iSCF::SCF = SCF; }                                                    \</span>
<a name="l00554"></a>00554 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00555"></a>00555 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfInitialize)(iSCF* SCF)                  \</span>
<a name="l00556"></a>00556 <span class="preprocessor">{ Class ## _scfUnitInitialize(SCF); }</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00558"></a>00558 <span class="preprocessor"></span>
<a name="l00564"></a><a class="code" href="group__scf.html#ga62">00564</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_FINIS(Class)                              \</span>
<a name="l00565"></a>00565 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00566"></a>00566 <span class="preprocessor">void CS_EXPORTED_NAME(Class,_scfFinalize)()                             \</span>
<a name="l00567"></a>00567 <span class="preprocessor">{                                                                       \</span>
<a name="l00568"></a>00568 <span class="preprocessor">CS_STATIC_VARIABLE_CLEANUP                                              \</span>
<a name="l00569"></a>00569 <span class="preprocessor">}</span>
<a name="l00570"></a>00570 <span class="preprocessor"></span>
<a name="l00577"></a><a class="code" href="group__scf.html#ga63">00577</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY_CREATE(Class)                             \</span>
<a name="l00578"></a>00578 <span class="preprocessor">CS_EXPORTED_FUNCTION                                                    \</span>
<a name="l00579"></a>00579 <span class="preprocessor">void* CS_EXPORTED_NAME(Class,_Create)(iBase *iParent)                   \</span>
<a name="l00580"></a>00580 <span class="preprocessor">{                                                                       \</span>
<a name="l00581"></a>00581 <span class="preprocessor">  void *ret = new Class (iParent);                                      \</span>
<a name="l00582"></a>00582 <span class="preprocessor">  SCF_TRACE (("  %p = new %s ()\n", ret, #Class));                      \</span>
<a name="l00583"></a>00583 <span class="preprocessor">  return ret;                                                           \</span>
<a name="l00584"></a>00584 <span class="preprocessor">}</span>
<a name="l00585"></a>00585 <span class="preprocessor"></span>
<a name="l00592"></a><a class="code" href="group__scf.html#ga64">00592</a> <span class="preprocessor">#define SCF_IMPLEMENT_FACTORY(Class)                                    \</span>
<a name="l00593"></a>00593 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_INIT(Class)                                     \</span>
<a name="l00594"></a>00594 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_FINIS(Class)                                    \</span>
<a name="l00595"></a>00595 <span class="preprocessor">  SCF_IMPLEMENT_FACTORY_CREATE(Class)</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span>
<a name="l00597"></a><a class="code" href="group__scf.html#ga65">00597</a> <span class="preprocessor">#define SCF_STATIC_CLASS_CONTEXT      "*static*"</span>
<a name="l00598"></a>00598 <span class="preprocessor"></span>
<a name="l00607"></a><a class="code" href="group__scf.html#ga66">00607</a> <span class="preprocessor">#define SCF_REGISTER_STATIC_CLASS(Class,Ident,Desc,Dep)                 \</span>
<a name="l00608"></a>00608 <span class="preprocessor">  CS_EXPORTED_FUNCTION void* CS_EXPORTED_NAME(Class,_Create)(iBase*);   \</span>
<a name="l00609"></a>00609 <span class="preprocessor">  class Class##_StaticInit__                                            \</span>
<a name="l00610"></a>00610 <span class="preprocessor">  {                                                                     \</span>
<a name="l00611"></a>00611 <span class="preprocessor">  public:                                                               \</span>
<a name="l00612"></a>00612 <span class="preprocessor">    Class##_StaticInit__()                                              \</span>
<a name="l00613"></a>00613 <span class="preprocessor">    {                                                                   \</span>
<a name="l00614"></a>00614 <span class="preprocessor">      scfInitialize(0);                                                 \</span>
<a name="l00615"></a>00615 <span class="preprocessor">      iSCF::SCF-&gt;RegisterClass(                                         \</span>
<a name="l00616"></a>00616 <span class="preprocessor">        CS_EXPORTED_NAME(Class,_Create), Ident, Desc, Dep,              \</span>
<a name="l00617"></a>00617 <span class="preprocessor">        SCF_STATIC_CLASS_CONTEXT);                                      \</span>
<a name="l00618"></a>00618 <span class="preprocessor">    }                                                                   \</span>
<a name="l00619"></a>00619 <span class="preprocessor">  } Class##_static_init__;</span>
<a name="l00620"></a>00620 <span class="preprocessor"></span>
<a name="l00625"></a><a class="code" href="group__scf.html#ga67">00625</a> <span class="preprocessor">#define SCF_REGISTER_STATIC_LIBRARY(Module, MetaInfo)                   \</span>
<a name="l00626"></a>00626 <span class="preprocessor">  class Module##_StaticInit                                             \</span>
<a name="l00627"></a>00627 <span class="preprocessor">  {                                                                     \</span>
<a name="l00628"></a>00628 <span class="preprocessor">  public:                                                               \</span>
<a name="l00629"></a>00629 <span class="preprocessor">    Module##_StaticInit()                                               \</span>
<a name="l00630"></a>00630 <span class="preprocessor">    {                                                                   \</span>
<a name="l00631"></a>00631 <span class="preprocessor">      scfInitialize(0);                                                 \</span>
<a name="l00632"></a>00632 <span class="preprocessor">      iSCF::SCF-&gt;RegisterClasses(MetaInfo, SCF_STATIC_CLASS_CONTEXT);   \</span>
<a name="l00633"></a>00633 <span class="preprocessor">    }                                                                   \</span>
<a name="l00634"></a>00634 <span class="preprocessor">  } Module##_static_init__;</span>
<a name="l00635"></a>00635 <span class="preprocessor"></span>
<a name="l00640"></a><a class="code" href="group__scf.html#ga68">00640</a> <span class="preprocessor">#define SCF_DEFINE_FACTORY_FUNC_REGISTRATION(Class)                     \</span>
<a name="l00641"></a>00641 <span class="preprocessor">  CS_EXPORTED_FUNCTION void* CS_EXPORTED_NAME(Class,_Create)(iBase*);   \</span>
<a name="l00642"></a>00642 <span class="preprocessor">  class Class##_StaticInit                                              \</span>
<a name="l00643"></a>00643 <span class="preprocessor">  {                                                                     \</span>
<a name="l00644"></a>00644 <span class="preprocessor">  public:                                                               \</span>
<a name="l00645"></a>00645 <span class="preprocessor">    Class##_StaticInit()                                                \</span>
<a name="l00646"></a>00646 <span class="preprocessor">    {                                                                   \</span>
<a name="l00647"></a>00647 <span class="preprocessor">      scfInitialize(0);                                                 \</span>
<a name="l00648"></a>00648 <span class="preprocessor">      iSCF::SCF-&gt;RegisterFactoryFunc(CS_EXPORTED_NAME(Class,_Create),#Class); \</span>
<a name="l00649"></a>00649 <span class="preprocessor">    }                                                                   \</span>
<a name="l00650"></a>00650 <span class="preprocessor">  };</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>
<a name="l00656"></a><a class="code" href="group__scf.html#ga69">00656</a> <span class="preprocessor">#define SCF_USE_STATIC_PLUGIN(Module)                                   \</span>
<a name="l00657"></a>00657 <span class="preprocessor">  namespace csStaticPluginInit                                          \</span>
<a name="l00658"></a>00658 <span class="preprocessor">  {                                                                     \</span>
<a name="l00659"></a>00659 <span class="preprocessor">    class Module { public: Module(); };                                 \</span>
<a name="l00660"></a>00660 <span class="preprocessor">    Module Module##_StaticInit;                                         \</span>
<a name="l00661"></a>00661 <span class="preprocessor">  }</span>
<a name="l00662"></a>00662 <span class="preprocessor"></span>
<a name="l00671"></a><a class="code" href="group__scf.html#ga70">00671</a> <span class="preprocessor">#define SCF_REGISTER_FACTORY_FUNC(Class)                                \</span>
<a name="l00672"></a>00672 <span class="preprocessor">  SCF_DEFINE_FACTORY_FUNC_REGISTRATION(Class)                           \</span>
<a name="l00673"></a>00673 <span class="preprocessor">  Class##_StaticInit Class##_static_init__;</span>
<a name="l00674"></a>00674 <span class="preprocessor"></span>
<a name="l00675"></a>00675 <span class="comment">//--------------------------------------------- Class factory interface -----//</span>
<a name="l00676"></a>00676 
<a name="l00690"></a><a class="code" href="structiFactory.html">00690</a> <span class="keyword">struct </span><a class="code" href="structiFactory.html">iFactory</a> : <span class="keyword">public</span> <a class="code" href="structiBase.html">iBase</a>
<a name="l00691"></a>00691 {
<a name="l00693"></a>00693   <span class="keyword">virtual</span> <span class="keywordtype">void</span> *<a class="code" href="structiFactory.html#a0">CreateInstance</a> () = 0;
<a name="l00695"></a>00695   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structiFactory.html#a1">TryUnload</a> () = 0;
<a name="l00697"></a>00697   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a2">QueryDescription</a> () = 0;
<a name="l00699"></a>00699   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a3">QueryDependencies</a> () = 0;
<a name="l00701"></a>00701   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a4">QueryClassID</a> () = 0;
<a name="l00703"></a>00703   <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structiFactory.html#a5">QueryModuleName</a> () = 0;
<a name="l00704"></a>00704 };
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 <span class="comment">//----------------------------------------------- Client-side functions -----//</span>
<a name="l00707"></a>00707 
<a name="l00712"></a>00712 <span class="keyword">enum</span>
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714   <a class="code" href="group__scf.html#gga92a52">SCF_VERBOSE_NONE</a>            = 0,      
<a name="l00715"></a>00715   <a class="code" href="group__scf.html#gga92a53">SCF_VERBOSE_PLUGIN_SCAN</a>     = 1 &lt;&lt; 0, 
<a name="l00716"></a>00716   <a class="code" href="group__scf.html#gga92a54">SCF_VERBOSE_PLUGIN_LOAD</a>     = 1 &lt;&lt; 1, 
<a name="l00717"></a>00717   <a class="code" href="group__scf.html#gga92a55">SCF_VERBOSE_PLUGIN_REGISTER</a> = 1 &lt;&lt; 2, 
<a name="l00718"></a>00718   <a class="code" href="group__scf.html#gga92a56">SCF_VERBOSE_CLASS_REGISTER</a>  = 1 &lt;&lt; 3, 
<a name="l00719"></a><a class="code" href="group__scf.html#gga92a57">00719</a>   <a class="code" href="group__scf.html#gga92a57">SCF_VERBOSE_ALL</a>             = ~0      
<a name="l00720"></a>00720 };
<a name="l00721"></a>00721 
<a name="l00737"></a>00737 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ga3">scfInitialize</a>(<a class="code" href="classcsPathsList.html">csPathsList</a> <span class="keyword">const</span>* pluginPaths,
<a name="l00738"></a>00738   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> verbose = <a class="code" href="group__scf.html#gga92a52">SCF_VERBOSE_NONE</a>);
<a name="l00739"></a>00739 
<a name="l00744"></a>00744 CS_CRYSTALSPACE_EXPORT <span class="keywordtype">void</span> <a class="code" href="group__scf.html#ga3">scfInitialize</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> argv[]);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="comment">//---------- IMPLEMENTATION OF HELPER FUNCTIONS</span>
<a name="l00748"></a>00748 
<a name="l00752"></a>00752 <span class="keyword">template</span>&lt;<span class="keyword">class</span> Interface&gt;
<a name="l00753"></a><a class="code" href="group__scf.html#ga5">00753</a> <span class="keyword">inline</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a> <a class="code" href="group__scf.html#ga5">scfCreateInstance</a> (<span class="keywordtype">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> ClassID)
<a name="l00754"></a>00754 {
<a name="l00755"></a>00755   Interface *x = (Interface *)<a class="code" href="structiSCF.html#s0">iSCF::SCF</a>-&gt;<a class="code" href="structiSCF.html#a5">CreateInstance</a> (ClassID,
<a name="l00756"></a>00756     <a class="code" href="classscfInterfaceTraits.html">scfInterfaceTraits&lt;Interface&gt;</a>::GetName (),
<a name="l00757"></a>00757     <a class="code" href="classscfInterfaceTraits.html">scfInterfaceTraits&lt;Interface&gt;</a>::GetVersion ());
<a name="l00758"></a>00758   <span class="keywordflow">return</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a>(x);
<a name="l00759"></a>00759 }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761 <span class="comment">// Compatibility macro for scfCreateInstance function</span>
<a name="l00762"></a><a class="code" href="group__scf.html#ga71">00762</a> <span class="preprocessor">#define SCF_CREATE_INSTANCE(ClassID,Interface) \</span>
<a name="l00763"></a>00763 <span class="preprocessor">  scfCreateInstance&lt;Interface&gt; (ClassID)</span>
<a name="l00764"></a>00764 <span class="preprocessor"></span>
<a name="l00768"></a>00768 <span class="keyword">template</span>&lt;<span class="keyword">class</span> Interface, <span class="keyword">class</span> ClassPtr&gt;
<a name="l00769"></a><a class="code" href="group__scf.html#ga6">00769</a> <span class="keyword">inline</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a> <a class="code" href="group__scf.html#ga6">scfQueryInterface</a> (ClassPtr object)
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771   Interface *x = (Interface*)object-&gt;QueryInterface (
<a name="l00772"></a>00772     <a class="code" href="classscfInterfaceTraits.html">scfInterfaceTraits&lt;Interface&gt;</a>::GetID (),
<a name="l00773"></a>00773     <a class="code" href="classscfInterfaceTraits.html">scfInterfaceTraits&lt;Interface&gt;</a>::GetVersion ());
<a name="l00774"></a>00774   <span class="keywordflow">return</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a> (x);
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="comment">//Compatibility macro for scfQueryInterface</span>
<a name="l00778"></a><a class="code" href="group__scf.html#ga72">00778</a> <span class="preprocessor">#define SCF_QUERY_INTERFACE(Object,Interface) \</span>
<a name="l00779"></a>00779 <span class="preprocessor">  scfQueryInterface&lt;Interface&gt; (Object)</span>
<a name="l00780"></a>00780 <span class="preprocessor"></span>
<a name="l00785"></a>00785 <span class="keyword">template</span>&lt;<span class="keyword">class</span> Interface, <span class="keyword">class</span> ClassPtr&gt;
<a name="l00786"></a><a class="code" href="group__scf.html#ga7">00786</a> <span class="keyword">inline</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a> <a class="code" href="group__scf.html#ga7">scfQueryInterfaceSafe</a> (ClassPtr object)
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788   <span class="keywordflow">if</span> (object == 0) <span class="keywordflow">return</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a> (0);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   Interface *x = (Interface*)object-&gt;QueryInterface (
<a name="l00791"></a>00791     <a class="code" href="classscfInterfaceTraits.html">scfInterfaceTraits&lt;Interface&gt;</a>::GetID (),
<a name="l00792"></a>00792     <a class="code" href="classscfInterfaceTraits.html">scfInterfaceTraits&lt;Interface&gt;</a>::GetVersion ());
<a name="l00793"></a>00793   <span class="keywordflow">return</span> <a class="code" href="classcsPtr.html">csPtr&lt;Interface&gt;</a> (x);
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 <span class="comment">//Compatibility macro for scfQueryInterfaceSafe</span>
<a name="l00796"></a><a class="code" href="group__scf.html#ga73">00796</a> <span class="preprocessor">#define SCF_QUERY_INTERFACE_SAFE(Object,Interface) \</span>
<a name="l00797"></a>00797 <span class="preprocessor">  scfQueryInterfaceSafe&lt;Interface&gt; (Object)</span>
<a name="l00798"></a>00798 <span class="preprocessor"></span>
<a name="l00799"></a>00799 <span class="comment">// Give versions to above declared classes.</span>
<a name="l00800"></a>00800 <a class="code" href="group__scf.html#ga87">SCF_VERSION</a> (<a class="code" href="structiFactory.html">iFactory</a>, 0, 0, 2);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="comment">// A bit hacky.</span>
<a name="l00803"></a>00803 <span class="preprocessor">#include "csutil/reftrackeraccess.h"</span>
<a name="l00804"></a>00804 
<a name="l00807"></a>00807 <span class="preprocessor">#endif // __CSSCF_H__</span>
</pre></div><hr size="1"><address><small>Generated for Crystal Space by 
<a href="http://www.doxygen.org/index.html">doxygen</a> 1.4.3-20050530 
</small></address> </div></body> </html>
