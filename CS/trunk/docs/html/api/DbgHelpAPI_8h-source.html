<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csutil/win32/DbgHelpAPI.h Source File (Crystal Space Public API Reference)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<table border="0" cellpadding="0" cellspacing="0" width="100%" class="head">
 <tr heigth="59">
  <td class="head" width="202" valign="bottom" style="padding-left:0;"><a href="http://crystal.sourceforge.net/"><img src="csblur.png" width="236" height="59" alt="CrystalSpace" border="0"></a></td>
  <td class="head"><h2>Public API Reference</h2></td>
 </tr>
 <tr heigth="11">
  <td colspan="2" class="headshadow" valign="top" style="padding-left:0;"><img src="csblurb.png" width="236" height="11" alt="" border="0"></td>
 </tr>
</table>
<div class="content">
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csutil/win32/DbgHelpAPI.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">  DbgHelp API stuff.</span>
00003 <span class="comment">  Unfortunately, dbghelp.h isn't included in MinGW. So all that's needed goes here.</span>
00004 <span class="comment"> */</span>
00005 
00006 <span class="preprocessor">#ifndef __CSUTIL_DEBGHELPAPI_H__</span>
00007 <span class="preprocessor"></span><span class="preprocessor">#define __CSUTIL_DEBGHELPAPI_H__</span>
00008 <span class="preprocessor"></span>
00009 <span class="keyword">enum</span> ADDRESS_MODE
00010 {
00011   AddrMode1616,
00012   AddrMode1632,
00013   AddrModeReal,
00014   AddrModeFlat
00015 };
00016 
00017 <span class="keyword">struct </span>ADDRESS64 
00018 {
00019   uint64 Offset;
00020   WORD Segment;
00021   ADDRESS_MODE Mode;
00022 };
00023 <span class="keyword">typedef</span> ADDRESS64* LPADDRESS64;
00024 
00025 <span class="keyword">struct </span>KDHELP64 
00026 {  
00027   uint64 Thread;  
00028   DWORD ThCallbackStack;  
00029   DWORD ThCallbackBStore;  
00030   DWORD NextCallback;  
00031   DWORD FramePointer;  
00032   uint64 KiCallUserMode;  
00033   uint64 KeUserCallbackDispatcher;  
00034   uint64 SystemRangeStart;  
00035   uint64 Reserved[8];
00036 };
00037 <span class="keyword">typedef</span> KDHELP64* PKDHELP64;
00038 
00039 <span class="keyword">struct </span>STACKFRAME64 
00040 {  
00041   ADDRESS64 AddrPC;  
00042   ADDRESS64 AddrReturn;  
00043   ADDRESS64 AddrFrame;  
00044   ADDRESS64 AddrStack;  
00045   ADDRESS64 AddrBStore;  
00046   PVOID FuncTableEntry;  
00047   uint64 Params[4];  
00048   BOOL Far;  
00049   BOOL Virtual;  
00050   uint64 Reserved[3];  
00051   KDHELP64 KdHelp;
00052 };
00053 <span class="keyword">typedef</span> STACKFRAME64* LPSTACKFRAME64;
00054 
00055 <span class="keyword">typedef</span> BOOL (WINAPI* PREAD_PROCESS_MEMORY_ROUTINE64) (HANDLE hProcess,
00056   uint64 qwBaseAddress, PVOID lpBuffer, DWORD nSize, LPDWORD lpNumberOfBytesRead);
00057 <span class="keyword">typedef</span> PVOID (WINAPI* PFUNCTION_TABLE_ACCESS_ROUTINE64) (HANDLE hProcess,
00058   uint64 AddrBase);
00059 <span class="keyword">typedef</span> uint64 (WINAPI* PGET_MODULE_BASE_ROUTINE64) (HANDLE  hProcess, 
00060   uint64 Address);
00061 <span class="keyword">typedef</span> uint64 (WINAPI* PTRANSLATE_ADDRESS_ROUTINE64) (HANDLE hProcess,
00062   HANDLE hThread, LPADDRESS64 lpaddr);
00063 
00064 <span class="keyword">struct </span>SYMBOL_INFO 
00065 {  
00066   ULONG SizeOfStruct;  
00067   ULONG TypeIndex;  
00068   uint64 Reserved[2];  
00069   ULONG Reserved2;  
00070   ULONG Size;  
00071   uint64 ModBase;  
00072   ULONG Flags;  
00073   uint64 Value;  
00074   uint64 Address;  
00075   ULONG Register;  
00076   ULONG Scope;  
00077   ULONG Tag;  
00078   ULONG NameLen;  
00079   ULONG MaxNameLen;  
00080   CHAR Name[1];
00081 };
00082 <span class="keyword">typedef</span> SYMBOL_INFO* PSYMBOL_INFO;
00083 
00084 <span class="preprocessor">#define SYMFLAG_PARAMETER        0x00000040</span>
00085 <span class="preprocessor"></span>
00086 <span class="preprocessor">#define SYMOPT_UNDNAME                  0x00000002</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define SYMOPT_DEFERRED_LOADS           0x00000004</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#define SYMOPT_LOAD_LINES               0x00000010</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define SYMOPT_FAIL_CRITICAL_ERRORS     0x00000200</span>
00090 <span class="preprocessor"></span>
00091 <span class="keyword">enum</span> SYM_TYPE
00092 {
00093     SymNone = 0,
00094     SymCoff,
00095     SymCv,
00096     SymPdb,
00097     SymExport,
00098     SymDeferred,
00099     SymSym,
00100     SymDia,
00101     SymVirtual,
00102     NumSymTypes
00103 };
00104 
00105 <span class="keyword">struct </span>IMAGEHLP_MODULE64 
00106 {  
00107   DWORD SizeOfStruct;  
00108   uint64 BaseOfImage;  
00109   DWORD ImageSize;  
00110   DWORD TimeDateStamp;  
00111   DWORD CheckSum;  
00112   DWORD NumSyms;  
00113   SYM_TYPE SymType;  
00114   CHAR ModuleName[32];  
00115   CHAR ImageName[256];  
00116   CHAR LoadedImageName[256];  
00117   <span class="comment">/*</span>
00118 <span class="comment">    The following fields are only supported on newer versions of dbghelp.dll,</span>
00119 <span class="comment">    but the versions shipped with W2k resp. WXP lack them.</span>
00120 <span class="comment">   */</span>
00121   <span class="comment">/*CHAR LoadedPdbName[256];  </span>
00122 <span class="comment">  DWORD CVSig;  </span>
00123 <span class="comment">  CHAR CVData[MAX_PATH*3];  </span>
00124 <span class="comment">  DWORD PdbSig;  </span>
00125 <span class="comment">  GUID PdbSig70;  </span>
00126 <span class="comment">  DWORD PdbAge;  </span>
00127 <span class="comment">  BOOL PdbUnmatched;  </span>
00128 <span class="comment">  BOOL DbgUnmatched;  </span>
00129 <span class="comment">  BOOL LineNumbers;  </span>
00130 <span class="comment">  BOOL GlobalSymbols;  </span>
00131 <span class="comment">  BOOL TypeInfo;*/</span>
00132 };
00133 <span class="keyword">typedef</span> IMAGEHLP_MODULE64* PIMAGEHLP_MODULE64;
00134 
00135 <span class="keyword">struct </span>IMAGEHLP_LINE64
00136 {  
00137   DWORD SizeOfStruct;  
00138   PVOID Key;  
00139   DWORD LineNumber;  
00140   PCHAR FileName;  
00141   uint64 Address;
00142 };
00143 <span class="keyword">typedef</span> IMAGEHLP_LINE64* PIMAGEHLP_LINE64;
00144 
00145 <span class="keyword">typedef</span> BOOL (CALLBACK* PSYM_ENUMERATESYMBOLS_CALLBACK) (PSYMBOL_INFO pSymInfo,
00146   ULONG SymbolSize, PVOID UserContext);
00147 <span class="keyword">typedef</span> BOOL (CALLBACK* PSYM_ENUMMODULES_CALLBACK64) (PSTR ModuleName,
00148   uint64 BaseOfDll, PVOID UserContext);
00149 
00150 <span class="keyword">struct </span>IMAGEHLP_STACK_FRAME 
00151 {  
00152   uint64 InstructionOffset;  
00153   uint64 ReturnOffset;  
00154   uint64 FrameOffset;  
00155   uint64 StackOffset;  
00156   uint64 BackingStoreOffset;  
00157   uint64 FuncTableEntry;  
00158   uint64 Params[4];  
00159   uint64 Reserved[5];  
00160   BOOL Virtual;  
00161   ULONG Reserved2;
00162 };
00163 <span class="keyword">typedef</span> IMAGEHLP_STACK_FRAME* PIMAGEHLP_STACK_FRAME;
00164 <span class="keyword">typedef</span> <span class="keywordtype">void</span>* PIMAGEHLP_CONTEXT;
00165 
00166 <span class="keyword">struct </span>MINIDUMP_EXCEPTION_INFORMATION 
00167 {  
00168   DWORD ThreadId;  
00169   PEXCEPTION_POINTERS ExceptionPointers;  
00170   BOOL ClientPointers;
00171 };
00172 <span class="keyword">typedef</span> MINIDUMP_EXCEPTION_INFORMATION* PMINIDUMP_EXCEPTION_INFORMATION;
00173 
00174 <span class="keyword">struct </span>MINIDUMP_USER_STREAM 
00175 {  
00176   ULONG32 Type;  
00177   ULONG BufferSize;  
00178   PVOID Buffer;
00179 };
00180 <span class="keyword">typedef</span> MINIDUMP_USER_STREAM* PMINIDUMP_USER_STREAM;
00181                                                     
00182 <span class="keyword">struct </span>MINIDUMP_USER_STREAM_INFORMATION 
00183 {  
00184   ULONG UserStreamCount;  
00185   PMINIDUMP_USER_STREAM UserStreamArray;
00186 };
00187 <span class="keyword">typedef</span> MINIDUMP_USER_STREAM_INFORMATION* PMINIDUMP_USER_STREAM_INFORMATION;
00188 
00189 <span class="keyword">enum</span> MINIDUMP_CALLBACK_TYPE
00190 {
00191   ModuleCallback, 
00192   ThreadCallback, 
00193   ThreadExCallback, 
00194   IncludeThreadCallback, 
00195   IncludeModuleCallback
00196 };
00197 
00198 <span class="keyword">struct </span>MINIDUMP_THREAD_CALLBACK 
00199 {  
00200   ULONG ThreadId;  
00201   HANDLE ThreadHandle;  
00202   CONTEXT Context;  
00203   ULONG SizeOfContext;  
00204   ULONG64 StackBase;  
00205   ULONG64 StackEnd;
00206 };
00207 <span class="keyword">typedef</span> MINIDUMP_THREAD_CALLBACK* PMINIDUMP_THREAD_CALLBACK;
00208 
00209 <span class="keyword">struct </span>MINIDUMP_THREAD_EX_CALLBACK 
00210 {  
00211   ULONG ThreadId;  
00212   HANDLE ThreadHandle;  
00213   CONTEXT Context;  
00214   ULONG SizeOfContext;  
00215   ULONG64 StackBase;  
00216   ULONG64 StackEnd;  
00217   ULONG64 BackingStoreBase;  
00218   ULONG64 BackingStoreEnd;
00219 };
00220 <span class="keyword">typedef</span> MINIDUMP_THREAD_EX_CALLBACK* PMINIDUMP_THREAD_EX_CALLBACK;
00221 
00222 <span class="preprocessor">#include &lt;winver.h&gt;</span>
00223 <span class="preprocessor">#include "sanity.inc"</span>
00224 
00225 <span class="keyword">struct </span>MINIDUMP_MODULE_CALLBACK 
00226 {  
00227   PWCHAR FullPath;  
00228   ULONG64 BaseOfImage;  
00229   ULONG SizeOfImage;  
00230   ULONG CheckSum;  
00231   ULONG TimeDateStamp;  
00232   VS_FIXEDFILEINFO VersionInfo;  
00233   PVOID CvRecord;  
00234   ULONG SizeOfCvRecord;  
00235   PVOID MiscRecord;  
00236   ULONG SizeOfMiscRecord;
00237 };
00238 <span class="keyword">typedef</span> MINIDUMP_MODULE_CALLBACK* PMINIDUMP_MODULE_CALLBACK;
00239 
00240 <span class="keyword">struct </span>MINIDUMP_INCLUDE_THREAD_CALLBACK 
00241 {  
00242   ULONG ThreadId;
00243 };
00244 <span class="keyword">typedef</span> MINIDUMP_INCLUDE_THREAD_CALLBACK* PMINIDUMP_INCLUDE_THREAD_CALLBACK;
00245 
00246 <span class="keyword">struct </span>MINIDUMP_INCLUDE_MODULE_CALLBACK 
00247 {  
00248   ULONG64 BaseOfImage;
00249 };
00250 <span class="keyword">typedef</span> MINIDUMP_INCLUDE_MODULE_CALLBACK* PMINIDUMP_INCLUDE_MODULE_CALLBACK;
00251 
00252 
00253 <span class="keyword">struct </span>MINIDUMP_CALLBACK_INPUT       
00254 {  
00255   ULONG ProcessId;  
00256   HANDLE ProcessHandle;  
00257   ULONG CallbackType;  
00258   <span class="keyword">union </span>
00259 <span class="keyword">  </span>{    
00260     MINIDUMP_THREAD_CALLBACK Thread;    
00261     MINIDUMP_THREAD_EX_CALLBACK ThreadEx;    
00262     MINIDUMP_MODULE_CALLBACK Module;    
00263     MINIDUMP_INCLUDE_THREAD_CALLBACK IncludeThread;    
00264     MINIDUMP_INCLUDE_MODULE_CALLBACK IncludeModule;  
00265   };
00266 };
00267 <span class="keyword">typedef</span> MINIDUMP_CALLBACK_INPUT* PMINIDUMP_CALLBACK_INPUT;
00268 
00269 <span class="keyword">enum</span> MODULE_WRITE_FLAGS
00270 {
00271   ModuleWriteModule                     = 0x0001, 
00272   ModuleWriteDataSeg                    = 0x0002, 
00273   ModuleWriteMiscRecord                 = 0x0004, 
00274   ModuleWriteCvRecord                   = 0x0008, 
00275   ModuleReferencedByMemory              = 0x0010
00276 };
00277 
00278 <span class="keyword">enum</span> THREAD_WRITE_FLAGS
00279 {
00280   ThreadWriteThread                     = 0x0001, 
00281   ThreadWriteStack                      = 0x0002, 
00282   ThreadWriteContext                    = 0x0004, 
00283   ThreadWriteBackingStore               = 0x0008, 
00284   ThreadWriteInstructionWindow          = 0x0010, 
00285   ThreadWriteThreadData                 = 0x0020
00286 };
00287 
00288 <span class="keyword">struct </span>MINIDUMP_CALLBACK_OUTPUT 
00289 {  
00290   <span class="keyword">union </span>
00291 <span class="keyword">  </span>{    
00292     ULONG ModuleWriteFlags;    
00293     ULONG ThreadWriteFlags;  
00294   };
00295 }; 
00296 <span class="keyword">typedef</span> MINIDUMP_CALLBACK_OUTPUT* PMINIDUMP_CALLBACK_OUTPUT;
00297 
00298 
00299 <span class="keyword">typedef</span> BOOL (CALLBACK* MINIDUMP_CALLBACK_ROUTINE) (PVOID CallbackParam, 
00300   <span class="keyword">const</span> PMINIDUMP_CALLBACK_INPUT CallbackInput, 
00301   PMINIDUMP_CALLBACK_OUTPUT CallbackOutput);
00302 
00303 <span class="keyword">struct </span>MINIDUMP_CALLBACK_INFORMATION 
00304 {  
00305   MINIDUMP_CALLBACK_ROUTINE CallbackRoutine;  
00306   PVOID CallbackParam;
00307 };
00308 <span class="keyword">typedef</span> MINIDUMP_CALLBACK_INFORMATION* PMINIDUMP_CALLBACK_INFORMATION;
00309 
00310 <span class="keyword">enum</span> MINIDUMP_TYPE
00311 {
00312   MiniDumpNormal                          = 0x0000, 
00313   MiniDumpWithDataSegs                    = 0x0001, 
00314   MiniDumpWithFullMemory                  = 0x0002, 
00315   MiniDumpWithHandleData                  = 0x0004, 
00316   MiniDumpFilterMemory                    = 0x0008, 
00317   MiniDumpScanMemory                      = 0x0010, 
00318   MiniDumpWithUnloadedModules             = 0x0020, 
00319   MiniDumpWithIndirectlyReferencedMemory  = 0x0040, 
00320   MiniDumpFilterModulePaths               = 0x0080, 
00321   MiniDumpWithProcessThreadData           = 0x0100, 
00322   MiniDumpWithPrivateReadWriteMemory      = 0x0200
00323 };
00324 
00325 <span class="keyword">enum</span> MINIDUMP_STREAM_TYPE
00326 {
00327   UnusedStream             = 0, 
00328   ReservedStream0          = 1, 
00329   ReservedStream1          = 2, 
00330   ThreadListStream         = 3, 
00331   ModuleListStream         = 4, 
00332   MemoryListStream         = 5, 
00333   ExceptionStream          = 6, 
00334   SystemInfoStream         = 7, 
00335   ThreadExListStream       = 8, 
00336   Memory64ListStream       = 9, 
00337   CommentStreamA           = 10, 
00338   CommentStreamW           = 11, 
00339   HandleDataStream         = 12, 
00340   FunctionTableStream      = 13, 
00341   UnloadedModuleListStream = 14, 
00342   MiscInfoStream           = 15, 
00343   LastReservedStream = 0xffff
00344 };
00345 
00346 <span class="keyword">struct </span>MINIDUMP_LOCATION_DESCRIPTOR 
00347 {  
00348   uint32 DataSize;  
00349   uint32 Rva;
00350 };
00351 
00352 <span class="keyword">struct </span>MINIDUMP_MEMORY_DESCRIPTOR 
00353 {  
00354   uint64 StartOfMemoryRange;  
00355   MINIDUMP_LOCATION_DESCRIPTOR Memory;
00356 };
00357 <span class="keyword">typedef</span> MINIDUMP_MEMORY_DESCRIPTOR* PMINIDUMP_MEMORY_DESCRIPTOR;
00358 
00359 <span class="keyword">struct </span>MINIDUMP_MEMORY_LIST 
00360 {  
00361   ULONG32 NumberOfMemoryRanges;  
00362   <span class="comment">/*MINIDUMP_MEMORY_DESCRIPTOR MemoryRanges[];*/</span>
00363 };
00364 <span class="keyword">typedef</span> MINIDUMP_MEMORY_LIST* PMINIDUMP_MEMORY_LIST;
00365 
00366 <span class="keyword">struct </span>MINIDUMP_HEADER 
00367 {
00368   ULONG32 Signature;
00369   ULONG32 Version;
00370   ULONG32 NumberOfStreams;
00371   uint32 StreamDirectoryRva;
00372   ULONG32 CheckSum;
00373   <span class="keyword">union </span>
00374 <span class="keyword">  </span>{
00375     ULONG32 Reserved;
00376     ULONG32 TimeDateStamp;
00377   };
00378   uint64 Flags;
00379 };
00380 <span class="keyword">typedef</span> MINIDUMP_HEADER* PMINIDUMP_HEADER;
00381 
00382 <span class="keyword">struct </span>MINIDUMP_DIRECTORY 
00383 {
00384   ULONG32 StreamType;
00385   MINIDUMP_LOCATION_DESCRIPTOR Location;
00386 };
00387 <span class="keyword">typedef</span> MINIDUMP_DIRECTORY* PMINIDUMP_DIRECTORY;
00388 
00389 <span class="preprocessor">#define CS_API_NAME             DbgHelp</span>
00390 <span class="preprocessor"></span><span class="preprocessor">#define CS_API_FUNCTIONS        "csutil/win32/DbgHelpAPI.fun"</span>
00391 <span class="preprocessor"></span>
00392 <span class="preprocessor">#include "APIdeclare.inc"</span>
00393 
00394 <span class="preprocessor">#endif //__CSUTIL_DEBGHELPAPI_H__</span>
</pre></div><hr><address><small>Generated for Crystal Space by 
<a href="http://www.doxygen.org/index.html">doxygen</a> 1.2.18 
</small></address> </div></body> </html>
