<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csutil/bintree.h Source File (Crystal Space Public API Reference)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<table border="0" cellpadding="0" cellspacing="0" width="100%" class="head">
 <tr heigth="59">
  <td class="head" width="202" valign="bottom" style="padding-left:0;"><a href="http://crystal.sourceforge.net/"><img src="csblur.png" width="236" height="59" alt="CrystalSpace" border="0"></a></td>
  <td class="head"><h2>Public API Reference</h2></td>
 </tr>
 <tr heigth="11">
  <td colspan="2" class="headshadow" valign="top" style="padding-left:0;"><img src="csblurb.png" width="236" height="11" alt="" border="0"></td>
 </tr>
</table>
<div class="content">
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csutil/bintree.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">    Copyright (C) 2003 by Mat Sutcliffe &lt;oktal@gmx.co.uk&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00005 <span class="comment">    modify it under the terms of the GNU Lesser General Public</span>
00006 <span class="comment">    License as published by the Free Software Foundation; either</span>
00007 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00008 <span class="comment"></span>
00009 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00010 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00012 <span class="comment">    Library General Public License for more details.</span>
00013 <span class="comment"></span>
00014 <span class="comment">    You should have received a copy of the GNU Library General Public</span>
00015 <span class="comment">    License along with this library; if not, write to the Free</span>
00016 <span class="comment">    Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
00017 <span class="comment">*/</span>
00018 
00019 <span class="preprocessor">#ifndef __CS_UTIL_BINTREE_H__</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define __CS_UTIL_BINTREE_H__</span>
00021 <span class="preprocessor"></span>
00022 <span class="preprocessor">#include "blockallocator.h"</span>
00023 
<a name="l00027"></a><a class="code" href="classcsTree.html">00027</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classcsTree.html">csTree</a>
00028 {
00029 <span class="keyword">private</span>:
00030   <span class="keyword">struct </span>Element
00031   {
00032     uint32 key;
00033     T value;
00034     Element *left, *right;
00035 
00036     <span class="keyword">inline</span> Element () {}
00037     <span class="keyword">inline</span> Element (uint32 key0, <span class="keyword">const</span> T &amp;value0,
00038       Element *left0 = 0, Element *right0 = 0)
00039     : key (key0), value (value0), left (left0), right (right0) {}
00040     <span class="keyword">inline</span> Element (<span class="keyword">const</span> Element &amp;o)
00041     : key (o.key), value (o.value), left (o.left), right (o.right) {}
00042   };
00043   Element *Root;
00044   <a class="code" href="classcsBlockAllocator.html">csBlockAllocator&lt;Element&gt;</a> Pool;
00045   <span class="keywordtype">int</span> BS;
00046   <span class="keywordtype">int</span> Size;
00047 
00048   <span class="keyword">inline</span> Element* New (uint32 key,
00049     Element *left = 0, Element *right = 0)
00050   {
00051     Element *e = Pool.<a class="code" href="classcsBlockAllocator.html#a3">Alloc</a> ();
00052     e-&gt;key = key;
00053     e-&gt;left = left;
00054     e-&gt;right = right;
00055     <span class="keywordflow">return</span> e;
00056   }
00057 
00058   <span class="keyword">inline</span> Element* New (uint32 key, <span class="keyword">const</span> T &amp;value,
00059     Element *left = 0, Element *right = 0)
00060   {
00061     Element *e = Pool.<a class="code" href="classcsBlockAllocator.html#a3">Alloc</a> ();
00062     e-&gt;key = key;
00063     e-&gt;value = value;
00064     e-&gt;left = left;
00065     e-&gt;right = right;
00066     <span class="keywordflow">return</span> e;
00067   }
00068 
00069   <span class="keywordtype">void</span> Copy (Element *dest, <span class="keyword">const</span> Element *src)
00070   {
00071     dest-&gt;key = src-&gt;key;
00072     dest-&gt;value = src-&gt;value;
00073     <span class="keywordflow">if</span> (src-&gt;left) Copy (dest-&gt;left = Pool.<a class="code" href="classcsBlockAllocator.html#a3">Alloc</a> (), src-&gt;left);
00074     <span class="keywordflow">else</span> dest-&gt;left = 0;
00075     <span class="keywordflow">if</span> (src-&gt;right) Copy (dest-&gt;right = Pool.<a class="code" href="classcsBlockAllocator.html#a3">Alloc</a> (), src-&gt;right);
00076     <span class="keywordflow">else</span> dest-&gt;right = 0;
00077   }
00078 
00079   <span class="keywordtype">void</span> DeleteTree (Element *e)
00080   {
00081     <span class="keywordflow">if</span> (e-&gt;left) DeleteTree (e-&gt;left);
00082     <span class="keywordflow">if</span> (e-&gt;right) DeleteTree (e-&gt;right);
00083     Pool.<a class="code" href="classcsBlockAllocator.html#a4">Free</a> (e);
00084   }
00085 
00086   Element* Populate (<span class="keyword">const</span> <a class="code" href="classcsArray.html">csArray&lt;uint32&gt;</a> &amp;keys, <span class="keyword">const</span> <a class="code" href="classcsArray.html">csArray&lt;T&gt;</a> &amp;values)
00087   {
00088     <span class="keywordtype">int</span> len = keys.<a class="code" href="classcsArray.html#a4">Length</a> ();
00089     <span class="keywordflow">if</span> (! len) <span class="keywordflow">return</span> 0;
00090     <span class="keywordtype">int</span> mid = len / 2;
00091     <span class="keywordflow">return</span> New (keys[mid], values[mid],
00092       Populate (keys.Section (0, mid-1), values.Section (0, mid-1)),
00093       Populate (keys.Section (mid+1, len-1), values.Section (mid+1, len-1)));
00094   }
00095 
00097   <span class="keyword">typedef</span> <span class="keywordtype">void</span> TraverseFunc (uint32 key, <span class="keyword">const</span> T &amp;value, <span class="keywordtype">void</span> *some);
00098 
00099   <span class="keywordtype">void</span> <a class="code" href="classcsTree.html#a3">Traverse</a> (<span class="keyword">const</span> Element *e, TraverseFunc *func, <span class="keywordtype">void</span> *some)<span class="keyword"> const</span>
00100 <span class="keyword">  </span>{
00101     func (e-&gt;key, e-&gt;value, some);
00102     <span class="keywordflow">if</span> (e-&gt;left) <a class="code" href="classcsTree.html#a3">Traverse</a> (e-&gt;left, func, some);
00103     <span class="keywordflow">if</span> (e-&gt;right) <a class="code" href="classcsTree.html#a3">Traverse</a> (e-&gt;right, func, some);
00104   }
00105 
00106 <span class="keyword">public</span>:
<a name="l00111"></a><a class="code" href="classcsTree.html#a0">00111</a>   <a class="code" href="classcsTree.html#a0">csTree</a> (<span class="keywordtype">int</span> blocksize = 15)
00112     : Pool (blocksize), BS (blocksize), Size (0), Root (0) {}
00113 
<a name="l00115"></a><a class="code" href="classcsTree.html#a1">00115</a>   <a class="code" href="classcsTree.html#a0">csTree</a> (<span class="keyword">const</span> <a class="code" href="classcsTree.html">csTree&lt;T&gt;</a> &amp;other)
00116     : Pool (other.BS), BS (other.BS), Size (other.Size)
00117   {
00118     <span class="keywordflow">if</span> (other.Root) Copy (Root = Pool.<a class="code" href="classcsBlockAllocator.html#a3">Alloc</a> (), other.Root);
00119     <span class="keywordflow">else</span> Root = 0;
00120   }
00121 
<a name="l00123"></a><a class="code" href="classcsTree.html#a2">00123</a>   <span class="keywordtype">void</span> <a class="code" href="classcsTree.html#a2">PopulateWith</a> (<span class="keyword">const</span> <a class="code" href="classcsArray.html">csArray&lt;uint32&gt;</a> &amp;keys, <span class="keyword">const</span> <a class="code" href="classcsArray.html">csArray&lt;T&gt;</a> &amp;values)
00124   {
00125     CS_ASSERT (! Root);
00126     CS_ASSERT (keys.<a class="code" href="classcsArray.html#a4">Length</a> () == values.<a class="code" href="classcsArray.html#a4">Length</a> ());
00127     Root = Populate (keys, values);
00128   }
00129 
<a name="l00131"></a><a class="code" href="classcsTree.html#a3">00131</a>   <span class="keywordtype">void</span> <a class="code" href="classcsTree.html#a3">Traverse</a> (TraverseFunc *func, <span class="keywordtype">void</span> *some)<span class="keyword"> const</span>
00132 <span class="keyword">  </span>{
00133     <span class="keywordflow">if</span> (Root) <a class="code" href="classcsTree.html#a3">Traverse</a> (Root, func, some);
00134   }
00135 
<a name="l00137"></a><a class="code" href="classcsTree.html#a4">00137</a>   <span class="keywordtype">void</span> <a class="code" href="classcsTree.html#a4">Put</a> (uint32 key, <span class="keyword">const</span> T &amp;value)
00138   {
00139     <span class="keywordflow">if</span> (! Root)
00140     {
00141       Root = New (key, value);
00142       Size++;
00143       <span class="keywordflow">return</span>;
00144     }
00145     Element *e = Root;
00146     <span class="keywordflow">while</span> (true)
00147       <span class="keywordflow">if</span> (key &lt; e-&gt;key)
00148       {
00149         <span class="keywordflow">if</span> (e-&gt;left) e = e-&gt;left;
00150         <span class="keywordflow">else</span>
00151         {
00152           e-&gt;left = New (key, value);
00153           Size++;
00154           <span class="keywordflow">return</span>;
00155         }
00156       }
00157       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;key &lt; key)
00158       {
00159         <span class="keywordflow">if</span> (e-&gt;right) e = e-&gt;right;
00160         <span class="keywordflow">else</span>
00161         {
00162           e-&gt;right = New (key, value);
00163           Size++;
00164           <span class="keywordflow">return</span>;
00165         }
00166       }
00167       <span class="keywordflow">else</span>
00168       {
00169         e-&gt;value = value;
00170         <span class="keywordflow">return</span>;
00171       }
00172   }
00173 
<a name="l00175"></a><a class="code" href="classcsTree.html#a5">00175</a>   T&amp; <a class="code" href="classcsTree.html#a5">Find</a> (uint32 key)
00176   {
00177     <span class="keywordflow">if</span> (! Root)
00178     {
00179       Root = New (key);
00180       Size++;
00181       <span class="keywordflow">return</span> Root-&gt;value;
00182     }
00183     Element *e = Root;
00184     <span class="keywordflow">while</span> (true)
00185       <span class="keywordflow">if</span> (key &lt; e-&gt;key)
00186       {
00187         <span class="keywordflow">if</span> (e-&gt;left) e = e-&gt;left;
00188         <span class="keywordflow">else</span>
00189         {
00190           e-&gt;left = New (key);
00191           Size++;
00192           <span class="keywordflow">return</span> e-&gt;left-&gt;value;
00193         }
00194       }
00195       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;key &lt; key)
00196       {
00197         <span class="keywordflow">if</span> (e-&gt;right) e = e-&gt;right;
00198         <span class="keywordflow">else</span>
00199         {
00200           e-&gt;right = New (key);
00201           Size++;
00202           <span class="keywordflow">return</span> e-&gt;right-&gt;value;
00203         }
00204       }
00205       <span class="keywordflow">else</span> <span class="keywordflow">return</span> e-&gt;value;
00206   }
00207 
<a name="l00209"></a><a class="code" href="classcsTree.html#a6">00209</a>   <span class="keyword">const</span> T&amp; <a class="code" href="classcsTree.html#a5">Find</a> (uint32 key)<span class="keyword"> const</span>
00210 <span class="keyword">  </span>{
00211     <span class="keyword">static</span> <span class="keyword">const</span> T zero (0);
00212     <span class="keywordflow">if</span> (! Root) <span class="keywordflow">return</span> zero;
00213     Element *e = Root;
00214     <span class="keywordflow">while</span> (true)
00215       <span class="keywordflow">if</span> (key &lt; e-&gt;key)
00216       {
00217         <span class="keywordflow">if</span> (e-&gt;left) e = e-&gt;left;
00218         <span class="keywordflow">else</span> <span class="keywordflow">return</span> zero;
00219       }
00220       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;key &lt; key)
00221       {
00222         <span class="keywordflow">if</span> (e-&gt;right) e = e-&gt;right;
00223         <span class="keywordflow">else</span> <span class="keywordflow">return</span> zero;
00224       }
00225       <span class="keywordflow">else</span> <span class="keywordflow">return</span> e-&gt;value;
00226   }
00227 
<a name="l00229"></a><a class="code" href="classcsTree.html#a7">00229</a>   <span class="keywordtype">bool</span> <a class="code" href="classcsTree.html#a7">Delete</a> (uint32 key)
00230   {
00231     <span class="keywordflow">if</span> (! Root) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00232     <span class="keywordflow">if</span> (Root-&gt;key == key)
00233     {
00234       Pool.<a class="code" href="classcsBlockAllocator.html#a4">Free</a> (Root);
00235       Root = 0;
00236       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00237     }
00238 
00239     <span class="keywordtype">bool</span> left;
00240     Element *old, *e = Root;
00241     <span class="keywordflow">while</span> (true)
00242       <span class="keywordflow">if</span> (key &lt; e-&gt;key)
00243       {
00244         <span class="keywordflow">if</span> (e-&gt;left) e = e-&gt;left;
00245         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
00246         left = <span class="keyword">true</span>;
00247         old = e;
00248       }
00249       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;key &lt; key)
00250       {
00251         <span class="keywordflow">if</span> (e-&gt;right) e = e-&gt;right;
00252         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
00253         left = <span class="keyword">false</span>;
00254         old = e;
00255       }
00256       <span class="keywordflow">else</span>
00257       {
00258         <span class="keywordflow">if</span> (e-&gt;left)
00259         {
00260           <span class="keywordflow">if</span> (e-&gt;right)
00261           {
00262             Element *promoteold = e, *promote = e-&gt;right;
00263             <span class="keywordflow">while</span> (promote-&gt;left)
00264             {
00265               promoteold = promote;
00266               promote = promote-&gt;left;
00267             }
00268             promoteold-&gt;left = 0;
00269             e-&gt;key = promote-&gt;key;
00270             e-&gt;value = promote-&gt;value;
00271             Pool.<a class="code" href="classcsBlockAllocator.html#a4">Free</a> (promote);
00272           }
00273           <span class="keywordflow">else</span>
00274           {
00275             <span class="keywordflow">if</span> (left) old-&gt;left = e-&gt;left;
00276             <span class="keywordflow">else</span> old-&gt;right = e-&gt;left;
00277             Pool.<a class="code" href="classcsBlockAllocator.html#a4">Free</a> (e);
00278           }
00279         }
00280         <span class="keywordflow">else</span>
00281         {
00282           <span class="keywordflow">if</span> (e-&gt;right)
00283           {
00284             <span class="keywordflow">if</span> (left) old-&gt;left = e-&gt;right;
00285             <span class="keywordflow">else</span> old-&gt;right = e-&gt;right;
00286           }
00287           <span class="keywordflow">else</span>
00288           {
00289             <span class="keywordflow">if</span> (left) old-&gt;left = 0;
00290             <span class="keywordflow">else</span> old-&gt;right = 0;
00291           }
00292           Pool.<a class="code" href="classcsBlockAllocator.html#a4">Free</a> (e);
00293         }
00294         Size--;
00295         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00296       }
00297   }
00298 
<a name="l00300"></a><a class="code" href="classcsTree.html#a8">00300</a>   <span class="keywordtype">bool</span> <a class="code" href="classcsTree.html#a8">DeleteAll</a> ()
00301   {
00302     <span class="keywordflow">if</span> (! Root) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00303     DeleteTree (Root);
00304     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00305   }
00306 
<a name="l00308"></a><a class="code" href="classcsTree.html#a9">00308</a>   <span class="keywordtype">int</span> <a class="code" href="classcsTree.html#a9">GetSize</a> ()<span class="keyword"> const</span>
00309 <span class="keyword">  </span>{
00310     <span class="keywordflow">return</span> Size;
00311   }
00312 };
00313 
00314 <span class="preprocessor">#endif</span>
</pre></div><hr><address><small>Generated for Crystal Space by 
<a href="http://www.doxygen.org/index.html">doxygen</a> 1.2.18 
</small></address> </div></body> </html>
