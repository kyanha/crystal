<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: HOWTO User Objects</TITLE>

<META NAME="description" CONTENT="Crystal Space: HOWTO User Objects">
<META NAME="keywords" CONTENT="Crystal Space: HOWTO User Objects">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC5.8.13"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.8.12.html#SEC5.8.12"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.8.14.html#SEC5.8.14"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.7.html#SEC5.7"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.8.html#SEC5.8"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_6.html#SEC6"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs__1.html#SEC_1">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H3> 5.8.13 Attaching User Objects to CS Objects </H3>
<!--docid::SEC5.8.13::-->
<P>

This section explains how you can assign your own game specific data
to Crystal Space objects (i.e. like meshes and sectors). In this section
we explain how to do it from within code. In the next howto
(see section <A HREF="cs_5.8.14.html#SEC5.8.14">5.8.14 Attaching User Objects to CS Objects in a map file</A>) we explain how you can do this from
a map file.
</P><P>

<A NAME="SEC_1"></A>
<H4> The Crystal Space Object System </H4>
<!--docid::SEC_1::-->
<P>

Almost all objects in the Crystal Space engine implement the
<CODE>iObject</CODE> interface. Because of this you can attach your own
objects to them. This can be very useful to attach game specific
data to Crystal Space objects. For example, you may want to attach
the state of an actor to the mesh object representing that actor (like
current amount of ammunition, health, <small>...</small>).
</P><P>

<A NAME="SEC_2"></A>
<H4> Defining Game Data </H4>
<!--docid::SEC_2::-->
<P>

To define data that you can attach to any other Crystal Space
object (or any object implementing <CODE>iObject</CODE>) you also have to
create an object that implements <CODE>iObject</CODE>. The easiest way to do
that is to inherit from <CODE>csObject</CODE> which implements <CODE>iObject</CODE>
for you. Here is an example on how you can do this easily:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>SCF_VERSION (MyOwnData, 0, 0, 1);
class MyOwnData : public csObject
{
public:
  int my_data_int;
  <small>...</small>

  SCF_DECLARE_IBASE_EXT (csObject);
};

SCF_IMPLEMENT_IBASE_EXT (MyOwnData)
  SCF_IMPLEMENTS_INTERFACE (MyOwnData)
SCF_IMPLEMENT_IBASE_EXT_END
</pre></td></tr></table></P><P>

Basically you create a class called `<SAMP>MyOwnData</SAMP>' which inherits
from <CODE>csObject</CODE>. In that class you can do whatever you want
with respect to your own game data. In the example above we only
have a variable `<SAMP>my_data_int</SAMP>' but of course you can do whatever
you want. The SCF macros make sure that you can later query for
that object (using <CODE>SCF_QUERY_INTERFACE()</CODE> for example).
</P><P>

<A NAME="SEC_3"></A>
<H4> Attaching Game Data </H4>
<!--docid::SEC_3::-->
<P>

To attach your own data to some Crystal Space object you can use
<CODE>iObject::ObjAdd()</CODE>. The example below shows how you can attach
an instance of <CODE>MyOwnData</CODE> to a mesh:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>MyOwnData* mydata = new MyOwnData ();
mydata-&#62;my_data_int = <small>...</small>;
iMeshWrapper* mesh = <small>...</small>;
mesh-&#62;QueryObject ()-&#62;ObjAdd (mydata);
mydata-&#62;DecRef ();
</pre></td></tr></table></P><P>

<CODE>mesh-&#62;QueryObject()</CODE> is interesting. Many Crystal Space objects
that implement <CODE>iObject</CODE> have a convenience function called
<CODE>QueryObject()</CODE> which will return a reference to the <CODE>iObject</CODE>
implementation. This code is equivalent to:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csRef&#60;iObject&#62; obj = SCF_QUERY_INTERFACE (mesh, iObject);
</pre></td></tr></table></P><P>

with the important difference that <CODE>QueryObject()</CODE> does not increment
the reference count. If an object doesn't have this convenience function you
must use <CODE>SCF_QUERY_INTERFACE()</CODE> instead.
</P><P>

<A NAME="SEC_4"></A>
<H4> Finding Game Data </H4>
<!--docid::SEC_4::-->
<P>

To find if some object has your data attached to it you can use the
following code:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csRef&#60;MyOwnData&#62; mydata =
  CS_GET_CHILD_OBJECT(mesh-&#62;QueryObject(), MyOwnData);
if (mydata)
{
  <small>...</small> (use mydata)
}
</pre></td></tr></table></P><P>

<A NAME="SEC_5"></A>
<H4> Removing Game Data </H4>
<!--docid::SEC_5::-->
<P>

To remove your data you can use:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csRef&#60;MyOwnData&#62; mydata =
  CS_GET_CHILD_OBJECT(mesh-&#62;QueryObject(), MyOwnData);
if (mydata)
{
  mesh-&#62;QueryObject ()-&#62;ObjRemove (mydata);
}
</pre></td></tr></table></P><P>

<A NAME="SEC_6"></A>
<H4> Include Files          </H4>
<!--docid::SEC_6::-->
<P>

The include files useful for this section are:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>#include &#60;iutil/object.h&#62;
#include &#60;csutil/csobject.h&#62;
</pre></td></tr></table></P><P>

<A NAME="HOWTO User Objects in Maps"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.8.12.html#SEC5.8.12"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.8.14.html#SEC5.8.14"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.7.html#SEC5.7"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_5.8.html#SEC5.8"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_6.html#SEC6"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs__1.html#SEC_1">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
