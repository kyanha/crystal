<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created by texi2html 1.76 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<head>
<title>Crystal Space: 6.2.3 Classes Implementing Multiple Interfaces</title>

<meta name="description" content="Crystal Space: 6.2.3 Classes Implementing Multiple Interfaces">
<meta name="keywords" content="Crystal Space: 6.2.3 Classes Implementing Multiple Interfaces">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.76">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="SCF-Multiple-Interfaces"></a>
<a name="SEC357"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="cs_6.2.2.html#SEC356" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_6.2.4.html#SEC360" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="cs_6.html#SEC350" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_6.2.html#SEC354" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="cs_7.html#SEC371" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="index.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="cs_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="cs_SEC992.html#SEC992" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="cs_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 6.2.3 Classes Implementing Multiple Interfaces </h3>

<p>Sometimes we will want one object to implement several interfaces.  For
example, the 3D graphics driver could provide a basic <samp>`iGraphics3D'</samp>
interface and several additional optional interfaces such as <samp>`iHalo'</samp>,
<samp>`iBumpMap'</samp>, and so on.  There are two ways to do this:
</p>
<ul>
<li>
Via C++ multiple inheritance.

</li><li>
Via object embedding, in which an object that implements another interface is
embedded within the &quot;carrier&quot; object.
</li></ul>

<p>To simplify the following discussion we'll refer them as <em>multiple
interface</em> and <em>embedded interface</em> schemes.
</p>
<a name="SEC358"></a>
<h4 class="subsubheading"> Multiple Interfacing </h4>

<p>You can declare a class to inherit from several interfaces at once.  This is
useful if all implemented interfaces will need to access often same member
variables.  For example, both the <samp>`iHalo'</samp> and <samp>`iBumpMap'</samp>
implementations will need to access many member variables from
<samp>`iGraphics3D'</samp> such as pixel format, screen dimensions and so on.  You
declare such classes this way:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">class MyGraphics3D :
    public iGraphics3D, public iHalo, public iBumpMap
{
public:
  ...
};
</pre></td></tr></table>
<p>When implementing the methods imposed by the <samp>`iBase'</samp> interface you should
use the <code>IMPLEMENT_INTERFACE()</code> macro once for each implemented
interface:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">SCF_IMPLEMENT_IBASE(MyGraphics3D)
  SCF_IMPLEMENTS_INTERFACE(iGraphics3D)
  SCF_IMPLEMENTS_INTERFACE(iHalo)
  SCF_IMPLEMENTS_INTERFACE(iBumpMap)
SCF_IMPLEMENT_IBASE_END
</pre></td></tr></table>
<p><a name="SCF-Embedded-Interfaces"></a>
</p><a name="SEC359"></a>
<h4 class="subsubheading"> Embedded Interfaces </h4>

<p>Another way to implement several interfaces in one object is to embed an
object that implements some interface into another object, known as the
&quot;carrier&quot; object.  This method is preferable when a secondary interface
seldom needs access to the carrier object's members, since you will need to
access them through the <samp>`scfParent'</samp> pointer.  Here is an example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">class MyGraphics3D : public iGraphics3D
{
  // Declare the iHalo embedded interface.
  class MyHalo : public iHalo
  {
    SCF_DECLARE_EMBEDDED_IBASE(MyGraphics3D);
    ...
  } scfiHalo;
  friend MyHalo;

  // Declare the iBumpMap embedded interface.
  class MyBumpMap : public iBumpMap
  {
    SCF_DECLARE_EMBEDDED_IBASE(MyGraphics3D);
    ...
  } scfiBumpMap;
  friend MyBumpMap

public:
  SCF_DECLARE_IBASE;
  ...
};
</pre></td></tr></table>
<p>Note that you don't need to use special names for classes; use anything you
want (that is, the <samp>`My'</samp> prefix is not required; you could name the above
class <samp>`GraphixThreeDeeImplementation'</samp> if you like; this is true for
embedded classes as well). But most <small>SCF</small> macros that have the word
<samp>`EMBEDDED'</samp> within their names expect embedded object names to follow the
form <samp>`scf<var>InterfaceName</var>'</samp>. For instance, <samp>`scfiBase'</samp>,
<samp>`scfiTest'</samp>, <samp>`scfiGraphics3D'</samp>, and so on.
</p>
<p>When you declare the <samp>`iBase'</samp> methods within an embedded class, you can
use the <code>SCF_DECLARE_EMBEDDED_IBASE(<var>OuterClass</var>)</code> macro instead of
<samp>`SCF_DECLARE_IBASE'</samp>. In this case the <samp>`scfParent'</samp> member will be of
type <code><var>OuterClass</var>*</code> rather than of type <code>iBase*</code>; this will
allow the member class to talk with its parent directly, thus allowing for
direct member variables and functions access. In fact, the
<samp>`SCF_DECLARE_IBASE'</samp> macro uses <code>SCF_DECLARE_EMBEDDED_IBASE(iBase)</code>.
<samp>`SCF_DECLARE_EMBEDDED_IBASE'</samp> itself, and has another special
characteristic: It does not use a reference count, as embedded interfaces may
never delete themselves.  <code>IncRef()</code> and <code>DecRef()</code> of embedded
objects simply call the corresponding function of their <samp>`scfParent'</samp>, which
is the object in which they are embedded.
</p>
<p>When using <code>SCF_DECLARE_EMBEDDED_IBASE()</code>, you should implement the
methods with the <code>SCF_IMPLEMENT_EMBEDDED_IBASE()</code> macro instead of
<code>SCF_IMPLEMENT_IBASE()</code>.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">SCF_IMPLEMENT_IBASE(MyGraphics3D)
  SCF_IMPLEMENTS_INTERFACE (iGraphics3D)
  SCF_IMPLEMENTS_EMBEDDED_INTERFACE(iHalo)
  SCF_IMPLEMENTS_EMBEDDED_INTERFACE(iBumpMap)
SCF_IMPLEMENT_IBASE_END

SCF_IMPLEMENT_EMBEDDED_IBASE (MyGraphics3D::MyHalo)
  SCF_IMPLEMENTS_INTERFACE (iHalo)
SCF_IMPLEMENT_EMBEDDED_IBASE_END

SCF_IMPLEMENT_IBASE (MyGraphics3D::MyBumpMap)
  SCF_IMPLEMENTS_INTERFACE (iBumpMap)
SCF_IMPLEMENT_IBASE_END
</pre></td></tr></table>
<p>And, finally, in the parent object's constructor you should initialize all
embedded interface objects with the
<code>SCF_CONSTRUCT_EMBEDDED_IBASE(<var>InterfaceName</var>)</code> macro.  This will
initialize <samp>`scfRefCount'</samp> and <samp>`scfParent'</samp> fields within
<samp>`scf<var>InterfaceName</var>'</samp> member variables to appropriate values (zero and
<samp>`this'</samp>).  Likewise, you should destroy embedded interfaces with the
<code>SCF_DESTRUCT_EMBEDDED_IBASE()</code> macro.  Here is how to do it:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">MyGraphics3D::MyGraphics3D(iBase* iParent)
{
  SCF_CONSTRUCT_IBASE(iParent);
  SCF_CONSTRUCT_EMBEDDED_IBASE(scfiHalo);
  SCF_CONSTRUCT_EMBEDDED_IBASE(scfiBumpMap);
  ...
}

MyGraphics3D::~MyGraphics3D()
{
  ...
  SCF_DESTRUCT_EMBEDDED_IBASE(scfiBumpMap);
  SCF_DESTRUCT_EMBEDDED_IBASE(scfiHalo);
  SCF_DESTRUCT_IBASE();
}
</pre></td></tr></table>
<p>You should not call <code>SCF_CONSTRUCT_IBASE()</code> within embedded object's
constructor since all work needed to initialize <samp>`iBase'</samp> fields is done in
the carrier object's constructor.  Likewise, you should not call
<code>SCF_DESTRUCT_IBASE()</code> within the embedded object's destructor.
</p>
<hr size="1">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="cs_6.2.2.html#SEC356" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_6.2.4.html#SEC360" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="cs_6.html#SEC350" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="cs_6.2.html#SEC354" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="cs_7.html#SEC371" title="Next chapter"> &gt;&gt; </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.76</em></a>.
 </font>
 <br>

</p>
</body>
</html>
