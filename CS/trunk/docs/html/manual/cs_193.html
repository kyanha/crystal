<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: Level of Detail</TITLE>

<META NAME="description" CONTENT="Crystal Space: Level of Detail">
<META NAME="keywords" CONTENT="Crystal Space: Level of Detail">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC460"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_192.html#SEC459"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_194.html#SEC464"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_164.html#SEC400"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_165.html#SEC408"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_197.html#SEC492"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_286.html#SEC961">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H3> 7.5.11 Level of Detail </H3>
<!--docid::SEC460::-->
<P>

<EM>Written by Jorrit Tyberghein,
<A HREF="mailto:jorrit.tyberghein@uz.kuleuven.ac.be">jorrit.tyberghein@uz.kuleuven.ac.be</A>. Last updated 13 August 2003.</EM>
</P><P>

In a 3D engine there are typically two major ways that can be used to
optimize performance (aside from getting better hardware and making better
use of hardware). Those two ways are Visibility Culling
(see section <A HREF="cs_178.html#SEC439">7.5.7 Visibility Culling In Detail</A>) and Level of Detail. In this section we will
talk about the latter.
</P><P>

Level of Detail (or LOD) is the technique of reducing high polygon
models with a simpler representation that renders faster. In contrast with
visibility culling, level of detail can performance even if there are
a lot of objects visible at the same time. Level of Detail is practically
the only way to improve performance in situations where there is not much
culling opportunity (like in a space game).
</P><P>

Crystal Space currently supports two kinds of LOD:
</P><P>

<UL>
<LI>
Static LOD. With this kind of LOD you can let the engine
automatically select between different versions of the same model based
on distance.
<LI>
Progressive LOD. This kind of LOD is supported by 3D sprites and
is also based on distance. The major difference is that this kind of LOD
doesn't use discrete lod levels but instead allows the engine to select
as many triangles from the original model as needed (while still preserving the
original model as much as possible).
</UL>
<P>

In future we will also support other kinds of LOD like imposters.
Also some of the landscape engines support LOD internally.
</P><P>

Also in future there will be a LOD manager. At this moment LOD
is purely distance based but for a given distance the level of detail will
not change. A LOD manager can decide to reduce the lod levels for
certain objects in order to improve overall performance.
</P><P>

<A NAME="SEC461"></A>
<H4> Static LOD From Map File </H4>
<!--docid::SEC461::-->
<P>

Using static LOD from a map file is fairly easy. Here is an example:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;meshobj name="loddy"&#62;
    &#60;nullmesh&#62;
	&#60;min x="-1" y="0" z="-1" /&#62;
	&#60;max x="1" y="2" z="1" /&#62;
    &#60;/nullmesh&#62;
    &#60;staticlod&#62;
	&#60;distance d0="100" d1="10" /&#62;
    &#60;/staticlod&#62;
    &#60;meshobj name="loddy_lowdetail"&#62;
        &#60;lodlevel&#62;0&#60;/lodlevel&#62;
	<small>...</small>
    &#60;/meshobj&#62;
    &#60;meshobj name="loddy_mediumdetail"&#62;
        &#60;lodlevel&#62;1&#60;/lodlevel&#62;
	<small>...</small>
    &#60;/meshobj&#62;
    &#60;meshobj name="loddy_highdetail_upper"&#62;
        &#60;lodlevel&#62;2&#60;/lodlevel&#62;
	<small>...</small>
    &#60;/meshobj&#62;
    &#60;meshobj name="loddy_highdetail_lower"&#62;
        &#60;lodlevel&#62;2&#60;/lodlevel&#62;
	<small>...</small>
    &#60;/meshobj&#62;
    &#60;move&#62;
        <small>...</small>
    &#60;/move&#62;
&#60;/meshobj&#62;
</pre></td></tr></table></P><P>

Let's explain what this example does in more detail. First we
define a mesh object called `<SAMP>loddy</SAMP>'. This is the parent mesh
which represents the actual model but on itself contains no geometry.
So that's why we use `<SAMP>nullmesh</SAMP>'. The box given in the nullmesh
is important as it is used for visibility culling. So you should
make the box larger then any of the objects inside it. Also the center
of the box is used for calculating the distance between the box and
the camera.
</P><P>

Internally LOD uses a function to calculate a detail value betwen
0 and 1 (0 meaning lowest detail, 1 meaning highest):
<TABLE><tr><td>&nbsp;</td><td class=example><pre>  float lod = m * distance + a;
</pre></td></tr></table>The result of this function is capped so it is always between 0 and 1.
</P><P>

Inside the `<SAMP>staticlod</SAMP>' block you can directly specify the `<SAMP>m</SAMP>'
and `<SAMP>a</SAMP>' values but it is often easier to use a short-cut and specify
`<SAMP>d0</SAMP>' and `<SAMP>d1</SAMP>' instead. In the example above we set `<SAMP>d0</SAMP>' equal
to 100 which means that at distance 100 and beyond we will go to lowest possible
detail. We also set `<SAMP>d1</SAMP>' equal to 10 which means that at distance 10
or less the object will use highest detail. Internally `<SAMP>d0</SAMP>' and `<SAMP>d1</SAMP>'
are transformed to `<SAMP>m</SAMP>' and `<SAMP>a</SAMP>' using the following equation:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>  float m = 1.0 / (d1-d0);
  float a = -m * d0;
</pre></td></tr></table></P><P>

After this we have four child meshes representing the different detail
levels. Using the `<SAMP>lodlevel</SAMP>' keyword one can place a child mesh at
a LOD index. These indices always start at 0 for lowest detail and
can go as high as you want. The maximum index that is used will be
represented by detail level equal to 1.
</P><P>

Interesting in the example above is that there are two meshes for level
2. This means that at the highest detail level we actually use two sub-meshes
to represent our mesh. Using this trick one can also use static lod to replace
individual trees with collections of trees.
</P><P>

Note that it is also possible to define static LOD on a hierarchical
mesh factory using the same syntax as described above. In that case one can
use `<SAMP>meshref</SAMP>' to make an instance of that hierarchical factory
(or use <CODE>iMeshFactoryWrapper-&#62;CreateMeshWrapper()</CODE>).
</P><P>

Note that it is also possible to use variables for `<SAMP>m</SAMP>' and `<SAMP>v</SAMP>'.
One can do that like this:
<TABLE><tr><td>&nbsp;</td><td class=example><pre>    &#60;variables&#62;
        &#60;variable name="Lod M" value="-.1" /&#62;
        &#60;variable name="Lod A" value=".5" /&#62;
    &#60;/variables&#62;
    <small>...</small>
    &#60;staticlod&#62;
	&#60;distance varm="Lod M" vara="Lod A" /&#62;
    &#60;/staticlod&#62;
</pre></td></tr></table>The advantage of this technique is that one can then use the same
LOD values for different objects and modify them easily. Also one
can modify the variables at runtime too with an immediate effect.
</P><P>

<A NAME="SEC462"></A>
<H4> Static LOD From Code </H4>
<!--docid::SEC462::-->
<P>

Using static LOD from code is very easy. One basically has to create
a hierarchical mesh, followed by a static LOD object and then the
children which should be added to the right LOD level. Here follows
an example which roughly does the same as our map example in the previous
section:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>  csRef&#60;iMeshWrapper&#62; loddy_mesh = Engine-&#62;CreateMeshWrapper (
	"crystalspace.mesh.object.null", "loddy");
  csRef&#60;iNullMeshState&#62; nullmesh = SCF_QUERY_INTERFACE (
    	loddy_mesh-&#62;GetMeshObject (), iNullMeshState);
  nullmesh-&#62;SetBoundingBox (csBox3 (
	csVector3 (-1, 0, -1), csVector3 (1, 2, 1)));

  iLODControl* lodctrl = loddy_mesh-&#62;CreateStaticLOD ();
  float d0 = 100;
  float d1 = 10;
  float m = 1.0 / (d1-d0);
  float a = -m * d0;
  lodctrl-&#62;SetLOD (m, a);

  csRef&#60;iMeshWrapper&#62; loddy_lowdetail = <small>...</small>
  loddy_mesh-&#62;GetChildren ()-&#62;Add (loddy_lowdetail);
  loddy_mesh-&#62;AddMeshToStaticLOD (0, loddy_lowdetail);
  <small>...</small>
  csRef&#60;iMeshWrapper&#62; loddy_meddetail = <small>...</small>
  loddy_mesh-&#62;GetChildren ()-&#62;Add (loddy_meddetail);
  loddy_mesh-&#62;AddMeshToStaticLOD (1, loddy_meddetail);
  <small>...</small>
</pre></td></tr></table></P><P>

<A NAME="SEC463"></A>
<H4> Progressive LOD </H4>
<!--docid::SEC463::-->
<P>

To-Do<small>...</small> @@@
<A NAME="Sequence Manager"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_192.html#SEC459"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_194.html#SEC464"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_164.html#SEC400"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_165.html#SEC408"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_197.html#SEC492"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_286.html#SEC961">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
