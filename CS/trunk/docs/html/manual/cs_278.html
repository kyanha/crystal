<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: Release Notes 100</TITLE>

<META NAME="description" CONTENT="Crystal Space: Release Notes 100">
<META NAME="keywords" CONTENT="Crystal Space: Release Notes 100">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC819"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_277.html#SEC818"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_279.html#SEC825"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_277.html#SEC818"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_277.html#SEC818"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_286.html#SEC948"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_286.html#SEC948">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H2> C.1 Release Notes from 0.98 to 1.00 </H2>
<!--docid::SEC819::-->
<P>

This section documents the major changes between versions 0.98 and 1.00 of
Crystal Space.
</P><P>

<A NAME="SEC820"></A>
<H3> <CODE>csArray&#60;&#62;</CODE> Index and Size Type Change </H3>
<!--docid::SEC820::-->
<P>

<CODE>csArray&#60;&#62;</CODE> has been changed to use the <CODE>size_t</CODE> instead of
`<SAMP>int</SAMP>' for array sizes and indices.  Probably, the most significant
semantic difference of this change is that `<SAMP>size_t</SAMP>' is <EM>unsigned</EM> as
opposed to `<SAMP>int</SAMP>' which is <EM>signed</EM>.
</P><P>

<STRONG>Read this paragraph carefully.</STRONG> In actual code, this change may result
in nothing more than simple-looking compiler warnings. However, it may have
caused <EM>semantics</EM> to change subtly.
</P><P>

This has the greatest impact in the following areas discussed below.
</P><P>

<A NAME="SEC821"></A>
<H4> Iterating Over <CODE>csArray&#60;&#62;</CODE> Contents </H4>
<!--docid::SEC821::-->
<P>

For this purpose, usually, `<SAMP>int</SAMP>' typed variables were used for keeping
track of the index of the current item of an array iteration.  Fixing forward
iteration over a <CODE>csArray&#60;&#62;</CODE> to instead use `<SAMP>size_t</SAMP>' is simple:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; a;
for (int i = 0, n = a.Length(); i &#60; n; i++)
{
  <small>...</small>
}
</pre></td></tr></table></P><P>

Is changed to:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre><small>...</small>
for (size_t i = 0, n = a.Length(); i &#60; n; i++)
<small>...</small>
</pre></td></tr></table></P><P>

Backward iteration is a bit more problematic. As mentioned before, 
`<SAMP>size_t</SAMP>' is unsigned, so you do not have negative values. This can be a
problem in constructs like:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; a;
for (int i = a.Length() - 1; i &#62;= 0; i--)
{
  <small>...</small>
}
</pre></td></tr></table></P><P>

If the `<SAMP>int</SAMP>' is changed simply to a `<SAMP>size_t</SAMP>', this 
<CODE>for</CODE>-loop misbehaves unexpectedly. When `<SAMP>i</SAMP>' becomes 0, the body 
of the loop is executed correctly. However, decrementing `<SAMP>i</SAMP>' will 
<STRONG>not</STRONG> cause `<SAMP>i</SAMP>' to have a negative value--after all, `<SAMP>size_t</SAMP>'
is unsigned. Instead, decrementing will make `<SAMP>i</SAMP>' wrap around from 0 to
0xffffffff (on 32-bit machines). Clearly, this is greater
than 0, effectively causing an infinite loop. The same thing also happens when
`<SAMP>a</SAMP>' has no items (i.e. `<SAMP>a.Length() == 0</SAMP>'). Here the
-1 in the initialization of `<SAMP>i</SAMP>' causes wrap-around.
</P><P>

Possible solutions include:
</P><P>

<UL>
<LI>
Use an <CODE>int</CODE>-typed counter variable and cast the array length to
`<SAMP>int</SAMP>'.  This is not entirely elegant, but it does the job in most cases.
<P>

<LI>
Re-write the loop to deal properly with the unsigned nature of `<SAMP>size_t</SAMP>':
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; a;
for (size_t i = a.Length(); i-- &#62; 0;)
{
  <small>...</small>
}
</pre></td></tr></table></P><P>

This code does the same as the `<SAMP>int</SAMP>' version above, iterating from 
`<SAMP>a.Length() - 1</SAMP>' to 0, inclusively. It also correctly works
in the case `<SAMP>a.Length() == 0</SAMP>'. The "trick" is to place the 
modification of `<SAMP>i</SAMP>' as a post-decrement in the loop condition. This 
way, as soon as `<SAMP>i</SAMP>' becomes 0, the loop is terminated. The 
post-decrement ensures that `<SAMP>i</SAMP>' has the expected value in the loop body.
</P><P>

</UL>
<P>

<A NAME="SEC822"></A>
<H4> Searching </H4>
<!--docid::SEC822::-->
<P>

Functions like <CODE>csArray&#60;&#62;::FindSortedKey()</CODE> and <CODE>csArray&#60;&#62;::Find()</CODE>
used to return -1 to signify that an item was not found.  This is still the
case, but with a twist.  Now, `<SAMP>(size_t)-1</SAMP>' is returned.  For convenience,
a constant, `<SAMP>csArrayItemNotFound</SAMP>', has been added, which has this exact
value.  It can be used in comparions to make it clear what is actually being
checked.
</P><P>

Apropros comparisons: Recall that `<SAMP>size_t</SAMP>' is <EM>unsigned</EM>, so checking
whether an index returned by `<SAMP>FindSortedKey()</SAMP>' or `<SAMP>Find()</SAMP>' is 
actually a valid index by testing with `<SAMP>&#62;= 0</SAMP>' no longer works since
`<SAMP>(size_t)-1</SAMP>' is always <CODE>&#62;= 0</CODE>. Replace such checks with tests of
equality against `<SAMP>csArrayItemNotFound</SAMP>':
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; a;
int index = a.Find (<small>...</small>);
if (index &#62;= 0)
{
  /* Item found */
  <small>...</small>
}
else
{
  /* Item not found */
  <small>...</small>
}
</pre></td></tr></table></P><P>

Must be replaced with:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>csArray&#60;<small>...</small>&#62; a;
size_t index = a.Find (<small>...</small>);
if (index != csArrayItemNotFound)
{
  /* Item found */
  <small>...</small>
}
else
{
  /* Item not found */
  <small>...</small>
}
</pre></td></tr></table></P><P>

<A NAME="SEC823"></A>
<H3> Texture and Material Preparation </H3>
<!--docid::SEC823::-->
<P>

Texture and material preparation is now fully automatic. It is no longer
necessary to <EM>prepare</EM> a texture or a material before you can use it. It is
sufficient simply to register the texture or material. This means that the
following functions have been removed (and you can just remove invocations of
them from your applications if you used them):
</P><P>

<UL>
<LI>
<CODE>iMaterialHandle::Prepare()</CODE>
<LI>
<CODE>iTextureHandle::Prepare()</CODE>
<LI>
<CODE>iTextureManager::PrepareMaterials()</CODE>
<LI>
<CODE>iTextureManager::PrepareTextures()</CODE>
</UL>
<P>

<A NAME="SEC824"></A>
<H3> Pollution Reduction </H3>
<!--docid::SEC824::-->
<P>

The following global header files have been renamed in order to avoid possible
conflict with headers installed by other packages.
</P><P>

<UL>
<LI>
<CODE>platform.h</CODE> => <CODE>csplatform.h</CODE>
<LI>
<CODE>qint.h</CODE> => <CODE>csqint.h</CODE>
<LI>
<CODE>qsqrt.h</CODE> => <CODE>csqsqrt.h</CODE>
<LI>
<CODE>volatile.h</CODE> => <CODE>csconfig.h</CODE>
</UL>
<P>

The following symbols have been renamed in order to avoid pollution of the
global namespace.
</P><P>

<UL>
<LI>
<CODE>QInt</CODE> => <CODE>csQint()</CODE>
<LI>
<CODE>QInt8</CODE> => <CODE>csQint8()</CODE>
<LI>
<CODE>QInt16</CODE> => <CODE>csQint16()</CODE>
<LI>
<CODE>QInt24</CODE> => <CODE>csQint24()</CODE>
<LI>
<CODE>qisqrt</CODE> => <CODE>csQisqrt()</CODE>
<LI>
<CODE>qsqrt</CODE> => <CODE>csQsqrt()</CODE>
<LI>
<CODE>QRound</CODE> => <CODE>csQround()</CODE>
<LI>
<CODE>COMP_BC</CODE> => <CODE>CS_COMPILER_BCC</CODE>
<LI>
<CODE>COMP_GCC</CODE> => <CODE>CS_COMPILER_GCC</CODE>
<LI>
<CODE>COMP_VC</CODE> => <CODE>CS_COMPILER_MSVC</CODE>
<LI>
<CODE>DO_MMX</CODE> => <CODE>CS_USE_MMX</CODE>
<LI>
<CODE>DO_NASM</CODE> => <CODE>CS_USE_NASM</CODE>
<LI>
<CODE>OS_DOS</CODE> => <CODE>CS_PLATFORM_DOS</CODE>
<LI>
<CODE>OS_MACOSX</CODE> => <CODE>CS_PLATFORM_MACOSX</CODE>
<LI>
<CODE>OS_UNIX</CODE> => <CODE>CS_PLATFORM_UNIX</CODE>
<LI>
<CODE>OS_WIN32</CODE> => <CODE>CS_PLATFORM_WIN32</CODE>
<LI>
<CODE>PROC_FOO</CODE> => <CODE>CS_PROCESSOR_FOO</CODE> (where `<SAMP>FOO</SAMP>' is
`<SAMP>X86</SAMP>', `<SAMP>M68K</SAMP>', etc.)
<LI>
<CODE>CS_PROCSIZE</CODE> => <CODE>CS_PROCESSOR_SIZE</CODE>
<LI>
<CODE>WIN32_VOLATILE</CODE> => <CODE>CS_WIN32_CSCONFIG</CODE>
</UL>
<A NAME="Release Notes 98"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_277.html#SEC818"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_279.html#SEC825"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_277.html#SEC818"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_277.html#SEC818"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_286.html#SEC948"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_286.html#SEC948">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
