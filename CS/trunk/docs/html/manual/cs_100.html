<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HTML>
<HEAD>
<TITLE>Crystal Space: md32spr Tutorial</TITLE>

<META NAME="description" CONTENT="Crystal Space: md32spr Tutorial">
<META NAME="keywords" CONTENT="Crystal Space: md32spr Tutorial">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC197"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_99.html#SEC196"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_101.html#SEC205"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_88.html#SEC182"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_69.html#SEC153"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_134.html#SEC350"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_292.html#SEC943">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H2> 5.6 <CODE>md32spr</CODE> Tutorial </H2>
<!--docid::SEC197::-->
<P>

<EM>Written by Manjunath Sripadarao, <A HREF="mailto:msripada@evl.uic.edu">msripada@evl.uic.edu</A>.
Last updated 17 December 2002.</EM>
</P><P>

This tutorial provides a brief introduction to <CODE>md32spr</CODE> application.  You
can use this application to convert Quake III MD3 models to Crystal Space
model format.  The <CODE>md32spr</CODE> source files can be found in
`<TT>CS/apps/import/md32spr/</TT>'.  Typing <I>`<SAMP>make md32spr</SAMP>'</I> should build
the application (after configuring Crystal Space for your particular
architecture).
</P><P>

<A NAME="SEC198"></A>
<H3> Required Resources </H3>
<!--docid::SEC198::-->
<P>

For this tutorial we will be using the "Conni" model from
<A HREF="http://www.polycount.com/">http://www.polycount.com/</A>.  The name of the file is
`<TT>mdl-conni.zip</TT>'.  Download the file to a local directory.
</P><P>

<A NAME="SEC199"></A>
<H3> Converting the Model </H3>
<!--docid::SEC199::-->
<P>

<UL>
<LI>
Unzip the contents of `<TT>mdl-conni.zip</TT>' into a temporary directory.
<P>

<LI>
Among the contents, find the file named `<TT>conni.pk3</TT>' and <EM>unzip</EM> it
using a tool which can unpack ZIP-style archives.  (PK3 files are
just ZIP archives in disguise.)
<P>

<LI>
Next go to the directory `<TT>models/players/conni/</TT>'.
<P>

<LI>
Zip the contents of this file using a tool for creating ZIP-style
archives; call this file `<TT>conni.zip</TT>'.
<P>

<LI>
Copy `<TT>conni.zip</TT>' to the `<TT>CS/data/</TT>' directory.
<P>

<LI>
Now run the following command:
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>./md32spr data/conni.zip -o=data/conni_out.zip -scale=4096
</pre></td></tr></table></P><P>

<LI>
This should give you an output file named `<TT>conni_out.zip</TT>' in the
`<TT>CS/data/</TT>' directory.
</UL>
<P>

<A NAME="SEC200"></A>
<H3> Loading a Model in Walktest </H3>
<!--docid::SEC200::-->
<P>

To load the model into Walktest, copy the sample world file given below to a new file named world.
Add this `<TT>world</TT>' file to the archive `<TT>conni_out.zip</TT>' using a ZIP-capable archiver, and then
issue the following command:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>./walktest -recalc data/conni_out.zip
</pre></td></tr></table></P><P>

This will allow you to view the model in Walktest.  The `<TT>world</TT>' file
defines a sample map and the <EM>mesh objects</EM> that make up the model.  If you
are curious, you can use a text editor to look at the `<TT>world</TT>' for more
information.  The sample `<TT>world</TT>' file is also reproduced below for
convenience (see section <A HREF="cs_100.html#Conni Output">Sample "World" file</A>).
</P><P>

<STRONG>Note</STRONG>: The model here is loaded into walktest for testing purposes.
Normally in your application there won't be a `<TT>world</TT>' file for each of
your models.  You have to load and animate your models using code.
</P><P>

<A NAME="SEC201"></A>
<H3> Description of Archive Contents </H3>
<!--docid::SEC201::-->
<P>

The output sprite archive `<TT>conni_out.zip</TT>' contains the following files.
</P><P>

<UL>
<LI>
<CODE>head</CODE>
<LI>
<CODE>upper</CODE>
<LI>
<CODE>lower</CODE>
<LI>
<CODE>head.tag</CODE>
<LI>
<CODE>upper.tag</CODE>
<LI>
<CODE>lower.tag</CODE>
<LI>
<CODE>conni.tga</CODE>
</UL>
<P>

The `<TT>head</TT>', `<TT>lower</TT>' and `<TT>upper</TT>' files contain the
<EM>meshobjects</EM>.  The file `<TT>conni.tga</TT>' is the texture file.  The files
`<TT>head.tag</TT>', `<TT>lower.tag</TT>' and `<TT>upper.tag</TT>' contain the MD3
tags.
</P><P>

<A NAME="SEC202"></A>
<H3> MD3 Tags </H3>
<!--docid::SEC202::-->
<P>

The MD3 tags are bits of information which specify the spatial location
and orientation of the mesh objects for each frame.  Here is an example of an
MD3 tag structure represented as C++ code:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>char Name[64];  // Name of the 'tag'.
Vec3 Position; // Relative position of tag.
Vec3x3 Rotation;// Direction tag faces relative to rest of model.
</pre></td></tr></table></P><P>

In the Crystal Space map format (which is XML), these tags are placed in a
separate file with a `<TT>.tag</TT>' extension.  The format of these tags is shown
below.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;key name="md3tag"
  tag="&#60;tag_name&#62; &#60;frame_num&#62; &#60;tag_num&#62;
       &#60;xpos ypos zpos&#62; &#60;3x3 rotation matrix&#62;" /&#62;
</pre></td></tr></table></P><P>

For example:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;key name="md3tag" tag="tag_torso 0 1  1 0 0 0 1 0 0 0 1  0 0 0" /&#62;
</pre></td></tr></table></P><P>

If your model does not have any animation or your model is made up of only one
mesh object, then you may not have these tags.
</P><P>

<A NAME="SEC203"></A>
<H3> Miscellaneous <CODE>md32spr</CODE> Information </H3>
<!--docid::SEC203::-->
<P>

This section will tell you if there are any special issues to worry about.
Currently these are the known issues.  If I come across anything else I will
amend this section.
</P><P>

<UL>
<LI>
Currently, in the mesh object files at the end, there are example mesh objects
definition.  These are not required to load the model, but they are left there
as an example.  You should comment it out manually to reduce memory usage.
<P>

<LI>
Some MD3 model converters do not write any frame number information if a
model is not animated.  This causes garbage numbers to be read from the
MD3 file.  Subsequently, you may end up with a a large number (possibly in
the thousands or hundred-thousands) duplicate frames which actually do nothing.
Until now I have not been able to find a solution to this problem.  Any
comments, suggestions or corrections are welcome.
<P>

<LI>
The loading of Crystal Space format XML models is somewhat slow presently.
You can speed it up by converting your models to binary format using
VIEWMESH.  I have not personally tried it.  But if anyone wants any help
let me know.
<P>

<LI>
Type <CODE>./md32spr</CODE> without any arguments to get a brief command line help.
</UL>
<P>

<A NAME="Conni Output"></A>
<A NAME="SEC204"></A>
<H3> Sample "World" file </H3>
<!--docid::SEC204::-->
<P>

Here is the sample `<TT>world</TT>' file for the "Conni" model. You need to copy this
to a new file and add that file to conni_out.zip. For the model to work in Walktest.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>&#60;world&#62;
  &#60;library&#62;lower&#60;/library&#62;
  &#60;library&#62;upper&#60;/library&#62;
  &#60;library&#62;head&#60;/library&#62;
  &#60;textures&#62;
    &#60;texture name="abstract_a032.gif"&#62;
      &#60;file&#62;/lib/stdtex/abstract_a032.jpg&#60;/file&#62;
    &#60;/texture&#62;
    &#60;texture name="andrew_wood.gif"&#62;
      &#60;file&#62;/lib/stdtex/andrew_wood.jpg&#60;/file&#62;
    &#60;/texture&#62;
  &#60;/textures&#62;
  &#60;materials&#62;
    &#60;material name="wood"&#62;
      &#60;texture&#62;andrew_wood.gif&#60;/texture&#62;
    &#60;/material&#62;
  &#60;/materials&#62;
  &#60;sector name="room"&#62;
    &#60;meshobj name="walls"&#62;
      &#60;plugin&#62;crystalspace.mesh.loader.thing&#60;/plugin&#62;
      &#60;params&#62;
	&#60;v x="-10" y="-1" z="10" /&#62;
	&#60;v x="10" y="-1" z="10" /&#62;
	&#60;v x="-10" y="-1" z="-10" /&#62;
	&#60;v x="10" y="-1" z="-10" /&#62;
	&#60;v x="-10" y="4" z="10" /&#62;
	&#60;v x="10" y="4" z="10" /&#62;
	&#60;v x="-10" y="4" z="-10" /&#62;
	&#60;v x="10" y="4" z="-10" /&#62;
	&#60;material&#62;wood&#60;/material&#62;
	&#60;texlen&#62;4&#60;/texlen&#62;
	&#60;p name="up"&#62;
	  &#60;v&#62;6&#60;/v&#62;
	  &#60;v&#62;7&#60;/v&#62;
	  &#60;v&#62;5&#60;/v&#62;
	  &#60;v&#62;4&#60;/v&#62;
	&#60;/p&#62;
	&#60;p name="down"&#62;
	  &#60;v&#62;3&#60;/v&#62;
	  &#60;v&#62;2&#60;/v&#62;
	  &#60;v&#62;0&#60;/v&#62;
	  &#60;v&#62;1&#60;/v&#62;
	&#60;/p&#62;
	&#60;p name="back"&#62;
	  &#60;v&#62;7&#60;/v&#62;
	  &#60;v&#62;6&#60;/v&#62;
	  &#60;v&#62;2&#60;/v&#62;
	  &#60;v&#62;3&#60;/v&#62;
	&#60;/p&#62;
	&#60;p name="front"&#62;
	  &#60;v&#62;4&#60;/v&#62;
	  &#60;v&#62;5&#60;/v&#62;
	  &#60;v&#62;1&#60;/v&#62;
	  &#60;v&#62;0&#60;/v&#62;
	&#60;/p&#62;
	&#60;p name="left"&#62;
	  &#60;v&#62;6&#60;/v&#62;
	  &#60;v&#62;4&#60;/v&#62;
	  &#60;v&#62;0&#60;/v&#62;
	  &#60;v&#62;2&#60;/v&#62;
	&#60;/p&#62;
	&#60;p name="right"&#62;
	  &#60;v&#62;5&#60;/v&#62;
	  &#60;v&#62;7&#60;/v&#62;
	  &#60;v&#62;3&#60;/v&#62;
	  &#60;v&#62;1&#60;/v&#62;
	&#60;/p&#62;
      &#60;/params&#62;
      &#60;zfill /&#62;
    &#60;/meshobj&#62;
    &#60;light&#62;
      &#60;center x="0" y="0" z="9" /&#62;
      &#60;radius&#62;40&#60;/radius&#62;
      &#60;color red="1" green="1" blue="1" /&#62;
    &#60;/light&#62;
    &#60;light&#62;
      &#60;center x="0" y="0" z="-9" /&#62;
      &#60;radius&#62;20&#60;/radius&#62;
      &#60;color red="1" green="1" blue="1" /&#62;
    &#60;/light&#62;
    &#60;light&#62;
      &#60;center x="-9" y="0" z="0" /&#62;
      &#60;radius&#62;20&#60;/radius&#62;
      &#60;color red="1" green="1" blue="1" /&#62;
    &#60;/light&#62;
    &#60;light&#62;
      &#60;center x="9" y="0" z="0" /&#62;
      &#60;radius&#62;20&#60;/radius&#62;
      &#60;color red="1" green="1" blue="1" /&#62;
    &#60;/light&#62;
    &#60;meshobj name="headh_head"&#62;
      &#60;plugin&#62;crystalspace.mesh.loader.sprite.3d&#60;/plugin&#62;
      &#60;params&#62;
	&#60;factory&#62;h_head&#60;/factory&#62;
	&#60;action&#62;default&#60;/action&#62;
      &#60;/params&#62;
      &#60;move&#62;
	&#60;matrix&#62;
	  &#60;rotx&#62;-1.5708&#60;/rotx&#62;
	&#60;/matrix&#62;
	&#60;v x="-1" y="0.45" z="3" /&#62;
      &#60;/move&#62;
    &#60;/meshobj&#62;
    &#60;meshobj name="upperu_torso"&#62;
      &#60;plugin&#62;crystalspace.mesh.loader.sprite.3d&#60;/plugin&#62;
      &#60;params&#62;
	&#60;factory&#62;u_torso&#60;/factory&#62;
	&#60;action&#62;TORSO_STAND&#60;/action&#62;
      &#60;/params&#62;
      &#60;move&#62;
	&#60;matrix&#62;
	  &#60;rotx&#62;-1.5708&#60;/rotx&#62;
	&#60;/matrix&#62;
	&#60;v x="-1" y="0.26" z="3" /&#62;
      &#60;/move&#62;
    &#60;/meshobj&#62;
    &#60;meshobj name="lowerl_legs"&#62;
      &#60;plugin&#62;crystalspace.mesh.loader.sprite.3d&#60;/plugin&#62;
      &#60;params&#62;
	&#60;factory&#62;l_legs&#60;/factory&#62;
	&#60;action&#62;LEGS_IDLE&#60;/action&#62;
      &#60;/params&#62;
      &#60;move&#62;
	&#60;matrix&#62;
	  &#60;rotx&#62;-1.5708&#60;/rotx&#62;
	&#60;/matrix&#62;
	&#60;v x="-1" y="0" z="3" /&#62;
      &#60;/move&#62;
    &#60;/meshobj&#62;
  &#60;/sector&#62;
&#60;/world&#62;
</pre></td></tr></table><A NAME="WinCVS Tutorial"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_99.html#SEC196"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_101.html#SEC205"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_88.html#SEC182"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_69.html#SEC153"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_134.html#SEC350"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="index.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_292.html#SEC943">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="cs_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated using
<A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
