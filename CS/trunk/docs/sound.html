<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>CrystalSpace Sound System Document</title>
</head>

<body bgcolor="#FFFFFF">

<p align="right">Version 0.03 (22 sept 1999)<br>
By <strong>NooTe</strong> (aka <strong>Nathaniel Saint Martin</strong>)</p>

<p align="right"><a href="mailto:noote@bigfoot.com">noote@bigfoot.com</a><br>
<a href="http://www.bigfoot.com/~noote/">http://www.bigfoot.com/~noote/</a></p>

<hr>

<h1 align="center">Sound System for CrystalSpace.</h1>

<h3>OS supported :</h3>

<blockquote>
  <p>I have made a win32 driver using waveOut functions (standard win32 api).<br>
  I have done Aureal3D 2.0, DirectSound3D (DX5), EAX 2.0 and Software renderer too !</p>
  <p>Gert Steenssens <a href="mailto:gsteenss@eps.agfa.be">gsteenss@eps.agfa.be</a> have
  made linux driver (OSS).</p>
  <p>Someone (sorry I don't known, please give me your name) have done the MacIntosh driver</p>
</blockquote>

<h3>File format supported :</h3>

<blockquote>
  <p>it can read :</p>
  <blockquote>
    <p>sun standard <strong>.au</strong> (or <strong>.snd</strong>), 8 and 16 bit PCM, 8 bit
    G.711 u-Law (no-compressed) ;<br>
    microsoft <strong>.wav</strong>, 8 and 16 bit PCM ;<br>
    amiga <strong>.8svx</strong>/<strong>.iff</strong>, 8 bit PCM ;<br>
    mac <strong>.aiff</strong>, 8 and 16 bit PCM.</p>
  </blockquote>
  <p>I'm searching about other usual file format (<a href="http://www.wotsit.org">http://www.wotsit.org</a>
  don't handle or give (good) information about mac .aiff format).</p>
  <p>Does some one know about 'Fibonacci-Delta encoding' compression in .8svx/.iff format ?<br>
  Or about G.721 a-Law ADPCM compression ?</p>
</blockquote>

<h3>Where can get it ?</h3>

<blockquote>
  <p>In CrystalSpace. distribution at <a href="http://crystal.linuxgames.com">http://crystal.linuxgames.com</a>
  !</p>
</blockquote>

<h3>How it work ?</h3>

<blockquote>
  <p>Sound System architecture is a bit like Graphics System... there're a renderer (and
  'low' driver access for software renderer). sound renderer enable 2d buffer (<strong><em>ISoundBuffer</em></strong>)
  and 3d buffer (<strong><em>ISoundSource</em></strong>)... attached with renderer (<strong><em>ISoundRender</em></strong>)
  there're the listener (basicly the ears of the view/player) (<strong><em>ISoundListener</em></strong>)
  for the 3d mode... ok you haven't understand this... i resume :</p>
  <p>Here the COM architecture :</p>
  <blockquote>
    <p>ISoundRender (this mix, calculate... all ISoundBuffer)<br>
    |---&gt; ISoundDriver (only used by software renderer, this is the 'low' access to sound
    OS)<br>
    |---&gt; ISoundBuffer (this is theplayed sound, we can create this with a <strong><em>csSoundData</em></strong>)<br>
    |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |---&gt; ISoundSource (the 3d sound emmitter
    control)<br>
    |---&gt;ISoundListener (the 3d listener)</p>
  </blockquote>
  <p>somes samples better than words (hum, I hope ;)) :</p>
  <blockquote>
    <p><em>csSoundData *sounddata;</em><strong><br>
    </strong>The sound data object.</p>
    <p><em>sounddata = csSoundDataObject::GetSound(pWorld, &quot;beep.wav&quot;);<br>
    </em>I load a sound file.</p>
    <p><em>ISoundBuffer *soundbuffer;<br>
    piSystem-&gt;piSoundRender-&gt;CreateSoundBuffer(&amp;soundbuffer, sounddata);</em><br>
    I create a 2d sound buffer;</p>
    <p><em>soundbuffer-&gt;Play();<br>
    </em>I play the sound... not really complicate ?</p>
    <p><em>soundbuffer-&gt;Stop();<br>
    </em>I stop this sound... hum, simple...</p>
    <p>And now, playing with 3d ! (a bit more complicate) :</p>
    <p><em>ISoundSource *source;<br>
    </em>The 3d source object<br>
    <br>
    There are two methodes for create a 3d source : directly from<em><strong> ISoundRender</strong></em>
    or from a <em><strong>ISoundBuffer<br>
    </strong>piSystem-&gt;piSoundRender-&gt;CreateSource(&amp;source, sounddata);<br>
    </em>... or...<br>
    <em>soundbuffer-&gt;CreateSource-&gt;(&amp;source);</em></p>
  </blockquote>
</blockquote>

<h3><a name="config">How configure sound system ?</a></h3>

<blockquote>
  <p>in your configuration file (cryst.cfg) you might have a [SoundDriver] section else make
  it :-) like this :</p>
</blockquote>

<pre>
[SoundDriver]
; MAX_CHANNELS set the maximum of channels we can mix
MAX_CHANNELS=16
; FREQUENCY set frequency supported by sound device (44100, 22050, 11025...)
FREQUENCY=11025
; 16BITS set if sound device may use 16 bits (if it supported)
16BITS=false
; STEREO enable stereo on sound device (if it supported) (for a 3d sound it
; can be necessary)
STEREO=true
; Active sound driver
ACTIVE=true
; Set general volume [0..1]
; If you put -1 or a value inferior to 0, current device volume is kept.
VOLUME=-1
</pre>

<blockquote>
  <p><strong>MAX_CHANNELS</strong> is the maximum of channels you can mix (only for software
  mixing, for a hardware multi voice, it the sound card whose fix this) (more is this value,
  more it can take cpu). </p>
  <p><strong>FREQUENCY</strong> is the sample frequency for playing (more is this value,
  more it can take cpu), this value can be fixed by hardware limit, verify it from your
  manual/driver/manufacturer).</p>
  <p><strong>16BITS</strong> is for use 16 bits else it use 8 bits playing (depend of you
  sound card capabilities)</p>
  <p><strong>STEREO</strong> is for use of... stereo ? YES, you're right, (it depend of your
  sound card too). this one can be usefully for 3d sound.</p>
  <p><strong>ACTIVE</strong>, so, you want ear sound, well, set this one to true and it
  activate your sound driver.</p>
  <p><strong>VOLUME</strong> is a software or hardware value, from 0 (empty) to 1 (full), it
  depend of you sound card and/or driver.</p>
</blockquote>

<h3>waveOut win32 driver configuration ?</h3>

<blockquote>
  <p>the waveOut win32 driver have is own configuration in addition to general sound driver
  configuration&nbsp; (see '<a href="#config">How configure sound system ?</a>')</p>
</blockquote>

<pre>[SoundDriver.waveOut]
; CALLBACK can be 'function' or 'thread'
CALLBACK=thread
; THREAD_PRIORITY can be 'lowest', 'normal' or 'highest'
THREAD_PRIORITY=highest
; number of refresh in a second
REFRESH=10
</pre>

<blockquote>
  <p><strong>CALLBACK</strong> method have two choice : 'thread' or 'function'. Thread
  method start a process whose fill sound data when it receive order (by waveOut). Function
  callback 'block' program for filling sound data, the call of function is done by waveOut
  but if us fps (Frame Per Second) is low or system idle is very low, calls to function
  can't be done (it unstable). I preconize thread method, (theorically) independent of main
  process idle.</p>
  <p><strong>THREAD_PRIORITY</strong> is only for thread method, it set the priority of
  thread : 'lowest' mean than sound thread have a lowest priority than main process,
  'normal' is equal priority for main process and sound thread, and 'highest' mean than
  thread priority is... highest than main process ! Better is 'highest' but it might not
  work in full screen some time (maybe a little bug from me).</p>
  <p><strong>REFRESH</strong> is the time of refresh of sound data, a '10' value mean
  refresh sound data 10 times per second. But here, a warning (erh, it's stay an
  experimental stuff yet ;-)), if you get an fps inferior to this refresh value, it can
  crash for function callback or cut sound for thread method !</p>
</blockquote>

<h3>Why it don't work ?</h3>

<blockquote>
  <p>hum... :<br>
  first, are you sure to have a sound card ? :-)<br>
  second, are you sure that sound card is supported by your OS ?<br>
  three, are you sure CrystalSpace have a sound driver for your OS ?<br>
  fourth, are you sure ? see debug.txt, if return a error from sound driver, try an other
  configuration by changing FREQUENCY, STEREO, 16 BITS, VOLUME and check if ACTIVE is
  'on/true/1'<br>
  fifth... bin, p'têt' qu'c'est un bogue ? (well, maybe it's a bug ?)</p>
</blockquote>
</body>
</html>
