SubDir TOP plugins filesys vfs ;

if $(ZLIB.AVAILABLE) = "yes"
{

Help vfs : "Virtual File System plug-in" ;

Plugin vfs :
	[ Wildcard *.cpp *.h ]
;
LinkWith vfs : csutil ;
ExternalLibs vfs : ZLIB ;

rule VfsCfgGen
{
  Depends $(<) : $(>) ;
  Always $(<) ;
}

actions VfsCfgGen
{
  cat $(>) > $(<)
  echo "VFS.$(TARGET.OS.NORMALIZED).CS_DATADIR = $(INSTALLDIR.DATA) " >> $(<)
  echo "VFS.$(TARGET.OS.NORMALIZED).CS_CONFIGDIR = $(INSTALLDIR.CONFIG) " >> $(<)
  echo "VFS.$(TARGET.OS.NORMALIZED).CS_MAPDIR = $(INSTALLDIR.MAP) " >> $(<)
}

# Build our own vfs.cfg
VFS_CONFIGFILE = vfs.cfg ;
MakeLocate $(VFS_CONFIGFILE:G=config) : $(LOCATE_TARGET) ;
SEARCH on $(VFS_CONFIGFILE:G=config) = $(LOCATE_TARGET) ;
VfsCfgGen $(VFS_CONFIGFILE:G=config) : $(SUBDIR)/vfs.cfg.template ;
InstallConfig $(VFS_CONFIGFILE:G=config) ;

}

