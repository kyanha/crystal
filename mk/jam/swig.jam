#============================================================================
# Rules for swig
#============================================================================

SED ?= sed ;

if $(CMD.SWIG)
{
  ## Swig cppfile : swigfile
  rule Swig
  {
    Depends $(<) : $(>) ;
    # Put the generated cpp files in the source directory. Because probably not
    # all people have swig installed so we want to add these generated files to
    # the sources.
    MakeLocate $(<) : $(SUBDIR) ;
    SWIG.FLAGS on $(<) += $(SWIG.FLAGS) ;
  }
  
  actions Swig
  {
    $(CMD.SWIG) $(SWIG.FLAGS) -o $(<) $(>)
    $(SED) '/\$Header$(<) > $(<).sed
    $(RM) $(<)
    $(MV) $(<).sed $(<)
  }

  rule SimpleSwig
  {
    local object = [ DoObjectGrist $(<:S=$(SUFOBJ)) ] ;
    local cppfile = $(<:S=.cpp) ;
    
    C++ $(object) : $(cppfile) ;
    Swig $(cppfile) : $(<) ;

    return $(object) ;
  }
  RegisterFileType SimpleSwig : .i ;

  SWIG.HDRPATTERN = "^[ 	]*[%#][ 	]*include[ 	]*[<\"]([^\">]*)[\">].*$" ;
  RegisterHeaderRule HeaderRule : $(SWIG.HDRPATTERN) : .i ;
}
